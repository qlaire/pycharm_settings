<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="/a.dummy" timestamp="1565627404719">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/returnable_subscription_item.py" timestamp="1565625666639">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="57" column="43" />
        <mark key="." line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/returnable_item_builder.py" timestamp="1564682922281">
        <mark key="[" line="7" column="22" />
        <mark key="]" line="7" column="28" />
        <mark key="." line="7" column="28" />
        <mark key="^" line="7" column="28" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/cms/app/server/controllers/test_warehouse.py" timestamp="1564421790435">
        <mark key="'" line="624" column="12" />
        <mark key="[" line="681" column="9" />
        <mark key="]" line="682" column="7" />
        <mark key="." line="682" column="7" />
        <mark key="^" line="682" column="7" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/returnable_order_repository.py" timestamp="1565797499157">
        <mark key="[" line="23" column="0" />
        <mark key="]" line="23" column="0" />
        <mark key="." line="23" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/server/controllers/__init__.py" timestamp="1555360759582">
        <mark key="'" line="25" column="39" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/domain/returnable_order.py" timestamp="1565794968046">
        <mark key="'" line="9" column="12" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/partners/shipping/ux_ship.py" timestamp="1560795347566">
        <mark key="'" line="552" column="36" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/shipping/logistics/domain/delivery_time_slot.py" timestamp="1563311075970">
        <mark key="'" line="35" column="16" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/data/models/test_order.py" timestamp="1563393823515">
        <mark key="'" line="56" column="26" />
        <mark key="[" line="747" column="32" />
        <mark key="]" line="748" column="7" />
        <mark key="^" line="748" column="7" />
        <mark key="." line="748" column="7" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/peloton_postgres.py" timestamp="1564161269480">
        <mark key="'" line="230" column="32" />
      </file>
      <file name="$USER_HOME$/Development/blackboard/blackboard-slate-api-py/bb_slate_api/repositories/losses_mapper.py" timestamp="1548269615784">
        <mark key="'" line="27" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/rest_api/app/server/utils.py" timestamp="1554390568796">
        <mark key="'" line="386" column="18" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/app/server/controllers/test_order.py" timestamp="1555966356258">
        <mark key="'" line="675" column="24" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/shipping/logistics/data/test_postal_code_warehouse_builder.py" timestamp="1555537271437">
        <mark key="'" line="53" column="25" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/app/utils/warehouse_postal_code_parser.py" timestamp="1563914417092">
        <mark key="'" line="305" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/app/server/controllers/fulfillment_configurations/device_subscription.py" timestamp="1565622881174">
        <mark key="'" line="60" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/domain/test_order_item.py" timestamp="1564691826387">
        <mark key="[" line="17" column="89" />
        <mark key="]" line="17" column="90" />
        <mark key="." line="17" column="90" />
        <mark key="^" line="17" column="92" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/components/ecomm/warehouse/warehouse_index.py" timestamp="1564413461379">
        <mark key="'" line="48" column="46" />
        <mark key="[" line="48" column="57" />
        <mark key="]" line="48" column="62" />
        <mark key="." line="48" column="62" />
        <mark key="^" line="48" column="62" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/billing/subscription_charge.py" timestamp="1554153690088">
        <mark key="'" line="62" column="16" />
      </file>
      <file name="$USER_HOME$/Library/Caches/PyCharm2019.1/remote_sources/-1820590504/-497732817/cms/app/server/controllers/rma.py" timestamp="1565276849417">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/zendesk/commands/return_order.py" timestamp="1564516419404">
        <mark key="'" line="19" column="11" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/warehouse.py" timestamp="1558723296896">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/rmas/commands/return_items.py" timestamp="1564675480607">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="1" column="16" />
        <mark key="^" line="1" column="16" />
        <mark key="." line="1" column="16" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/commands/test_process_return.py" timestamp="1565298425063">
        <mark key="'" line="16" column="0" />
        <mark key="[" line="19" column="0" />
        <mark key="]" line="22" column="55" />
        <mark key="." line="10" column="0" />
        <mark key="^" line="45" column="68" />
      </file>
      <file name="/order_details.py" timestamp="1565300574974">
        <mark key="'" line="3" column="38" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/data/test_returnable_subscription_builder.py" timestamp="1565798427143">
        <mark key="[" line="45" column="59" />
        <mark key="]" line="45" column="59" />
        <mark key="^" line="45" column="59" />
        <mark key="." line="45" column="59" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/cms/app/utils/test_warehouse_zipcode_parser.py" timestamp="1555360008161">
        <mark key="'" line="382" column="12" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/app/server/controllers/zendesk/responses/test_order_details.py" timestamp="1565367526295">
        <mark key="'" line="9" column="21" />
        <mark key="[" line="16" column="51" />
        <mark key="]" line="16" column="51" />
        <mark key="^" line="15" column="62" />
        <mark key="." line="16" column="51" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/returnable_order_builder.py" timestamp="1565795783219">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="21" column="24" />
        <mark key="]" line="21" column="31" />
        <mark key="^" line="21" column="31" />
        <mark key="." line="21" column="31" />
      </file>
      <file name="$USER_HOME$/Development/blackboard/blackboard-slate-api-py/bb_slate_api/repositories/iqos_transaction_accessor.py" timestamp="1548190689249">
        <mark key="'" line="10" column="6" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/domain/test_returnable_order.py" timestamp="1565794902081">
        <mark key="]" line="51" column="9" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/domain/returnable_item.py" timestamp="1564678019559">
        <mark key="[" line="8" column="27" />
        <mark key="]" line="9" column="24" />
        <mark key="." line="9" column="24" />
        <mark key="^" line="9" column="24" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/subscription.py" timestamp="1565798148967">
        <mark key="'" line="739" column="8" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2172" column="68" />
        <mark key="." line="2172" column="68" />
        <mark key="^" line="2172" column="68" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/shipping/logistics/commands/test_get_available_delivery_dates_for_postal_code.py" timestamp="1555968253807">
        <mark key="'" line="65" column="36" />
      </file>
      <file name="$USER_HOME$/Development/blackboard/blackboard-slate-api-py/bb_slate_api/queries/query_handler.py" timestamp="1544114583308">
        <mark key="'" line="10" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/subscriptions/data/subscription_factory.py" timestamp="1554834511131">
        <mark key="'" line="8" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/templates/rider/subscriptions/confirm_pause.html" timestamp="1555099343573">
        <mark key="'" line="51" column="66" />
      </file>
      <file name="$USER_HOME$/Development/blackboard/blackboard-slate-api-py/bb_slate_api/appservices/save_and_rerate_service.py" timestamp="1544644033125">
        <mark key="'" line="12" column="16" />
      </file>
      <file name="$USER_HOME$/Development/api/data/default/installers/models.py" timestamp="1560525525831">
        <mark key="'" line="23" column="28" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/product.py" timestamp="1560266948092">
        <mark key="'" line="190" column="34" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/orders/order_service.py" timestamp="1565286510580">
        <mark key="'" line="70" column="1" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/subscriptions/data/subscription_repository.py" timestamp="1565623257134">
        <mark key="'" line="13" column="6" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/server/controllers/zendesk/responses/order_details.py" timestamp="1565378305945">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="3" column="0" />
        <mark key="." line="3" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/mq/app/handlers/email/prepare_for_delivery/test_prepare_for_delivery_emails.py" timestamp="1563399557541">
        <mark key="'" line="250" column="47" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/components/shared/deprecated_layout.py" timestamp="1564068013034">
        <mark key="'" line="92" column="14" />
      </file>
      <file name="$USER_HOME$/Development/api/scripts/cron/send_due_subscriptions_to_charge_queue.py" timestamp="1554305314698">
        <mark key="'" line="11" column="30" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/rma.py" timestamp="1565032989921">
        <mark key="'" line="40" column="18" />
      </file>
      <file name="$USER_HOME$/Development/api/lib/unittest.py" timestamp="1555530592536">
        <mark key="'" line="395" column="20" />
      </file>
      <file name="$USER_HOME$/Development/blackboard/blackboard-slate-api-py/bb_slate_api/appservices/transaction_context_manager.py" timestamp="1547666883375">
        <mark key="'" line="39" column="16" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/app/server/controllers/zendesk/test_return_order.py" timestamp="1565300063144">
        <mark key="'" line="154" column="49" />
        <mark key="[" line="154" column="49" />
        <mark key="]" line="154" column="68" />
        <mark key="^" line="154" column="68" />
        <mark key="." line="154" column="68" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/docs/ecomm_api.yaml" timestamp="1553868137905">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/parent_payment.py" timestamp="1565798336664">
        <mark key="[" line="21" column="25" />
        <mark key="]" line="22" column="31" />
        <mark key="^" line="22" column="31" />
        <mark key="." line="22" column="31" />
      </file>
      <file name="$USER_HOME$/Development/api/docs/open_api/peloton-api.yaml" timestamp="1554143327791">
        <mark key="'" line="1781" column="26" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/returnable_subscription_builder.py" timestamp="1565797526797">
        <mark key="[" line="11" column="36" />
        <mark key="]" line="12" column="28" />
        <mark key="^" line="12" column="28" />
        <mark key="." line="12" column="28" />
      </file>
      <file name="$USER_HOME$/Development/api/lib/orm/base/models.py" timestamp="1555360642379">
        <mark key="'" line="304" column="6" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/data/test_subscription.py" timestamp="1555684114263">
        <mark key="'" line="29" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/templates/ecomm/orders/profile.html" timestamp="1565286515389">
        <mark key="'" line="97" column="75" />
      </file>
      <file name="/usr/local/Cellar/python@2/2.7.16/Frameworks/Python.framework/Versions/2.7/lib/python2.7/unittest/case.py" timestamp="1555943043207">
        <mark key="'" line="239" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/data/services/worker_service.py" timestamp="1564078234406">
        <mark key="'" line="105" column="24" />
      </file>
      <file name="$USER_HOME$/.virtualenvs/blackboard-slate-api-py-hpJx4-Qj/lib/python3.6/site-packages/dateutil/relativedelta.py" timestamp="1548274002704">
        <mark key="'" line="95" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/subscriptions/commands/test_pause_subscription.py" timestamp="1559164802922">
        <mark key="'" line="15" column="23" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/shipping/quotes/us.py" timestamp="1556042514093">
        <mark key="'" line="208" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/mq/app/workers/ecomm/ecommerce.py" timestamp="1554153232310">
        <mark key="'" line="355" column="4" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/returnable_subscription_item_builder.py" timestamp="1565627623712">
        <mark key="[" line="23" column="26" />
        <mark key="]" line="24" column="57" />
        <mark key="^" line="24" column="57" />
        <mark key="." line="24" column="57" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/shipping/quotes/uk.py" timestamp="1555957461996">
        <mark key="'" line="41" column="53" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/please/make.py" timestamp="1565797903950">
        <mark key="'" line="441" column="17" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/postalcode.py" timestamp="1556032690200">
        <mark key="'" line="114" column="27" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/commands/test_get_returnable_order.py" timestamp="1565361874605">
        <mark key="'" line="11" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/errors/ecomm.py" timestamp="1554390553010">
        <mark key="'" line="574" column="25" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/commands/process_return.py" timestamp="1565363162352">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="4" column="0" />
        <mark key="]" line="4" column="0" />
        <mark key="^" line="43" column="33" />
        <mark key="." line="4" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/cms/components/ecomm/warehouse/test_warehouse_index.py" timestamp="1564077000300">
        <mark key="'" line="47" column="32" />
        <mark key="[" line="11" column="18" />
        <mark key="]" line="12" column="0" />
        <mark key="^" line="12" column="0" />
        <mark key="." line="12" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/mq/app/handlers/email/test_subscription_scheduled_for_cancellation.py" timestamp="1555423394092">
        <mark key="'" line="72" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/app/server/controllers/zendesk/responses/test_return_order.py" timestamp="1565120135037">
        <mark key="[" line="2" column="50" />
        <mark key="]" line="2" column="51" />
        <mark key="." line="2" column="51" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/templates/rider/subscriptions/profile.html" timestamp="1565622759067">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Library/Caches/PyCharm2019.1/remote_sources/-1820590504/-497732817/data/models/user.py" timestamp="1560526092521">
        <mark key="'" line="1784" column="28" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/data/test_returnable_subscription_item_builder.py" timestamp="1565628661122">
        <mark key="[" line="19" column="0" />
        <mark key="]" line="19" column="0" />
        <mark key="." line="19" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/orderitem.py" timestamp="1565021197823">
        <mark key="'" line="313" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/mq/app/handlers/ecomm/ecommerce.py" timestamp="1554153159541">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Development/blackboard/blackboard-slate-api-py/bb_slate_api/repositories/lob_mapper.py" timestamp="1548190641751">
        <mark key="'" line="68" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/rma/rma_service.py" timestamp="1565623154834">
        <mark key="'" line="131" column="26" />
        <mark key="[" line="120" column="60" />
        <mark key="]" line="46" column="17" />
        <mark key="^" line="46" column="17" />
        <mark key="." line="46" column="17" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/subscriptions/domain/base_subscription.py" timestamp="1554834248887">
        <mark key="'" line="18" column="12" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/scripts/scourgify/workers/refund_sub_charges/test_with_already_refunded_subscription.py" timestamp="1564077940731">
        <mark key="'" line="5" column="23" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/data/test_returnable_order_builder.py" timestamp="1565796780630">
        <mark key="[" line="138" column="0" />
        <mark key="]" line="144" column="9" />
      </file>
      <file name="$USER_HOME$/Development/api/data/services/shipping.py" timestamp="1557331283667">
        <mark key="'" line="72" column="0" />
      </file>
      <file name="$USER_HOME$/Library/Caches/PyCharm2019.1/remote_sources/642138530/-1227933812/webtest/utils.py" timestamp="1554391637412">
        <mark key="'" line="36" column="20" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/commands/get_returnable_order.py" timestamp="1565361301482">
        <mark key="[" line="9" column="0" />
        <mark key="]" line="9" column="0" />
        <mark key="." line="9" column="0" />
        <mark key="^" line="8" column="79" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/shipping/quotes/ca.py" timestamp="1555360504952">
        <mark key="'" line="192" column="60" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/app/server/controllers/rma.py" timestamp="1565623196020">
        <mark key="'" line="87" column="8" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/app/server/controllers/shipment.py" timestamp="1564427445657">
        <mark key="'" line="42" column="0" />
        <mark key="[" line="196" column="56" />
        <mark key="]" line="196" column="70" />
        <mark key="." line="196" column="70" />
        <mark key="^" line="196" column="70" />
      </file>
      <file name="$USER_HOME$/Development/api/mq/app/handlers/email/__init__.py" timestamp="1563994541231">
        <mark key="'" line="146" column="24" />
        <mark key="[" line="193" column="30" />
        <mark key="]" line="193" column="57" />
        <mark key="." line="193" column="57" />
        <mark key="^" line="193" column="57" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/shipment.py" timestamp="1565113614221">
        <mark key="'" line="108" column="26" />
        <mark key="[" line="434" column="0" />
        <mark key="]" line="435" column="69" />
        <mark key="^" line="436" column="89" />
        <mark key="." line="436" column="89" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/app/server/controllers/order/logistics.py" timestamp="1563311234353">
        <mark key="'" line="42" column="43" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/features/lib/steps.py" timestamp="1556031019930">
        <mark key="'" line="405" column="18" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/app/server/controllers/order.py" timestamp="1564421186353">
        <mark key="'" line="20" column="32" />
      </file>
      <file name="$USER_HOME$/Library/Caches/PyCharm2019.1/remote_sources/642138530/-497732817/data/models/warehouse.py" timestamp="1556218333037">
        <mark key="'" line="19" column="37" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/shipping/logistics/commands/get_available_delivery_dates_for_postal_code.py" timestamp="1556031416282">
        <mark key="'" line="32" column="4" />
      </file>
      <file name="$USER_HOME$/Library/Caches/PyCharm2019.1/remote_sources/-1820590504/-497732817/tests/ecomm/app/server/controllers/zendesk/test_return_order.py" timestamp="1565287504576">
        <mark key="'" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/app/server/controllers/buy/test_shipping_price_override.py" timestamp="1563305434228">
        <mark key="'" line="145" column="29" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/mq/app/handlers/email/test_schedule_shipment.py" timestamp="1563399716924">
        <mark key="'" line="163" column="13" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/domain/returnable_subscription_item.py" timestamp="1565627590176">
        <mark key="'" line="7" column="20" />
        <mark key="[" line="5" column="78" />
        <mark key="]" line="5" column="82" />
        <mark key="." line="5" column="82" />
        <mark key="^" line="5" column="82" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/order_item_builder.py" timestamp="1565625663350">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="59" column="43" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/data/models/test_shipment.py" timestamp="1563399259300">
        <mark key="'" line="711" column="34" />
        <mark key="[" line="699" column="36" />
        <mark key="]" line="699" column="62" />
        <mark key="^" line="699" column="62" />
        <mark key="." line="699" column="62" />
      </file>
      <file name="$USER_HOME$/Library/Caches/PyCharm2019.1/remote_sources/642138530/-1227933812/webtest/app.py" timestamp="1554391712404">
        <mark key="'" line="734" column="31" />
      </file>
      <file name="$USER_HOME$/Development/api/data/models/return_item.py" timestamp="1565033745301">
        <mark key="'" line="46" column="31" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" timestamp="1565623122858">
        <mark key="'" line="905" column="14" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/app/graphql/test_order.py" timestamp="1563397311592">
        <mark key="'" line="85" column="13" />
        <mark key="[" line="377" column="30" />
        <mark key="]" line="377" column="33" />
        <mark key="." line="377" column="33" />
        <mark key="^" line="377" column="33" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/ecomm/zendesk/commands/test_return_order.py" timestamp="1564501926468">
        <mark key="[" line="33" column="53" />
        <mark key="]" line="34" column="47" />
        <mark key="." line="34" column="47" />
        <mark key="^" line="34" column="47" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/subscriptions/domain/peloton_digital_subscription.py" timestamp="1554153510916">
        <mark key="'" line="121" column="12" />
      </file>
      <file name="$USER_HOME$/Development/api/ecomm/returns/order_returns/domain/order_item.py" timestamp="1565624352173">
        <mark key="'" line="6" column="0" />
        <mark key="[" line="6" column="17" />
        <mark key="]" line="7" column="12" />
        <mark key="." line="7" column="12" />
        <mark key="^" line="7" column="12" />
      </file>
      <file name="$USER_HOME$/Development/blackboard/blackboard-slate-api-py/tests/backend/accounts/conftest.py" timestamp="1544117439238">
        <mark key="'" line="73" column="4" />
      </file>
      <file name="$USER_HOME$/Development/api/tests/integration/ecomm/test_order_response.py" timestamp="1555968521579">
        <mark key="'" line="1326" column="14" />
      </file>
      <file name="$USER_HOME$/Development/api/cms/app/server/controllers/warehouse.py" timestamp="1564421619728">
        <mark key="'" line="102" column="61" />
        <mark key="[" line="107" column="0" />
        <mark key="]" line="107" column="0" />
        <mark key="^" line="106" column="3" />
        <mark key="." line="107" column="0" />
      </file>
      <file name="$USER_HOME$/Development/api/lib/orm/postgres/managers.py" timestamp="1561127055830">
        <mark key="'" line="32" column="4" />
      </file>
    </filemarks>
    <jumps>
      <jump line="72" column="8" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/domain/test_returnable_order.py" />
      <jump line="75" column="8" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/domain/test_returnable_order.py" />
      <jump line="78" column="8" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/domain/test_returnable_order.py" />
      <jump line="145" column="8" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/domain/test_returnable_order.py" />
      <jump line="148" column="8" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/domain/test_returnable_order.py" />
      <jump line="1401" column="54" filename="$USER_HOME$/Development/api/data/models/order.py" />
      <jump line="24" column="0" filename="$USER_HOME$/Development/api/data/models/order.py" />
      <jump line="0" column="0" filename="$USER_HOME$/Library/Caches/PyCharm2019.1/remote_sources/-1820590504/-497732817/tests/ecomm/app/server/controllers/zendesk/test_return_order.py" />
      <jump line="59" column="12" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/commands/test_process_return.py" />
      <jump line="61" column="0" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/commands/test_process_return.py" />
      <jump line="17" column="0" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/commands/test_process_return.py" />
      <jump line="0" column="0" filename="$USER_HOME$/Development/api/tests/ecomm/app/server/controllers/zendesk/test_return_order.py" />
      <jump line="154" column="49" filename="$USER_HOME$/Development/api/tests/ecomm/app/server/controllers/zendesk/test_return_order.py" />
      <jump line="6" column="89" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/commands/test_get_returnable_order.py" />
      <jump line="3" column="38" filename="/order_details.py" />
      <jump line="11" column="0" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/commands/test_get_returnable_order.py" />
      <jump line="246" column="25" filename="$USER_HOME$/Development/api/ecomm/app/rma/rma_service.py" />
      <jump line="21" column="30" filename="$USER_HOME$/Development/api/ecomm/app/rma/rma_service.py" />
      <jump line="22" column="4" filename="$USER_HOME$/Development/api/ecomm/app/rma/rma_service.py" />
      <jump line="23" column="4" filename="$USER_HOME$/Development/api/ecomm/app/rma/rma_service.py" />
      <jump line="0" column="0" filename="$USER_HOME$/Development/api/cms/templates/rider/subscriptions/profile.html" />
      <jump line="0" column="0" filename="$USER_HOME$/Development/api/cms/app/server/controllers/fulfillment_configurations/device_subscription.py" />
      <jump line="58" column="70" filename="$USER_HOME$/Development/api/cms/app/server/controllers/fulfillment_configurations/device_subscription.py" />
      <jump line="60" column="8" filename="$USER_HOME$/Development/api/cms/app/server/controllers/fulfillment_configurations/device_subscription.py" />
      <jump line="1191" column="17" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="1216" column="32" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="1253" column="32" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="1329" column="32" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="1560" column="4" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="1761" column="4" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="334" column="4" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="453" column="4" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="562" column="4" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="725" column="4" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="905" column="14" filename="$USER_HOME$/Development/api/cms/app/server/controllers/riders.py" />
      <jump line="131" column="26" filename="$USER_HOME$/Development/api/ecomm/app/rma/rma_service.py" />
      <jump line="42" column="12" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="43" column="12" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="301" column="16" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="302" column="16" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="359" column="38" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="360" column="43" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="382" column="61" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="581" column="65" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="585" column="27" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="586" column="40" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="591" column="37" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="628" column="28" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="409" column="43" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="445" column="32" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="446" column="50" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="463" column="36" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="607" column="15" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="4" column="20" filename="$USER_HOME$/Development/api/ecomm/returns/order_returns/domain/returnable_subscription_item.py" />
      <jump line="45" column="21" filename="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/order_item_builder.py" />
      <jump line="0" column="0" filename="$USER_HOME$/Development/api/ecomm/returns/order_returns/data/order_item_builder.py" />
      <jump line="24" column="8" filename="$USER_HOME$/Development/api/tests/ecomm/returns/order_returns/data/test_returnable_subscription_item_builder.py" />
      <jump line="1349" column="4" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="1507" column="17" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="1579" column="20" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="1587" column="20" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="1595" column="17" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="1602" column="20" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="1612" column="24" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="1624" column="42" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="1636" column="48" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="609" column="41" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="831" column="8" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="833" column="21" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="835" column="22" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="968" column="24" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="918" column="12" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="597" column="16" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="468" column="12" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="387" column="52" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="264" column="4" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="269" column="13" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="270" column="8" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="271" column="9" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="272" column="14" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="287" column="25" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="845" column="44" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="18" column="4" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="279" column="8" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="736" column="8" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="855" column="12" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="0" column="0" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="2172" column="68" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="16" column="41" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
      <jump line="1648" column="30" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="2158" column="16" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="2236" column="31" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="2238" column="17" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="2241" column="16" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="426" column="31" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="430" column="17" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="432" column="17" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="440" column="45" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="441" column="17" filename="$USER_HOME$/Development/api/tests/please/make.py" />
      <jump line="739" column="8" filename="$USER_HOME$/Development/api/data/models/subscription.py" />
    </jumps>
    <registers>
      <register name="&quot;" type="2">
        <text encoding="base64">ICAgICAgICBwYXltZW50ID0gTW9kZWwuUGF5bWVudC5zYXZlX3dpdGgoCgogICAgICAgICkK</text>
      </register>
      <register name="-" type="4">
        <text>.</text>
      </register>
      <register name="/" type="4">
        <text encoding="base64">XDxwYXJlbnRfcGF5bWVudF90eXBlXD4=</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">ICAgICAgICBvcmRlcl9pdGVtID0gbWFrZS5hbl9vcmRlcml0ZW0oCiAgICAgICAgICAgIG9yZGVyPW9ybV9vcmRlciwKICAgICAgICAgICAgb3JkZXJpdGVtX19faXNfc3Vic2NyaXB0aW9uPVRydWUsCiAgICAgICAgKQogICAgICAgIHN1YnNjcmlwdGlvbiA9IG1ha2UuYV9zdWJzY3JpcHRpb24oCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9fb3JkZXJfaXRlbV9pZD1vcmRlcl9pdGVtLmlkCiAgICAgICAgKQo=</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">ICAgICAgICBwYXltZW50ID0gTW9kZWwuUGF5bWVudC5zYXZlX3dpdGgoCgogICAgICAgICkK</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgICAgICAgICAgCiAgICAgICAgICAgIAo=</text>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgICAgICAgICAgLndpdGhfcGF5bWVudCgpCg==</text>
      </register>
      <register name="s" type="4">
        <text>(SCHEDULED_DELIVERY_DATE</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgICAgICBwYXltZW50ID0gZ2V0X2xhdGVzdF9wYXltZW50KHN1YnNjcmlwdGlvbikK</text>
      </register>
      <register name="5" type="4">
        <text encoding="base64">ZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhYnNvbHV0ZV9pbXBvcnQKCmltcG9ydCBhcnJvdwpmcm9tIGNvbGxlY3Rpb25zIGltcG9ydCBuYW1lZHR1cGxlCmltcG9ydCBkYXRldGltZQpmcm9tIGZ1bmN0b29scyBpbXBvcnQgd3JhcHMKZnJvbSBvcGVyYXRvciBpbXBvcnQgYXR0cmdldHRlcgppbXBvcnQgcmFuZG9tCmltcG9ydCBzdHJpbmcKaW1wb3J0IHV1aWQKCmZyb20gZGF0YS5tb2RlbHMucGF5bWVudF9zZXQgaW1wb3J0IFBheW1lbnRTZXQKZnJvbSBkYXRhZG9nIGltcG9ydCBzdGF0c2QKZnJvbSBwcmVjb25kaXRpb25zIGltcG9ydCBwcmVjb25kaXRpb25zCmZyb20gZnJvemVuZGljdCBpbXBvcnQgZnJvemVuZGljdAoKZnJvbSBkYXRldXRpbC5yZWxhdGl2ZWRlbHRhIGltcG9ydCByZWxhdGl2ZWRlbHRhCmZyb20gZGF0YS5tb2RlbHMuc2hhcmVkLmNvbnN0cyBpbXBvcnQgKAogICAgQUNDRVNTX0xFVkVMLAogICAgQUNUSVZBVEVEX09OLAogICAgQkFTSUMsCiAgICBCSUtFLAogICAgQklLRV9ERVZJQ0VfSUQsCiAgICBCSUtFX0RFVklDRV9MQVNUX0FUVEFDSEVEX0FULAogICAgQ0FOQ0VMTEVEX09OLAogICAgQ09TVF9JTl9DRU5UUywKICAgIENPU1RfSU5fRE9MTEFSUywKICAgIENSRUFURURfQVQsCiAgICBDVVJSRU5UX1NVQlNDUklQVElPTl9UUkFOU0ZFUl9SRUFTT05TLAogICAgREVWSUNFX0lELAogICAgREVWSUNFX0xBU1RfQVRUQUNIRURfQVQsCiAgICBGSVJTVF9BQ1RJVkFURURfT04sCiAgICBGUkVFLAogICAgSUQsCiAgICBJTkFDVElWRSwKICAgIElTX0FDVElWRSwKICAgIElTX0FVVE9NQVRFRF9URVNUX1NVQlNDUklQVElPTiwKICAgIExBU1RfQklMTElOR19BVFRFTVBURURfQVQsCiAgICBMQVNUX0JJTExJTkdfRkFJTEVEX0FULAogICAgTEFTVF9ERUJJVF9BVCwKICAgIE5BTUUsCiAgICBPUkRFUl9JRCwKICAgIE9SREVSX0lURU1fSUQsCiAgICBQUkVQQUlEX0NSRURJVFMsCiAgICBQUkVQQUlEX0NSRURJVFNfVVNFRCwKICAgIFNUQVRVUywKICAgIFNUQVRVU19URVhULAogICAgU1VCU0NSSVBUSU9OX1NUQVRVU0VTLAogICAgVE9UQUxfUEFZTUVOVFMsCiAgICBUUkVBRCwKICAgIFRSRUFEX0RFVklDRV9JRCwKICAgIFRSRUFEX0RFVklDRV9MQVNUX0FUVEFDSEVEX0FULAogICAgVUxUSU1BVEUsCiAgICBVU0VSX0lELAogICAgV0FJVkVSUywKICAgIFdBSVZFUlNfVVNFRCwKKQpmcm9tIGRhdGEubW9kZWxzLnNoYXJlZC5pZHR5cGVzIGltcG9ydCAoCiAgICBEZXZpY2VJRCwKICAgIE9yZGVySXRlbUlELAogICAgU3Vic2NyaXB0aW9uSUQsCiAgICBVc2VySUQsCikKZnJvbSBlY29tbS5ldmVudHMgaW1wb3J0ICgKICAgIEV2ZW50QnVzLAogICAgU3Vic2NyaXB0aW9uQWN0aXZhdGVkLAopCmZyb20gbG9jYWxlcyBpbXBvcnQgQ1VSUkVOQ0lFUywgVVNfRE9MTEFSLCBpc192YXRfY3VycmVuY3kKZnJvbSBkYXRhLm1vZGVscy5zaGFyZWQuam9pbl90YWJsZXMgaW1wb3J0ICgKICAgIHNoYXJlZF91c2VyX2FuZF9zaGFyZWRfc3Vic2NyaXB0aW9uX2pvaW5fdGFibGUsCikKZnJvbSBsb2NhbGVzIGltcG9ydCBDT1VOVFJJRVMKZnJvbSBkYXRhLm1vZGVscy5zdWJzY3JpcHRpb25fY29tbW9uIGltcG9ydCBTdWJzY3JpcHRpb25Db21tb24KaW1wb3J0IGRhdGEuc2VydmljZXMuZXF1aXBtZW50IGFzIEVxdWlwbWVudFNlcnZpY2UKZnJvbSBkYXRhLm1vZGVscy5zdWJzY3JpcHRpb25fdHJhbnNhY3Rpb24gaW1wb3J0IFNVQlNDUklQVElPTl9BQ1RJT05TX0VOVU0KZnJvbSBkYXRhLnNlcnZpY2VzLmVuYWJsZW1lbnQgaW1wb3J0IGlzX2JhbGFuY2VfaW5fbW9udGhzX3JlZmFjdG9yX2VuYWJsZWQKZnJvbSBkYXRhLnNlcnZpY2VzLnRheCBpbXBvcnQgVGF4U2VydmljZQppbXBvcnQgZGF0YS5zaWduYWxzCmZyb20gZGIuY29uc3RzIGltcG9ydCBNQUdJQ0hBVCwgT01NRUdBTkcKZnJvbSBlY29tbS5hcHAucGFydG5lcnMgaW1wb3J0IGdldF93cmFwcGVyCmZyb20gZWNvbW0uYXBwLnBhcnRuZXJzLnRheC5jb25zdHMgaW1wb3J0IFNVQlNDUklQVElPTl9QQVlNRU5UX1RBWF9UWVBFCmZyb20gZXJyb3JzIGltcG9ydCBFY29tbWVyY2VFcnJvciwgSW52YWxpZEFjdGl2YXRpb25Db2RlRXJyb3IsIFBheW1lbnRFcnJvcgpmcm9tIGxpYi5jb25zdHMgaW1wb3J0IEFWQUxBUkEsIE9ORV9EQVksIFRaX1VTX0VBU1RFUk4sIEZFQVRVUkVfRkxBR1MKZnJvbSBsaWIuZXhwZXJpbWVudHMgaW1wb3J0IEV4cGVyaW1lbnRzCmZyb20gbGliLmVycm9ycyBpbXBvcnQgRG9lc05vdEV4aXN0LCBEb2VzTm90VmFsaWRhdGUKZnJvbSBsaWIubG9nZ2luZyBpbXBvcnQgY29udGV4dF9sb2dnZXIsIGdldF9hcHBfbG9nZ2VyCmZyb20gbGliLm9ybS5iYXNlLmRlc2NyaXB0b3JzIGltcG9ydCAoCiAgICBCb29sZWFuLAogICAgSW5zdGFudCwKICAgIEludGVnZXIsCiAgICBNZW1iZXIsCiAgICBTdHJpbmcsCiAgICBVbmljb2RlLAogICAgVVVJRCwKKQpmcm9tIGxpYi5vcm0uYmFzZS5taXhpbnMgaW1wb3J0ICgKICAgIEFQSU1peGluLAogICAgU29mdERlbGV0ZU1hbmFnZXJNaXhpbiwKICAgIFNvZnREZWxldGVNaXhpbiwKICAgIFRpbWVzdGFtcE1peGluLAopCmZyb20gbGliLm9ybS5iYXNlLnJlbGF0aW9ucyBpbXBvcnQgRm9yZWlnbktleSwgT25lVG9NYW55CmZyb20gbGliLm9ybS5mIGltcG9ydCBGCmZyb20gbGliLm9ybS5tb2RlbCBpbXBvcnQgTW9kZWwKZnJvbSBsaWIub3JtLnBvc3RncmVzLm1hbmFnZXJzIGltcG9ydCBQb3N0Z3Jlc01hbmFnZXIKZnJvbSBsaWIub3JtLnBvc3RncmVzLm1vZGVscyBpbXBvcnQgUG9zdGdyZXNNb2RlbApmcm9tIGxpYi50eXBlcy5lbnVtIGltcG9ydCBFbnVtCmZyb20gbGliLnV0aWxzIGltcG9ydCAoCiAgICBjZW50c190b19kb2xsYXJzLAogICAgZGF0ZXRpbWVfdG9fZXBvY2gsCiAgICBkb2xsYXJzX3RvX2NlbnRzLAogICAgZXBvY2hfdG9fZGF0ZXRpbWUsCiAgICBmb3JtYXRfY2VudHNfYXNfY3VycmVuY3ksCiAgICBmb3JtYXRfZXBvY2gsCikKZnJvbSBsaWIudXRpbHMuZGVjb3JhdG9ycyBpbXBvcnQgaGFuZGxlX2V4Y2VwdGlvbgpmcm9tIGxpYi51dGlscy5zdHJpbmdzIGltcG9ydCBjb252ZXJ0X3N0cmluZ190b191dWlkCgpHUkFDRV9QRVJJT0QgPSAxNSAqIE9ORV9EQVkKClNVQlNDUklQVElPTl9SRUdVTEFSX0NIQVJHRSA9ICJzdWJzY3JpcHRpb25fcmVndWxhcl9jaGFyZ2UiClNVQlNDUklQVElPTl9JUlJFR1VMQVJfQ0hBUkdFID0gInN1YnNjcmlwdGlvbl9pcnJlZ3VsYXJfY2hhcmdlIgpNT05USExZX1NVQlNDUklQVElPTl9DT1NUX0lOX0NFTlRTID0gMzkwMAoKIyBUaGUgc3Vic2NyaXB0aW9uIGJpbGxpbmcgcGVyaW9kIHN0YXJ0IHRpbWUgc3BlY2lmaWVkIGhlcmUgaXMgaW4gVVRDLgpTVUJTQ1JJUFRJT05fQklMTElOR19QRVJJT0RfU1RBUlRfVElNRSA9IHsKICAgICJob3VyIjogNSwKICAgICJtaW51dGUiOiAwLAogICAgInNlY29uZCI6IDAKfQoKQUNUSVZBVElPTl9LRVlfSU5DT1JSRUNUX0xFTkdUSCA9IHsKICAgICJ0aXRsZSI6ICJBY3RpdmF0aW9uIEtleSBub3QgTG9uZyBFbm91Z2giLAogICAgImNvbnRlbnQiOiAoIkFsbCBhY3RpdmF0aW9uIGtleXMgYXJlIDYgY2hhcmFjdGVycy4gIgogICAgICAgICAgICAgICAgIlRoZSBhY3RpdmF0aW9uIGtleSB5b3UgZW50ZXJlZCB3YXMgbm90IGxvbmcgZW5vdWdoIHRvIGJlIHZhbGlkLiAiKQp9CgpBQ1RJVkFUSU9OX0tFWV9BTFJFQURZX1VTRUQgPSB7CiAgICAidGl0bGUiOiAiQWN0aXZhdGlvbiBLZXkgQWxyZWFkeSBVc2VkIiwKICAgICJjb250ZW50IjogKCJUaGUgc3Vic2NyaXB0aW9uIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGtleSBoYXMgYWxyZWFkeSBiZWVuICIKICAgICAgICAgICAgICAgICJhdHRhY2hlZCB0byBhIGJpa2UuIFBsZWFzZSBjb250YWN0IHN1cHBvcnQgZm9yIG1vcmUgYXNzaXN0YW5jZS4iKQp9CgpBQ1RJVkFUSU9OX0tFWV9OT1RfTUFUQ0ggPSB7CiAgICAidGl0bGUiOiAiSW52YWxpZCBBY3RpdmF0aW9uIEtleSIsCiAgICAiY29udGVudCI6ICgiVGhpcyBhY3RpdmF0aW9uIGtleSBkb2VzIG5vdCBtYXRjaCBhbnkgc3Vic2NyaXB0aW9ucy4gIgogICAgICAgICAgICAgICAgIkNoZWNrIHRoYXQgYWxsIG9mIHRoZSBkaWdpdHMgbWF0Y2ggdGhlIGFjdGl2YXRpb24ga2V5IHlvdSByZWNlaXZlZC4iKQp9CgpDSEFSR0VfU1RBVFVTID0gRW51bSh7InN1Y2Nlc3MiLCAiZmFpbHVyZSJ9KQpDSEFSR0VfQUNUSU9OID0gRW51bSh7InJldHJpZXZlX2JpbGxpbmdfemlwY29kZSIsCiAgICAgICAgICAgICAgICAgICAgICAiY2FsY3VsYXRlX3RheCIsCiAgICAgICAgICAgICAgICAgICAgICAic3VibWl0X3RheCJ9KQpDSEFSR0VfV0FSTklOR1MgPSBmcm96ZW5kaWN0KHsKICAgIENIQVJHRV9BQ1RJT04uUkVUUklFVkVfQklMTElOR19aSVBDT0RFOiAiQ291bGQgbm90IHJldHJpZXZlIGJpbGxpbmcgemlwY29kZSBmb3IgVXNlcjoge2lkfSIsCiAgICBDSEFSR0VfQUNUSU9OLkNBTENVTEFURV9UQVg6ICJDb3VsZCBub3QgY2FsY3VsYXRlIHRheCBmb3IgU3Vic2NyaXB0aW9uOiB7aWR9IiwKICAgIENIQVJHRV9BQ1RJT04uU1VCTUlUX1RBWDogIkNvdWxkIG5vdCByZWNvcmQgdGF4IGZvciBTdWJzY3JpcHRpb246IHtpZH0iLAp9KQoKbG9nZ2VyID0gZ2V0X2FwcF9sb2dnZXIoJ2RhdGEubW9kZWxzLnN1YnNjcmlwdGlvbicpCgpUYXhSZXN1bHQgPSBuYW1lZHR1cGxlKAogICAgIlRheFJlc3VsdCIsCiAgICBbCiAgICAgICAgInRheF9pbl9jZW50cyIsCiAgICAgICAgInRheF9wYXJ0bmVyX2lkIgogICAgXSkKCkNoYXJnZVJlc3VsdCA9IG5hbWVkdHVwbGUoCiAgICAiQ2hhcmdlUmVzdWx0IiwKICAgIFsKICAgICAgICAiY2hhcmdlX2lkIiwKICAgICAgICAidGF4X2luX2NlbnRzIiwKICAgICAgICAidGF4X3BhcnRuZXJfaWQiCiAgICBdKQoKCmRlZiByZWNvcmRfbWV0cmljcyhhY3Rpb24sIHJlc291cmNlX2lkX2dldHRlcik6CiAgICBkZWYgd3JhcHBlcihmbik6CgogICAgICAgIEB3cmFwcyhmbikKICAgICAgICBkZWYgX3dyYXBwZXIoc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAgICAgcmVzb3VyY2VfaWQgPSByZXNvdXJjZV9pZF9nZXR0ZXIoc2VsZikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdmFsdWUgPSBmbihzZWxmLCAqYXJncywgKiprd2FyZ3MpCiAgICAgICAgICAgICAgICByZWNvcmRfY2hhcmdlX21ldHJpYyhDSEFSR0VfU1RBVFVTLlNVQ0NFU1MsIGFjdGlvbiwgcmVzb3VyY2VfaWQpCiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHJlY29yZF9jaGFyZ2VfbWV0cmljKENIQVJHRV9TVEFUVVMuRkFJTFVSRSwgYWN0aW9uLCByZXNvdXJjZV9pZCkKICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgIHJldHVybiBfd3JhcHBlcgoKICAgIHJldHVybiB3cmFwcGVyCgoKY2xhc3MgU3Vic2NyaXB0aW9uTWFuYWdlcihTb2Z0RGVsZXRlTWFuYWdlck1peGluLCBQb3N0Z3Jlc01hbmFnZXIpOgoKICAgIEBzdGF0c2QudGltZWQoInN1YnNjcmlwdGlvbi5nZXRfYWxsX3dpdGhfYmFsYW5jZSIpCiAgICBkZWYgZ2V0X2FsbF93aXRoX2JhbGFuY2Uoc2VsZik6CiAgICAgICAgcmV0dXJuIFtzIGZvciBzIGluIHNlbGYuZ2V0X2FsbCgpIGlmIHMuYmFsYW5jZV9pbl9tb250aHMgPiAwXQoKICAgIEBzdGF0c2QudGltZWQoInN1YnNjcmlwdGlvbi5nZXRfYWxsX3Nob3VsZF9kZWJpdCIpCiAgICBkZWYgZ2V0X2FsbF9zaG91bGRfZGViaXQoc2VsZiwgZW5kX3RpbWU9Tm9uZSk6CiAgICAgICAgaWYgZW5kX3RpbWUgaXMgTm9uZToKICAgICAgICAgICAgZW5kX3RpbWUgPSBhcnJvdy51dGNub3coKS50aW1lc3RhbXAKICAgICAgICByZXR1cm4gW3MgZm9yIHMgaW4gc2VsZi5nZXRfYWxsKCkgaWYgcy5zaG91bGRfZGViaXQoZW5kX3RpbWUpXQoKICAgIGRlZiBnZXRfYWxsX2JpbGxlZChzZWxmLCBzdGFydF90aW1lPU5vbmUsIGVuZF90aW1lPU5vbmUpOgogICAgICAgIGlmIG5vdCBlbmRfdGltZToKICAgICAgICAgICAgZW5kX3RpbWUgPSBhcnJvdy51dGNub3coKS50aW1lc3RhbXAKICAgICAgICBpZiBub3Qgc3RhcnRfdGltZToKICAgICAgICAgICAgc3RhcnRfdGltZSA9IGRhdGV0aW1lX3RvX2Vwb2NoKGVwb2NoX3RvX2RhdGV0aW1lKGVuZF90aW1lKSAtIHJlbGF0aXZlZGVsdGEoZGF5cz0xKSkKCiAgICAgICAgcmV0dXJuIHNlbGYuc2VhcmNoKAogICAgICAgICAgICBsYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0X19ndD1zdGFydF90aW1lLAogICAgICAgICAgICBsYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0X19sdGU9ZW5kX3RpbWUpCgogICAgZGVmIGdldF9hbGxfYmlsbGluZ19mYWlsZWQoc2VsZiwgc3RhcnRfdGltZT1Ob25lLCBlbmRfdGltZT1Ob25lKToKICAgICAgICBpZiBub3QgZW5kX3RpbWU6CiAgICAgICAgICAgIGVuZF90aW1lID0gYXJyb3cudXRjbm93KCkudGltZXN0YW1wCiAgICAgICAgaWYgbm90IHN0YXJ0X3RpbWU6CiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSBkYXRldGltZV90b19lcG9jaChlcG9jaF90b19kYXRldGltZShlbmRfdGltZSkgLSByZWxhdGl2ZWRlbHRhKGRheXM9MSkpCgogICAgICAgIHJldHVybiBzZWxmLnNlYXJjaCgKICAgICAgICAgICAgbGFzdF9iaWxsaW5nX2ZhaWxlZF9hdF9fZ3Q9c3RhcnRfdGltZSwKICAgICAgICAgICAgbGFzdF9iaWxsaW5nX2ZhaWxlZF9hdF9fbHRlPWVuZF90aW1lKQoKICAgIGRlZiBnZXRfd2FybmluZ19wZXJpb2Rfc3Vic2NyaXB0aW9ucyhzZWxmKToKICAgICAgICBzdWJzY3JpcHRpb25zID0gc2VsZi5zZWFyY2goCiAgICAgICAgICAgIGNhbmNlbGxlZF9vbl9faXNfbnVsbD1UcnVlLAogICAgICAgICAgICBhY3RpdmF0ZWRfb25fX2lzX25vdF9udWxsPVRydWUsCiAgICAgICAgICAgIGxhc3RfYmlsbGluZ19mYWlsZWRfYXRfX2lzX25vdF9udWxsPVRydWUsCiAgICAgICAgICAgIGxhc3RfYmlsbGluZ19mYWlsZWRfYXRfX2d0ZT1hcnJvdy51dGNub3coKS50aW1lc3RhbXAgLSBHUkFDRV9QRVJJT0QpCgogICAgICAgIHJldHVybiBzb3J0ZWQoc3Vic2NyaXB0aW9ucywKICAgICAgICAgICAgICAgICAgICAgIGtleT1hdHRyZ2V0dGVyKCdsYXN0X2JpbGxpbmdfZmFpbGVkX2F0JyksCiAgICAgICAgICAgICAgICAgICAgICByZXZlcnNlPVRydWUpCgogICAgZGVmIGdldF9vdmVyZHVlX3N1YnNjcmlwdGlvbnMoc2VsZik6CiAgICAgICAgc3Vic2NyaXB0aW9ucyA9IHNlbGYuc2VhcmNoKAogICAgICAgICAgICBjYW5jZWxsZWRfb25fX2lzX251bGw9VHJ1ZSwKICAgICAgICAgICAgYWN0aXZhdGVkX29uX19pc19ub3RfbnVsbD1UcnVlLAogICAgICAgICAgICBsYXN0X2JpbGxpbmdfZmFpbGVkX2F0X19pc19ub3RfbnVsbD1UcnVlLAogICAgICAgICAgICBsYXN0X2JpbGxpbmdfZmFpbGVkX2F0X19sdD1hcnJvdy51dGNub3coKS50aW1lc3RhbXAgLSBHUkFDRV9QRVJJT0QpCgogICAgICAgIHJldHVybiBzb3J0ZWQoc3Vic2NyaXB0aW9ucywKICAgICAgICAgICAgICAgICAgICAgIGtleT1hdHRyZ2V0dGVyKCdsYXN0X2JpbGxpbmdfZmFpbGVkX2F0JyksCiAgICAgICAgICAgICAgICAgICAgICByZXZlcnNlPVRydWUpCgogICAgZGVmIHNlYXJjaF9ieV9pZF9zdGFydGluZ193aXRoKHNlbGYsIHByZWZpeCk6CiAgICAgICAgaWYgbm90IGNvbnZlcnRfc3RyaW5nX3RvX3V1aWQocHJlZml4KToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICByZXR1cm4gc2VsZi5zZWFyY2gocGtfX2xvd2VyX19zdGFydF93aXRoPWNvbnZlcnRfc3RyaW5nX3RvX3V1aWQocHJlZml4KSkKCgpjbGFzcyBTdWJzY3JpcHRpb24oU29mdERlbGV0ZU1peGluLCBQb3N0Z3Jlc01vZGVsLCBUaW1lc3RhbXBNaXhpbiwgQVBJTWl4aW4sIFN1YnNjcmlwdGlvbkNvbW1vbik6CiAgICBjbHVzdGVyX25hbWUgPSBNQUdJQ0hBVAoKICAgIEFDVElWQVRJT05fQ09ERV9MRU5HVEggPSA2CiAgICBNQVhfQUNUSVZBVElPTl9DT0RFX0dFTkVSQVRJT05fQVRURU1QVFMgPSAxMAogICAgQUNUSVZBVElPTl9LRVlfQUxQSEFCRVQgPSBzdHJpbmcuYXNjaWlfbG93ZXJjYXNlCiAgICBDT01NRVJDSUFMID0gJ2NvbW1lcmNpYWwnCiAgICBDT05TVU1FUiA9ICdjb25zdW1lcicKICAgIFNUUkVBTV9MSU1JVCA9IDMKICAgIFNVQlNDUklQVElPTl9UWVBFUyA9IChDT05TVU1FUiwgQ09NTUVSQ0lBTCkKCiAgICBNQVBQSU5HX1BST1BFUlRJRVMgPSAoCiAgICAgICAgSUQsCiAgICAgICAgVVNFUl9JRCwKICAgICAgICBCSUtFX0RFVklDRV9JRCwKICAgICAgICBERVZJQ0VfSUQsCiAgICAgICAgImRldmljZV9uYW1lIiwKICAgICAgICAiYmlrZV9kZXZpY2VfbmFtZSIsCiAgICAgICAgInRyZWFkX2RldmljZV9uYW1lIiwKICAgICAgICBERVZJQ0VfTEFTVF9BVFRBQ0hFRF9BVCwKICAgICAgICBGSVJTVF9BQ1RJVkFURURfT04sCiAgICAgICAgQUNUSVZBVEVEX09OLAogICAgICAgIElTX0FDVElWRSwKICAgICAgICBBQ0NFU1NfTEVWRUwsCiAgICAgICAgQ09TVF9JTl9DRU5UUywKICAgICAgICBDT1NUX0lOX0RPTExBUlMsCiAgICAgICAgImlzX2tpY2tzdGFydGVyIiwKICAgICAgICBTVEFUVVMsCiAgICAgICAgU1RBVFVTX1RFWFQsCiAgICAgICAgJ2Nhbl9wYXVzZScsCiAgICAgICAgJ2Nhbl91bnBhdXNlJywKICAgICAgICBDUkVBVEVEX0FULAogICAgICAgICJjcmVhdGVkX2NvdW50cnkiLAogICAgICAgIENBTkNFTExFRF9PTiwKICAgICAgICBMQVNUX0RFQklUX0FULAogICAgICAgIExBU1RfQklMTElOR19GQUlMRURfQVQsCiAgICAgICAgImJhbGFuY2VfaW5fbW9udGhzIiwKICAgICAgICAiYmFsYW5jZV9pbl9jZW50cyIsCiAgICAgICAgImZpcnN0X2JpbGxpbmdfcGVyaW9kX3N0YXJ0IiwKICAgICAgICAibmV4dF9iaWxsaW5nX3BlcmlvZF9zdGFydCIsCiAgICAgICAgInJlbWFpbmluZ193YWl2ZXJzIiwKICAgICAgICAid2FpdmVycyIsCiAgICAgICAgIndhaXZlcnNfdXNlZCIsCiAgICAgICAgT1JERVJfSUQsCiAgICAgICAgIm9yZGVyX2RhdGUiLAogICAgICAgICJvcmRlcl9jb25maXJtYXRpb25fY29kZSIsCiAgICAgICAgUFJFUEFJRF9DUkVESVRTLAogICAgICAgIFBSRVBBSURfQ1JFRElUU19VU0VELAogICAgICAgICJ0cmFuc2ZlcnJlZF90b19zdWJzY3JpcHRpb25faWQiLAogICAgICAgIFRSRUFEX0RFVklDRV9JRCwKICAgICAgICBOQU1FLAogICAgICAgICJuZXh0X2JpbGxpbmdfZGF0ZSIsCiAgICAgICAgInN1YnNjcmlwdGlvbl90eXBlIiwKICAgICAgICAicGF1c2VkX29uIiwKICAgICAgICAidW5wYXVzZWRfb24iLAogICAgICAgICdzdHJlYW1fbGltaXQnLAogICAgICAgICd0b3RhbF9hY3RpdmVfc3RyZWFtcycsCiAgICAgICAgJ2Fzc29jaWF0ZWRfY29tcG9uZW50cycsCiAgICAgICAgJ2Zvcm1hbF9hY3RpdmF0aW9uX2NvZGUnLAogICAgICAgICdjdXJyZW5jeScsCiAgICAgICAgJ2Zvcm1hdHRlZF9jb3N0JwogICAgKQoKICAgIE1BUFBJTkdfTzJNUyA9ICgnc2hhcmVkX3VzZXJfc2V0JywpCgogICAgbmFtZSA9IFVuaWNvZGUoTkFNRSkKICAgIGZpcnN0X2FjdGl2YXRlZF9vbiA9IEluc3RhbnQoRklSU1RfQUNUSVZBVEVEX09OKQogICAgYWN0aXZhdGVkX29uID0gSW5zdGFudChBQ1RJVkFURURfT04pCiAgICBpc19raWNrc3RhcnRlciA9IEJvb2xlYW4oImlzX2tpY2tzdGFydGVyIiwgZGVmYXVsdD1GYWxzZSkKICAgIGNvc3RfaW5fY2VudHMgPSBJbnRlZ2VyKENPU1RfSU5fQ0VOVFMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0PU1PTlRITFlfU1VCU0NSSVBUSU9OX0NPU1RfSU5fQ0VOVFMpCiAgICBjdXJyZW5jeSA9IE1lbWJlcigiY3VycmVuY3kiLCBDVVJSRU5DSUVTLCBkZWZhdWx0PVVTX0RPTExBUikKCiAgICB1c2VyX2lkID0gVXNlcklEKHJlcXVpcmVkPVRydWUpCiAgICB1c2VyID0gRm9yZWlnbktleSgiVXNlciIsIFVTRVJfSUQpCgogICAgIyBvcmRlciBpdGVtIHRoYXQgY3JlYXRlZCB0aGlzIHN1YnNjcmlwdGlvbgogICAgb3JkZXJfaXRlbV9pZCA9IE9yZGVySXRlbUlEKCkKICAgIG9yZGVyX2l0ZW0gPSBGb3JlaWduS2V5KCJPcmRlckl0ZW0iLCBPUkRFUl9JVEVNX0lEKQoKICAgICMgZHVwbGljYXRlIHRvIGJpa2VfZGV2aWNlX2lkLCBzdXBwb3J0IG9sZCBjbGllbnRzCiAgICBkZXZpY2VfaWQgPSBEZXZpY2VJRCgpCiAgICBkZXZpY2UgPSBGb3JlaWduS2V5KCJEZXZpY2UiLCBERVZJQ0VfSUQpCgogICAgYmlrZV9kZXZpY2VfaWQgPSBVVUlEKEJJS0VfREVWSUNFX0lEKQogICAgYmlrZV9kZXZpY2UgPSBGb3JlaWduS2V5KCJEZXZpY2UiLCBCSUtFX0RFVklDRV9JRCkKCiAgICB0cmVhZF9kZXZpY2VfaWQgPSBVVUlEKFRSRUFEX0RFVklDRV9JRCkKICAgIHRyZWFkX2RldmljZSA9IEZvcmVpZ25LZXkoIkRldmljZSIsIFRSRUFEX0RFVklDRV9JRCkKCiAgICBkZXZpY2VfbGFzdF9hdHRhY2hlZF9hdCA9IEluc3RhbnQoREVWSUNFX0xBU1RfQVRUQUNIRURfQVQpCgogICAgYmlrZV9kZXZpY2VfbGFzdF9hdHRhY2hlZF9hdCA9IEluc3RhbnQoQklLRV9ERVZJQ0VfTEFTVF9BVFRBQ0hFRF9BVCkKCiAgICB0cmVhZF9kZXZpY2VfbGFzdF9hdHRhY2hlZF9hdCA9IEluc3RhbnQoVFJFQURfREVWSUNFX0xBU1RfQVRUQUNIRURfQVQpCgogICAgY3JlYXRlZF9jb3VudHJ5ID0gTWVtYmVyKCJjcmVhdGVkX2NvdW50cnkiLCBDT1VOVFJJRVMpCiAgICBhY3RpdmF0ZWRfY291bnRyeSA9IFN0cmluZygiYWN0aXZhdGVkX2NvdW50cnkiKQogICAgX2JpbGxpbmdfY291bnRyeSA9IE1lbWJlcigiYmlsbGluZ19jb3VudHJ5IiwgQ09VTlRSSUVTKQoKICAgIF9wb3N0YWxfY29kZSA9IFN0cmluZygicG9zdGFsX2NvZGUiKQoKICAgIHdhaXZlcnMgPSBJbnRlZ2VyKFdBSVZFUlMpCiAgICB3YWl2ZXJzX3VzZWQgPSBJbnRlZ2VyKFdBSVZFUlNfVVNFRCkKICAgIHByZXBhaWRfY3JlZGl0cyA9IEludGVnZXIoUFJFUEFJRF9DUkVESVRTKQogICAgcHJlcGFpZF9jcmVkaXRzX3VzZWQgPSBJbnRlZ2VyKFBSRVBBSURfQ1JFRElUU19VU0VEKQogICAgY2FuY2VsbGVkX29uID0gSW5zdGFudChDQU5DRUxMRURfT04pCgogICAgcGF1c2VkX29uID0gSW5zdGFudCgicGF1c2VkX29uIikKICAgIHVucGF1c2VkX29uID0gSW5zdGFudCgidW5wYXVzZWRfb24iKQoKICAgIHRyYW5zZmVycmVkX2Zyb21fc3Vic2NyaXB0aW9uX2lkID0gU3Vic2NyaXB0aW9uSUQoCiAgICAgICAgInRyYW5zZmVycmVkX2Zyb21fc3Vic2NyaXB0aW9uX2lkIiwKICAgICAgICB1bmlxdWU9VHJ1ZSkKICAgIHRyYW5zZmVycmVkX2Zyb21fc3Vic2NyaXB0aW9uID0gRm9yZWlnbktleSgiU3Vic2NyaXB0aW9uIiwgInRyYW5zZmVycmVkX2Zyb21fc3Vic2NyaXB0aW9uX2lkIikKCiAgICAjIHRpbWUgbGFzdCBiaWxsaW5nIGZhaWxlZCBhdCwgc3VjY2Vzc2l2ZSBiaWxsaW5nIGZhaWx1cmVzIHdvdWxkIG5vdCBjaGFuZ2UgdGhpcyB2YWx1ZS4KICAgICMgaG93ZXZlciBpdCBpcyBjbGVhcmVkIG9uY2UgdGhlcmUncyBhIHN1Y2Nlc3NmdWwgYmlsbGluZwogICAgbGFzdF9iaWxsaW5nX2ZhaWxlZF9hdCA9IEluc3RhbnQoTEFTVF9CSUxMSU5HX0ZBSUxFRF9BVCkKCiAgICAjIHRpbWUgd2hlbiB3ZSBsYXN0IGF0dGVtcHRlZCB0byBiaWxsL2NoYXJnZSB0aGlzIHN1YnNjcmlwdGlvbgogICAgbGFzdF9iaWxsaW5nX2F0dGVtcHRlZF9hdCA9IEluc3RhbnQoTEFTVF9CSUxMSU5HX0FUVEVNUFRFRF9BVCkKCiAgICAjIHRpbWUgaW4gc2Vjb25kcyBzaW5jZSBlcG9jaCB0aGF0IHJlcHJlc2VudHMgdGhlIGJlZ2lubmluZyBvZiB0aGUgbW9zdCByZWNlbnRseSBwYWlkCiAgICAjIGJpbGxpbmcgcGVyaW9kCiAgICBsYXN0X2RlYml0X2F0ID0gSW5zdGFudChMQVNUX0RFQklUX0FUKQoKICAgICMgdG90YWwgbW9udGhzIGNoYXJnZWQsIHNvIGluc3RhbmNlLCBpZiBvbmUgY2hhcmdlKHVzaW5nIGNyZWRpdCBjYXIgb3IKICAgICMgd2FpdmVycykgY292ZXJzIDMgbW9udGhzLCB0aGUgdG90YWxfcGF5bWVudHMgc2hvdWxkIGJlIGluY3JlbWVudGVkIGJ5IDMuCiAgICB0b3RhbF9wYXltZW50cyA9IEludGVnZXIoVE9UQUxfUEFZTUVOVFMpCgogICAgYWN0aXZhdGlvbl9jb2RlID0gU3RyaW5nKCdhY3RpdmF0aW9uX2NvZGUnLCB1bmlxdWU9VHJ1ZSwgaW1tdXRhYmxlPVRydWUpCiAgICBzdWJzY3JpcHRpb25fdHlwZSA9IE1lbWJlcignc3Vic2NyaXB0aW9uX3R5cGUnLCBTVUJTQ1JJUFRJT05fVFlQRVMsIGRlZmF1bHQ9Q09OU1VNRVIpCiAgICBzaGFyZWRfdXNlcl9zZXQgPSBPbmVUb01hbnkoCiAgICAgICAgIlVzZXIiLAogICAgICAgIE1BR0lDSEFULAogICAgICAgIGJhY2tlbmQ9InBvc3RncmVzX21hbnlfdG9fbWFueSIsCiAgICAgICAgam9pbl90YWJsZT1zaGFyZWRfdXNlcl9hbmRfc2hhcmVkX3N1YnNjcmlwdGlvbl9qb2luX3RhYmxlLAogICAgICAgIGludmVydF9qb2luX3RhYmxlX3JlbGF0aW9ucz1UcnVlKQogICAgc3RyZWFtX2hpc3Rvcnlfc2V0ID0gT25lVG9NYW55KCJTdHJlYW1IaXN0b3J5IiwgT01NRUdBTkcpCgogICAgaXNfYXV0b21hdGVkX3Rlc3Rfc3Vic2NyaXB0aW9uID0gQm9vbGVhbihJU19BVVRPTUFURURfVEVTVF9TVUJTQ1JJUFRJT04pCiAgICBpc19lbXBsb3llZSA9IEJvb2xlYW4oImlzX2VtcGxveWVlIiwgZGVmYXVsdD1GYWxzZSwgaW1tdXRhYmxlPVRydWUpCgogICAgbWFuYWdlciA9IFN1YnNjcmlwdGlvbk1hbmFnZXIKCiAgICBkZWYgbWFwcGluZyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIG1hcHBpbmcgPSBzdXBlcihTdWJzY3JpcHRpb24sIHNlbGYpLm1hcHBpbmcoKmFyZ3MsICoqa3dhcmdzKQoKICAgICAgICBtYXBwaW5nWyJvd25lciJdID0gc2VsZi51c2VyLm1hcHBpbmcoKQoKICAgICAgICByZXR1cm4gbWFwcGluZwoKICAgIGRlZiBiZWZvcmVfY3JlYXRlKHNlbGYpOgogICAgICAgIHNlbGYuYWN0aXZhdGlvbl9jb2RlID0gc2VsZi5jcmVhdGVfYWN0aXZhdGlvbl9jb2RlKCkKCiAgICBkZWYgYWZ0ZXJfY3JlYXRlKHNlbGYpOgogICAgICAgIGlmIHNlbGYud2FpdmVycyAhPSAwOgogICAgICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25XYWl2ZXJIaXN0b3J5LnNhdmVfd2l0aCgKICAgICAgICAgICAgICAgIG1vZGlmaWVkX2J5X3VzZXJfaWQ9c2VsZi51c2VyX2lkLAogICAgICAgICAgICAgICAgd2FpdmVyX2tpbmQ9TW9kZWwuU3Vic2NyaXB0aW9uV2FpdmVySGlzdG9yeS5XQUlWRVJfS0lORF9DUkVBVElPTiwKICAgICAgICAgICAgICAgIHdhaXZlcl92YWx1ZT1zZWxmLndhaXZlcnMsCiAgICAgICAgICAgICAgICB3YWl2ZXJzX3JlbWFpbmluZz1zZWxmLnJlbWFpbmluZ193YWl2ZXJzLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgICkKCiAgICAgICAgc2VsZi51c2VyLnN1YnNjcmlwdGlvbl9zZXQuYWRkKHNlbGYpCgogICAgZGVmIGJlZm9yZV9kZXN0cm95KHNlbGYpOgogICAgICAgIGlmIHNlbGYuYmlrZV9kZXZpY2VfaWQ6CiAgICAgICAgICAgIGJpa2UgPSBzZWxmLmJpa2VfZGV2aWNlCiAgICAgICAgICAgIGJpa2Uuc3Vic2NyaXB0aW9uX2lkID0gTm9uZQogICAgICAgICAgICBiaWtlLnNhdmUoKQoKICAgICAgICBpZiBzZWxmLnRyZWFkX2RldmljZV9pZDoKICAgICAgICAgICAgdHJlYWQgPSBzZWxmLnRyZWFkX2RldmljZQogICAgICAgICAgICB0cmVhZC5zdWJzY3JpcHRpb25faWQgPSBOb25lCiAgICAgICAgICAgIHRyZWFkLnNhdmUoKQoKICAgICAgICBmb3IgdXNlciBpbiBzZWxmLnNoYXJlZF91c2VyX3NldDoKICAgICAgICAgICAgdXNlci5zaGFyZWRfc3Vic2NyaXB0aW9uX3NldC5yZW1vdmUoc2VsZikKICAgICAgICBzZWxmLnNoYXJlZF91c2VyX3NldC5kZXN0cm95KCkKCiAgICBkZWYgZGVzdHJveV90ZXN0X3N1YnNjcmlwdGlvbihzZWxmKToKICAgICAgICBpZiBzZWxmLmlzX2F1dG9tYXRlZF90ZXN0X3N1YnNjcmlwdGlvbjoKICAgICAgICAgICAgc2VsZi5kZXN0cm95KCkKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBEb2VzTm90VmFsaWRhdGUobWVzc2FnZT0iTm90IGEgdGVzdCBzdWJzY3JpcHRpb24iKQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIHJlZGVlbV9jb2RlKGNscywgb3duZXIsIGFjdGl2YXRpb25fY29kZSk6CiAgICAgICAgc3Vic2NyaXB0aW9uID0gY2xzLmdldF9ieV9hY3RpdmF0aW9uX2NvZGUoYWN0aXZhdGlvbl9jb2RlKQogICAgICAgIGZyb21fdXNlciA9IHN1YnNjcmlwdGlvbi51c2VyCiAgICAgICAgdG9fdXNlciA9IG93bmVyCiAgICAgICAgIyBkbyBub3QgYWxsb3cgdG9fdXNlciB0byBhdHRhY2ggYSBzdWJzY3JpcHRpb24gdG8gaGlzIGJpa2UgaWYgZnJvbV91c2VyCiAgICAgICAgIyBhbHJlYWR5IGF0dGFjaGVkIHRoZSBzdWJzY3JpcHRpb24gdG8gaGVyIGJpa2UuCiAgICAgICAgaWYgc3Vic2NyaXB0aW9uLmlzX2FjdGl2ZSBhbmQgKG5vdCBmcm9tX3VzZXIuaWQgPT0gdG9fdXNlci5pZCk6CiAgICAgICAgICAgIHJhaXNlIEludmFsaWRBY3RpdmF0aW9uQ29kZUVycm9yKG1lc3NhZ2U9QUNUSVZBVElPTl9LRVlfQUxSRUFEWV9VU0VEKQoKICAgICAgICBpZiBmcm9tX3VzZXIgIT0gdG9fdXNlcjoKICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVzZXJfaWQgPSBvd25lci5pZAogICAgICAgICAgICBzdWJzY3JpcHRpb24uc2F2ZSgpCiAgICAgICAgICAgIHRvX3VzZXIuc3Vic2NyaXB0aW9uX3NldC5hZGQoc3Vic2NyaXB0aW9uKQoKICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zdWJzY3JpcHRpb24uaWQsCiAgICAgICAgICAgIGluaXRpYXRvcl9pZD1vd25lci5pZCwKICAgICAgICAgICAgZGVzY3JpcHRpb249J0FjdGl2YXRpb24ga2V5ICVzIHVzZWQgdG8gdHJhbnNmZXIgc3Vic2NyaXB0aW9uIGZyb20gJXMgdG8gJXMnICUgKAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmZvcm1hbF9hY3RpdmF0aW9uX2NvZGUsCiAgICAgICAgICAgICAgICBmcm9tX3VzZXIuZW1haWwsCiAgICAgICAgICAgICAgICB0b191c2VyLmVtYWlsCiAgICAgICAgICAgICksCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9hY3Rpb249U1VCU0NSSVBUSU9OX0FDVElPTlNfRU5VTS5BQ1RJVkFUSU9OX0tFWV9VU0VELAogICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIgogICAgICAgICkKICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uCgogICAgZGVmIGF0dGFjaF9kZXZpY2UoCiAgICAgICAgICAgIHNlbGYsCiAgICAgICAgICAgIGRldmljZV9pZCwKICAgICAgICAgICAgZmlybXdhcmVfdmVyc2lvbj1Ob25lLAogICAgICAgICAgICBkZXZpY2VfbmFtZT1Ob25lLAogICAgICAgICAgICBkZXZpY2VfZ3JvdXA9QklLRSwKICAgICAgICAgICAgY291bnRyeT1Ob25lKToKICAgICAgICB3aXRoIGNvbnRleHRfbG9nZ2VyKGxvZ2dlci5pbmZvLCBsb2dnZXIuZXJyb3IsICJzdWJzY3JpcHRpb25fYXR0YWNoX2RldmljZSIpIGFzIGxvZzoKICAgICAgICAgICAgbG9nLm5ld19kZXZpY2VfaWQgPSBkZXZpY2VfaWQKICAgICAgICAgICAgbG9nLmRldmljZV9ncm91cCA9IGRldmljZV9ncm91cAogICAgICAgICAgICBsb2cuZmlybXdhcmVfdmVyc2lvbiA9IGZpcm13YXJlX3ZlcnNpb24KICAgICAgICAgICAgbG9nLnN1YnNjcmlwdGlvbl9pZCA9IHNlbGYuaWQKICAgICAgICAgICAgbG9nLmV4aXN0aW5nX2RldmljZV9pZCA9IHNlbGYuZGV2aWNlX2lkCiAgICAgICAgICAgIGxvZy5leGlzdGluZ19iaWtlX2RldmljZV9pZCA9IHNlbGYuYmlrZV9kZXZpY2VfaWQKICAgICAgICAgICAgbG9nLmV4aXN0aW5nX3RyZWFkX2RldmljZV9pZCA9IHNlbGYudHJlYWRfZGV2aWNlX2lkCgogICAgICAgICAgICBkZXZpY2UgPSBzZWxmLl9kZXRhY2hfYXR0YWNoZWRfc3Vic2NyaXB0aW9uX2Zyb21fY3VycmVudF9kZXZpY2UoCiAgICAgICAgICAgICAgICBkZXZpY2VfaWQsIGRldmljZV9ncm91cCkKCiAgICAgICAgICAgIHNlbGYuX2RldGFjaF9hdHRhY2hlZF9kZXZpY2VfZnJvbV9jdXJyZW50X3N1YnNjcmlwdGlvbihkZXZpY2VfZ3JvdXApCgogICAgICAgICAgICBub3cgPSBhcnJvdy51dGNub3coKS50aW1lc3RhbXAKICAgICAgICAgICAgaWYgbm90IGRldmljZToKICAgICAgICAgICAgICAgIGRldmljZSA9IE1vZGVsLkRldmljZS5nZXRfb3JfY3JlYXRlX2J5X2RldmljZV9pZChkZXZpY2VfaWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBkZXZpY2UubG9hZCgpCiAgICAgICAgICAgIGRldmljZV9pZCA9IGRldmljZS5pZAogICAgICAgICAgICBkZXZpY2UuZ3JvdXAgPSBkZXZpY2VfZ3JvdXAKICAgICAgICAgICAgaWYgZGV2aWNlX2dyb3VwID09IFRSRUFEOgogICAgICAgICAgICAgICAgc2VsZi50cmVhZF9kZXZpY2VfaWQgPSBkZXZpY2VfaWQKICAgICAgICAgICAgICAgIHNlbGYudHJlYWRfZGV2aWNlX2xhc3RfYXR0YWNoZWRfYXQgPSBub3cKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuYmlrZV9kZXZpY2VfaWQgPSBkZXZpY2VfaWQKICAgICAgICAgICAgICAgIHNlbGYuYmlrZV9kZXZpY2VfbGFzdF9hdHRhY2hlZF9hdCA9IG5vdwogICAgICAgICAgICAgICAgIyBzdXBwb3J0IG9sZCBjbGllbnRzCiAgICAgICAgICAgICAgICBzZWxmLmRldmljZV9pZCA9IGRldmljZV9pZAogICAgICAgICAgICAgICAgc2VsZi5kZXZpY2VfbGFzdF9hdHRhY2hlZF9hdCA9IG5vdwogICAgICAgICAgICAgICAgIyBub3Qgc3VwcG9ydCB0cmVhZCB5ZXQKICAgICAgICAgICAgICAgIEVxdWlwbWVudFNlcnZpY2UuYXNzb2NpYXRlX3N1YnNjcmlwdGlvbl93aXRoX2VxdWlwbWVudCgKICAgICAgICAgICAgICAgICAgICAiYmlrZSIsIHNlbGYuaWQsIHNlbGYudXNlcl9pZCkKICAgICAgICAgICAgaWYgZmlybXdhcmVfdmVyc2lvbjoKICAgICAgICAgICAgICAgIGRldmljZS5maXJtd2FyZV92ZXJzaW9uID0gZmlybXdhcmVfdmVyc2lvbgogICAgICAgICAgICAgICAgZGV2aWNlLmxhc3RfZmlybXdhcmVfdXBkYXRlX2F0ID0gbm93CiAgICAgICAgICAgIGlmIGRldmljZV9uYW1lOgogICAgICAgICAgICAgICAgZGV2aWNlLm5hbWUgPSBkZXZpY2VfbmFtZQogICAgICAgICAgICBkZXZpY2Uuc3Vic2NyaXB0aW9uX2lkID0gc2VsZi5pZAogICAgICAgICAgICBkZXZpY2Uuc2F2ZSgpCiAgICAgICAgICAgIHNlbGYuYWN0aXZhdGVkX2NvdW50cnkgPSBjb3VudHJ5CgogICAgICAgICAgICBpZiBub3Qgc2VsZi5hY3RpdmF0ZWRfb246CiAgICAgICAgICAgICAgICBzZWxmLmFjdGl2YXRlZF9vbiA9IG5vdwogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuZmlyc3RfYWN0aXZhdGVkX29uOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZmlyc3RfYWN0aXZhdGVkX29uID0gc2VsZi5hY3RpdmF0ZWRfb24KICAgICAgICAgICAgc2VsZi5zYXZlKCkKCiAgICAgICAgICAgICMgZGV2aWNlIGhhcyBiZWVuIGF0dGFjaGVkIGFuZCBhY3RpdmF0ZWQKICAgICAgICAgICAgc2VsZi5jcmVhdGVfYWN0aXZhdGlvbl90cmFuc2FjdGlvbigpCgogICAgICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25BdHRhY2hIaXN0b3J5LnNhdmVfd2l0aCgKICAgICAgICAgICAgICAgIGRldmljZV9pZD1kZXZpY2VfaWQsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ9c2VsZi5pZCwKICAgICAgICAgICAgICAgIGlzX2F0dGFjaG1lbnQ9VHJ1ZSkKCiAgICAgICAgICAgIEV2ZW50QnVzLnB1Ymxpc2goCiAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb25BY3RpdmF0ZWQoCiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKCiAgICBkZWYgX2RldGFjaF9hdHRhY2hlZF9zdWJzY3JpcHRpb25fZnJvbV9jdXJyZW50X2RldmljZShzZWxmLCBkZXZpY2VfaWQsIGRldmljZV9ncm91cCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZXZpY2UgPSBNb2RlbC5EZXZpY2UuZ2V0X2J5X2RldmljZV9pZChkZXZpY2VfaWQpCiAgICAgICAgZXhjZXB0IERvZXNOb3RFeGlzdDoKICAgICAgICAgICAgZGV2aWNlID0gTm9uZQogICAgICAgIGlmIGRldmljZSBhbmQgZGV2aWNlLnN1YnNjcmlwdGlvbl9pZCBhbmQgZGV2aWNlLnN1YnNjcmlwdGlvbl9pZCAhPSBzZWxmLmlkOgogICAgICAgICAgICBkZXZpY2Uuc3Vic2NyaXB0aW9uLmRldGFjaF9kZXZpY2UoZGV2aWNlX2dyb3VwPWRldmljZV9ncm91cCkKICAgICAgICByZXR1cm4gZGV2aWNlCgogICAgZGVmIF9kZXRhY2hfYXR0YWNoZWRfZGV2aWNlX2Zyb21fY3VycmVudF9zdWJzY3JpcHRpb24oc2VsZiwgZGV2aWNlX2dyb3VwKToKICAgICAgICBpZiBzZWxmLmJpa2VfZGV2aWNlX2lkIG9yIHNlbGYudHJlYWRfZGV2aWNlX2lkOgogICAgICAgICAgICBzZWxmLmRldGFjaF9kZXZpY2UoZGV2aWNlX2dyb3VwPWRldmljZV9ncm91cCkKCiAgICBkZWYgZGV0YWNoX2RldmljZShzZWxmLCBkZXZpY2VfZ3JvdXA9QklLRSk6CiAgICAgICAgZGV2aWNlX2lkID0gTm9uZQogICAgICAgIGlmIGRldmljZV9ncm91cCA9PSBUUkVBRCBhbmQgc2VsZi50cmVhZF9kZXZpY2VfaWQ6CiAgICAgICAgICAgIGRldmljZV9pZCA9IHNlbGYudHJlYWRfZGV2aWNlX2lkCiAgICAgICAgICAgIHRyZWFkID0gc2VsZi50cmVhZF9kZXZpY2UKICAgICAgICAgICAgdHJlYWQuc3Vic2NyaXB0aW9uX2lkID0gTm9uZQogICAgICAgICAgICB0cmVhZC5zYXZlKCkKICAgICAgICAgICAgc2VsZi50cmVhZF9kZXZpY2VfaWQgPSBOb25lCiAgICAgICAgZWxpZiBkZXZpY2VfZ3JvdXAgPT0gQklLRSBhbmQgc2VsZi5iaWtlX2RldmljZV9pZDoKICAgICAgICAgICAgZGV2aWNlX2lkID0gc2VsZi5iaWtlX2RldmljZV9pZAogICAgICAgICAgICBiaWtlID0gc2VsZi5iaWtlX2RldmljZQogICAgICAgICAgICBiaWtlLnN1YnNjcmlwdGlvbl9pZCA9IE5vbmUKICAgICAgICAgICAgYmlrZS5zYXZlKCkKICAgICAgICAgICAgc2VsZi5iaWtlX2RldmljZV9pZCA9IE5vbmUKICAgICAgICAgICAgIyBzdXBwb3J0IG9sZCBjbGllbnRzCiAgICAgICAgICAgIHNlbGYuZGV2aWNlX2lkID0gTm9uZQogICAgICAgICAgICAjIG5vdCBzdXBwb3J0IHRyZWFkIHlldAogICAgICAgICAgICBFcXVpcG1lbnRTZXJ2aWNlLmRpc2Fzc29jaWF0ZV9zdWJzY3JpcHRpb25fZnJvbV9lcXVpcG1lbnQoImJpa2UiLCBzZWxmLmlkKQogICAgICAgIGlmIGRldmljZV9pZDoKICAgICAgICAgICAgc2VsZi5zYXZlKCkKICAgICAgICAgICAgTW9kZWwuU3Vic2NyaXB0aW9uQXR0YWNoSGlzdG9yeS5zYXZlX3dpdGgoCiAgICAgICAgICAgICAgICBkZXZpY2VfaWQ9ZGV2aWNlX2lkLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgICAgICBpc19kZXRhY2htZW50PVRydWUpCgogICAgZGVmIGNyZWF0ZV9hY3RpdmF0aW9uX3RyYW5zYWN0aW9uKHNlbGYpOgoKICAgICAgICBpZiBzZWxmLmlzX2NvbW1lcmNpYWwgYW5kIHNlbGYuX2lzX2ZpcnN0X2FjdGl2YXRpb25fd2l0aF9jcmVkaXRzOgoKICAgICAgICAgICAgZXhwaXJlc19vbiA9IGFycm93LmdldChzZWxmLmFjdGl2YXRlZF9vbikuZmxvb3IoJ2RheScpCgogICAgICAgICAgICAjIGVhY2ggcHJlcGFpZF9jcmVkaXQgaXMgZm9yIG9uZSBtb250aAogICAgICAgICAgICBmb3IgXyBpbiByYW5nZShzZWxmLnByZXBhaWRfY3JlZGl0cyk6CiAgICAgICAgICAgICAgICBleHBpcmVzX29uID0gZXhwaXJlc19vbi5zaGlmdChtb250aHM9MSkKCiAgICAgICAgICAgIE1vZGVsLlN1YnNjcmlwdGlvblRyYW5zYWN0aW9uLnNhdmVfd2l0aCgKICAgICAgICAgICAgICAgIGJpbGxpbmdfcGVyaW9kPVtzZWxmLmFjdGl2YXRlZF9vbl0sCiAgICAgICAgICAgICAgICBjcmVkaXRzPXNlbGYucHJlcGFpZF9jcmVkaXRzLAogICAgICAgICAgICAgICAgZGVzY3JpcHRpb249J0FjdGl2YXRlZCB3aXRoIHByZXBhaWQgY3JlZGl0cycsCiAgICAgICAgICAgICAgICBwYXltZW50X3N0YXR1cz0ic3VjY2Vzc2Z1bCIsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fYWN0aW9uPVNVQlNDUklQVElPTl9BQ1RJT05TX0VOVU0uQUNUSVZBVEVEX1dJVEhfUFJFUEFJRF9DUkVESVRTLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2V4cGlyZXNfb249ZXhwaXJlc19vbi50aW1lc3RhbXAsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ9c2VsZi5pZCwKICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl90eXBlPSJkZXZpY2UiCiAgICAgICAgICAgICkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBfaXNfZmlyc3RfYWN0aXZhdGlvbl93aXRoX2NyZWRpdHMoc2VsZik6CiAgICAgICAgcmV0dXJuIChzZWxmLnByZXBhaWRfY3JlZGl0cyA+IDAgYW5kCiAgICAgICAgICAgICAgICBzZWxmLnByZXBhaWRfY3JlZGl0c191c2VkID09IDAgYW5kCiAgICAgICAgICAgICAgICBzZWxmLmFjdGl2YXRlZF9vbiA9PSBzZWxmLmZpcnN0X2FjdGl2YXRlZF9vbikKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBjcmVhdGVfYWN0aXZhdGlvbl9jb2RlKGNscyk6CiAgICAgICAgYXR0ZW1wdCA9IDAKICAgICAgICB3aGlsZSBhdHRlbXB0IDwgU3Vic2NyaXB0aW9uLk1BWF9BQ1RJVkFUSU9OX0NPREVfR0VORVJBVElPTl9BVFRFTVBUUzoKICAgICAgICAgICAgYWN0aXZhdGlvbl9jb2RlID0gJycuam9pbihyYW5kb20uc2FtcGxlKGNscy5BQ1RJVkFUSU9OX0tFWV9BTFBIQUJFVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNscy5BQ1RJVkFUSU9OX0NPREVfTEVOR1RIKSkKICAgICAgICAgICAgaWYgTW9kZWwuU3Vic2NyaXB0aW9uLm1hbmFnZXIuZXhpc3RzKGFjdGl2YXRpb25fY29kZT1hY3RpdmF0aW9uX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfaW5jbHVkZV9kZWxldGVkPVRydWUpOgogICAgICAgICAgICAgICAgYXR0ZW1wdCArPSAxCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aXZhdGlvbl9jb2RlCgogICAgICAgIHJhaXNlIERvZXNOb3RWYWxpZGF0ZSgKICAgICAgICAgICAgbWVzc2FnZT0nQ291bGQgbm90IGdlbmVyYXRlIGEgdW5pcXVlIGFjdGl2YXRpb24ga2V5IGFmdGVyICVkIGF0dGVtcHRzJyAlCiAgICAgICAgICAgICAgICAgICAgYXR0ZW1wdCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBnZXRfYnlfYWN0aXZhdGlvbl9jb2RlKGNscywgYWN0aXZhdGlvbl9jb2RlKToKICAgICAgICBpZiBhY3RpdmF0aW9uX2NvZGUgaXMgTm9uZSBvciBsZW4oYWN0aXZhdGlvbl9jb2RlKSA8IGNscy5BQ1RJVkFUSU9OX0NPREVfTEVOR1RIOgogICAgICAgICAgICByYWlzZSBJbnZhbGlkQWN0aXZhdGlvbkNvZGVFcnJvcihtZXNzYWdlPUFDVElWQVRJT05fS0VZX0lOQ09SUkVDVF9MRU5HVEgpCgogICAgICAgIHN1YnNjcmlwdGlvbiA9IE1vZGVsLlN1YnNjcmlwdGlvbi5tYW5hZ2VyLmZpbmRfc2luZ2xlKAogICAgICAgICAgICBhY3RpdmF0aW9uX2NvZGU9YWN0aXZhdGlvbl9jb2RlLmxvd2VyKCkpCgogICAgICAgIGlmIHN1YnNjcmlwdGlvbiBpcyBOb25lIG9yIHN1YnNjcmlwdGlvbi5pc19kZWxldGVkOgogICAgICAgICAgICByYWlzZSBJbnZhbGlkQWN0aXZhdGlvbkNvZGVFcnJvcihtZXNzYWdlPUFDVElWQVRJT05fS0VZX05PVF9NQVRDSCkKICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uCgogICAgQHByb3BlcnR5CiAgICBkZWYgY29zdF9pbl9kb2xsYXJzKHNlbGYpOgogICAgICAgIHJldHVybiBjZW50c190b19kb2xsYXJzKHNlbGYuY29zdF9pbl9jZW50cykKCiAgICBAcHJvcGVydHkKICAgIGRlZiBmb3JtYXR0ZWRfY29zdChzZWxmKToKICAgICAgICByZXR1cm4gZm9ybWF0X2NlbnRzX2FzX2N1cnJlbmN5KHNlbGYuY29zdF9pbl9jZW50cywgc2VsZi5jdXJyZW5jeSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpc19mcmVlX3N1YnNjcmlwdGlvbihzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5iYWxhbmNlX2luX2NlbnRzIDw9IDAKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpc19wYXlpbmcoc2VsZik6CiAgICAgICAgaWYgc2VsZi5pc191bnVzZWQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBpZiBzZWxmLmlzX2NhbmNlbGxlZCBhbmQgc2VsZi5iYWxhbmNlX2luX21vbnRocyA9PSAwOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgaWYgc2VsZi5pc19wYXVzZWQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBpZiBzZWxmLnJlbWFpbmluZ193YWl2ZXJzOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpc19jYW5jZWxsZWQoc2VsZik6CiAgICAgICAgcmV0dXJuIChzZWxmLmNhbmNlbGxlZF9vbiBhbmQKICAgICAgICAgICAgICAgIGFycm93LnV0Y25vdygpLnRpbWVzdGFtcCA+PSBzZWxmLmNhbmNlbGxlZF9vbikKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpc19wYXVzZWQoc2VsZik6CiAgICAgICAgY3VyX3RpbWUgPSBhcnJvdy51dGNub3coKS50aW1lc3RhbXAKICAgICAgICByZXR1cm4gKHNlbGYucGF1c2VkX29uIGFuZAogICAgICAgICAgICAgICAgc2VsZi51bnBhdXNlZF9vbiBhbmQKICAgICAgICAgICAgICAgIHNlbGYucGF1c2VkX29uIDw9IGN1cl90aW1lIDwgc2VsZi51bnBhdXNlZF9vbikKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpc19zY2hlZHVsZWRfZm9yX3BhdXNlKHNlbGYpOgogICAgICAgIHJldHVybiAoc2VsZi5pc19hY3RpdmUgYW5kCiAgICAgICAgICAgICAgICBzZWxmLnBhdXNlZF9vbiBhbmQgYXJyb3cudXRjbm93KCkudGltZXN0YW1wIDwgc2VsZi5wYXVzZWRfb24pCgogICAgQHByb3BlcnR5CiAgICBkZWYgcGF1c2VfbGVuZ3RoX2luX2RheXMoc2VsZik6CiAgICAgICAgZGF0ZV9kaWZmID0gZXBvY2hfdG9fZGF0ZXRpbWUoc2VsZi51bnBhdXNlZF9vbikgLSBlcG9jaF90b19kYXRldGltZShzZWxmLnBhdXNlZF9vbikKICAgICAgICByZXR1cm4gZGF0ZV9kaWZmLmRheXMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpc191bnVzZWQoc2VsZik6CiAgICAgICAgcmV0dXJuIG5vdCBzZWxmLmFjdGl2YXRlZF9vbiBhbmQgbm90IHNlbGYuaXNfY2FuY2VsbGVkIGFuZCBub3Qgc2VsZi5pc19wYXVzZWQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBpc19hY3RpdmUoc2VsZik6CiAgICAgICAgcmV0dXJuIChub3Qgc2VsZi5pc191bnVzZWQgYW5kCiAgICAgICAgICAgICAgICBub3Qgc2VsZi5pc19jYW5jZWxsZWQgYW5kCiAgICAgICAgICAgICAgICBub3Qgc2VsZi5pc19wYXVzZWQgYW5kCiAgICAgICAgICAgICAgICBzZWxmLmFjdGl2YXRlZF9vbiBhbmQKICAgICAgICAgICAgICAgIHNlbGYuYWN0aXZhdGVkX29uIDw9IGFycm93LnV0Y25vdygpLnRpbWVzdGFtcCBhbmQKICAgICAgICAgICAgICAgIChub3Qgc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0IG9yCiAgICAgICAgICAgICAgICAgc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0ICsgR1JBQ0VfUEVSSU9EID49IGFycm93LnV0Y25vdygpLnRpbWVzdGFtcCBvcgogICAgICAgICAgICAgICAgIHNlbGYuaXNfY29tbWVyY2lhbCkpCgogICAgQHByb3BlcnR5CiAgICBkZWYgaXNfaW5fZ3JhY2VfcGVyaW9kKHNlbGYpOgogICAgICAgIHJldHVybiAoc2VsZi5pc19hY3RpdmUgYW5kCiAgICAgICAgICAgICAgICAoc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0IGFuZAogICAgICAgICAgICAgICAgIHNlbGYubGFzdF9iaWxsaW5nX2ZhaWxlZF9hdCArIEdSQUNFX1BFUklPRCA+PSBhcnJvdy51dGNub3coKS50aW1lc3RhbXApKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGlzX3NjaGVkdWxlZF9mb3JfY2FuY2VsbGF0aW9uKHNlbGYpOgogICAgICAgIHJldHVybiAoc2VsZi5pc19hY3RpdmUgYW5kCiAgICAgICAgICAgICAgICBzZWxmLmNhbmNlbGxlZF9vbiBhbmQKICAgICAgICAgICAgICAgIGFycm93LnV0Y25vdygpLnRpbWVzdGFtcCA8IHNlbGYuY2FuY2VsbGVkX29uKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGlzX292ZXJkdWUoc2VsZik6CiAgICAgICAgcmV0dXJuIChub3Qgc2VsZi5pc191bnVzZWQgYW5kCiAgICAgICAgICAgICAgICBub3Qgc2VsZi5pc19jYW5jZWxsZWQgYW5kCiAgICAgICAgICAgICAgICBub3Qgc2VsZi5pc19wYXVzZWQgYW5kCiAgICAgICAgICAgICAgICAoc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0IGFuZAogICAgICAgICAgICAgICAgIHNlbGYubGFzdF9iaWxsaW5nX2ZhaWxlZF9hdCArIEdSQUNFX1BFUklPRCA8IGFycm93LnV0Y25vdygpLnRpbWVzdGFtcCkpCgogICAgQHByb3BlcnR5CiAgICBkZWYgaXNfb3ZlcmR1ZV9ub19wYXltZW50KHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLmlzX292ZXJkdWUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBvdmVyZHVlX3N0YXJ0X3RpbWUoc2VsZik6CiAgICAgICAgaWYgbm90IHNlbGYubGFzdF9iaWxsaW5nX2ZhaWxlZF9hdDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0ICsgR1JBQ0VfUEVSSU9ECgogICAgQHByb3BlcnR5CiAgICBkZWYgcmVxdWlyZXNfbWFrZXVwX3BheW1lbnQoc2VsZik6CiAgICAgICAgcmV0dXJuIGJvb2woc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0KQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHBhcmVudF9wYXltZW50X3R5cGUoc2VsZik6CiAgICAgICAgcmV0dXJuIE1vZGVsLlBhcmVudFBheW1lbnQuUGFyZW50VHlwZXMuREVWSUNFX1NVQlNDUklQVElPTgoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGFjY2Vzc19sZXZlbChzZWxmKToKICAgICAgICBpZiBzZWxmLmlzX3VudXNlZCBvciBzZWxmLmlzX2NhbmNlbGxlZDoKICAgICAgICAgICAgcmV0dXJuIElOQUNUSVZFCiAgICAgICAgaWYgc2VsZi5pc19hY3RpdmU6CiAgICAgICAgICAgIHJldHVybiBVTFRJTUFURQogICAgICAgIGlmIHNlbGYuaXNfb3ZlcmR1ZToKICAgICAgICAgICAgcmV0dXJuIEJBU0lDCgogICAgICAgICMgTm8gb3RoZXIgY2FzZXMgcG9zc2libGUsIHJldHVybiBCQVNJQwogICAgICAgIHJldHVybiBCQVNJQwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHN0YXR1cyhzZWxmKToKICAgICAgICBpZiBzZWxmLmlzX3VudXNlZDoKICAgICAgICAgICAgcmV0dXJuICd1bnVzZWQnCiAgICAgICAgZWxpZiBzZWxmLmlzX2FjdGl2ZToKICAgICAgICAgICAgaWYgc2VsZi5pc19zY2hlZHVsZWRfZm9yX2NhbmNlbGxhdGlvbjoKICAgICAgICAgICAgICAgIHJldHVybiAnYWN0aXZlX3NjaGVkdWxlZF9mb3JfY2FuY2VsbGF0aW9uJwogICAgICAgICAgICBpZiBzZWxmLmlzX2luX2dyYWNlX3BlcmlvZDoKICAgICAgICAgICAgICAgIHJldHVybiAnYWN0aXZlX2luX2dyYWNlX3BlcmlvZCcKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiAnYWN0aXZlX25vcm1hbCcKICAgICAgICBlbGlmIHNlbGYuaXNfb3ZlcmR1ZV9ub19wYXltZW50OgogICAgICAgICAgICByZXR1cm4gJ292ZXJkdWVfbm9fcGF5bWVudCcKICAgICAgICBlbGlmIHNlbGYuaXNfY2FuY2VsbGVkOgogICAgICAgICAgICByZXR1cm4gJ2NhbmNlbGxlZCcKICAgICAgICBlbGlmIHNlbGYuaXNfcGF1c2VkOgogICAgICAgICAgICByZXR1cm4gJ3BhdXNlZCcKCiAgICAgICAgIyBubyBvdGhlciBzdGF0dXNlcyBwb3NzaWJsZSwgcmV0dXJuICdjYW5jZWxsZWQnCiAgICAgICAgcmV0dXJuICdjYW5jZWxsZWQnCgogICAgQHByb3BlcnR5CiAgICBkZWYgc3RhdHVzX3RleHQoc2VsZik6CiAgICAgICAgcmV0dXJuIFNVQlNDUklQVElPTl9TVEFUVVNFUy5nZXQoc2VsZi5zdGF0dXMsIHNlbGYuc3RhdHVzKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNyZWF0aW9uX21ldGhvZF90ZXh0KHNlbGYpOgogICAgICAgIGlmIHNlbGYudHJhbnNmZXJyZWRfZnJvbV9zdWJzY3JpcHRpb246CiAgICAgICAgICAgIHJldHVybiAnVHJhbnNmZXInCiAgICAgICAgaWYgc2VsZi5vcmRlcl9pdGVtOgogICAgICAgICAgICByZXR1cm4gJ09yZGVyJwogICAgICAgIHJldHVybiAnTWFudWFsJwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIG9yZGVyX2lkKHNlbGYpOgogICAgICAgIGlmIHNlbGYub3JkZXJfaXRlbV9pZDoKICAgICAgICAgICAgcmV0dXJuIHNlbGYub3JkZXJfaXRlbS5vcmRlcl9pZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgQHByb3BlcnR5CiAgICBkZWYgb3JkZXJfY29uZmlybWF0aW9uX2NvZGUoc2VsZik6CiAgICAgICAgaWYgc2VsZi5vcmRlcl9pdGVtX2lkOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vcmRlcl9pdGVtLm9yZGVyLmNvbmZpcm1hdGlvbl9jb2RlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBjb3VudHJ5KHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIHNlbGYub3JkZXJfaXRlbS5vcmRlci5jb3VudHJ5CiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgQHByb3BlcnR5CiAgICBkZWYgcG9zdGFsX2NvZGUoc2VsZik6CiAgICAgICAgaWYgc2VsZi5fcG9zdGFsX2NvZGU6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9wb3N0YWxfY29kZQogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIHNlbGYub3JkZXJfaXRlbS5vcmRlci5zaGlwcGluZ19wb3N0YWxfY29kZQogICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvciBhcyBlOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGJpbGxpbmdfY291bnRyeShzZWxmKToKICAgICAgICBpZiBzZWxmLl9iaWxsaW5nX2NvdW50cnk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9iaWxsaW5nX2NvdW50cnkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLm9yZGVyX2l0ZW0ub3JkZXIuc2hpcHBpbmdfY291bnRyeQogICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvciBhcyBlOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIG9yZGVyX2RhdGUoc2VsZik6CiAgICAgICAgaWYgc2VsZi5vcmRlcl9pdGVtX2lkOgogICAgICAgICAgICByZXR1cm4gc2VsZi5vcmRlcl9pdGVtLm9yZGVyLmNyZWF0ZWRfYXQKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGZvcm1hbF9hY3RpdmF0aW9uX2NvZGUoc2VsZik6CiAgICAgICAgY29kZSA9IHNlbGYuYWN0aXZhdGlvbl9jb2RlLnVwcGVyKCkKICAgICAgICByZXR1cm4gJyVzLSVzJyAlIChjb2RlWzozXSwgY29kZVszOl0pCgogICAgQHByb3BlcnR5CiAgICBkZWYgZGV2aWNlX2NvdW50KHNlbGYpOgogICAgICAgIGNvdW50ID0gMAogICAgICAgIGlmIHNlbGYuYmlrZV9kZXZpY2VfaWQ6CiAgICAgICAgICAgIGNvdW50ICs9IDEKICAgICAgICBpZiBzZWxmLnRyZWFkX2RldmljZV9pZDoKICAgICAgICAgICAgY291bnQgKz0gMQogICAgICAgIHJldHVybiBjb3VudAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHBheW1lbnRfc2V0KHNlbGYpOgogICAgICAgIHBheW1lbnRzID0gW10KICAgICAgICBwYXJlbnRfcGF5bWVudHMgPSBNb2RlbC5QYXJlbnRQYXltZW50Lm1hbmFnZXIuc2VhcmNoKAogICAgICAgICAgICBwYXJlbnRfaWQ9c2VsZi5pZCwKICAgICAgICAgICAgcGFyZW50X3R5cGVfaWQ9c2VsZi5wYXJlbnRfcGF5bWVudF90eXBlLAogICAgICAgICkKICAgICAgICBpZiBsZW4ocGFyZW50X3BheW1lbnRzKToKICAgICAgICAgICAgcGF5bWVudHMgPSBbCiAgICAgICAgICAgICAgICBNb2RlbC5QYXltZW50Lm1hbmFnZXIuZ2V0KHBhcmVudF9wYXltZW50LnBheW1lbnRfaWQpCiAgICAgICAgICAgICAgICBmb3IgcGFyZW50X3BheW1lbnQgaW4gcGFyZW50X3BheW1lbnRzCiAgICAgICAgICAgIF0KICAgICAgICByZXR1cm4gUGF5bWVudFNldCgKICAgICAgICAgICAgcGF5bWVudHM9cGF5bWVudHMsCiAgICAgICAgICAgIHBhcmVudF9pZD1zZWxmLmlkLAogICAgICAgICAgICBwYXJlbnRfdHlwZV9pZD1zZWxmLnBhcmVudF9wYXltZW50X3R5cGUsCiAgICAgICAgKQoKICAgICMgLS0gIwoKICAgIGRlZiBjcmVhdGVfdHJhbnNhY3Rpb24oc2VsZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFpZF9pbl9jZW50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4X3BhaWRfaW5fY2VudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfcGFydG5lciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ19wYXJ0bmVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BhcnRuZXJfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9tZXRob2Q9ImNyZWRpdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfbG9jYXRpb249U1VCU0NSSVBUSU9OX1JFR1VMQVJfQ0hBUkdFLAogICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzZnVsPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheF9wYXJ0bmVyPU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheF9wYXJ0bmVyX2lkPU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfcGFydG5lcl9mZWVfaW5fY2VudHM9MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgKToKCiAgICAgICAgaXNfdGF4X3JlY29yZGVkX2F0X3BhcnRuZXIgPSB0YXhfcGFydG5lcl9pZCBpcyBub3QgTm9uZQoKICAgICAgICBtb250aGx5X2NoYXJnZSA9IHNlbGYuY29zdF9pbl9jZW50cwogICAgICAgIGlmIGlzX3ZhdF9jdXJyZW5jeShzZWxmLmN1cnJlbmN5KToKICAgICAgICAgICAgbW9udGhseV9jaGFyZ2UgLT0gdGF4X3BhaWRfaW5fY2VudHMKCiAgICAgICAgIyBpZiB5b3UgYXJlIGxvb2tpbmcgZm9yIGEgc3RhcnQvZW5kIGRhdGUgZXJyb3IgbG9vayBubyBmdXJ0aGVyCiAgICAgICAgbW9udGhzX3BhaWQgPSBwYWlkX2luX2NlbnRzIC8vIG1vbnRobHlfY2hhcmdlCgogICAgICAgIGxhc3RfZGViaXRfYXQgPSBzZWxmLmdldF9kZWJpdF90aW1lKG1vbnRoc19wYWlkKQogICAgICAgIGxhc3RfZGViaXRfZHQgPSBlcG9jaF90b19kYXRldGltZShsYXN0X2RlYml0X2F0KQogICAgICAgIGJpbGxpbmdfcGVyaW9kID0gW2xhc3RfZGViaXRfYXRdCgogICAgICAgIGlmIG1vbnRoc19wYWlkID4gMToKICAgICAgICAgICAgYmlsbGluZ19wZXJpb2RfZmlyc3QgPSBkYXRldGltZV90b19lcG9jaCgKICAgICAgICAgICAgICAgIGxhc3RfZGViaXRfZHQgLSByZWxhdGl2ZWRlbHRhKG1vbnRocz1tb250aHNfcGFpZCAtIDEpKQogICAgICAgICAgICBiaWxsaW5nX3BlcmlvZC5pbnNlcnQoMCwgYmlsbGluZ19wZXJpb2RfZmlyc3QpCgogICAgICAgIHNlbGYubGFzdF9iaWxsaW5nX2F0dGVtcHRlZF9hdCA9IGFycm93LnV0Y25vdygpLnRpbWVzdGFtcAogICAgICAgIGlmIHN1Y2Nlc3NmdWw6CiAgICAgICAgICAgIGlmIHNlbGYubGFzdF9iaWxsaW5nX2ZhaWxlZF9hdDoKICAgICAgICAgICAgICAgIGRlbCBzZWxmLmxhc3RfYmlsbGluZ19mYWlsZWRfYXQKICAgICAgICAgICAgc2VsZi5sYXN0X2RlYml0X2F0ID0gbGFzdF9kZWJpdF9hdAogICAgICAgICAgICBzZWxmLnRvdGFsX3BheW1lbnRzICs9IG1vbnRoc19wYWlkCiAgICAgICAgICAgIHNlbGYuc2F2ZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbm90IHNlbGYubGFzdF9iaWxsaW5nX2ZhaWxlZF9hdDoKICAgICAgICAgICAgICAgIHNlbGYubGFzdF9iaWxsaW5nX2ZhaWxlZF9hdCA9IHNlbGYubGFzdF9iaWxsaW5nX2F0dGVtcHRlZF9hdAogICAgICAgICAgICBzZWxmLnNhdmUoKQoKICAgICAgICBleHBpcmVzX29uID0gYXJyb3cuZ2V0KGJpbGxpbmdfcGVyaW9kWy0xXSkuc2hpZnQobW9udGhzPTEpLmZsb29yKCdkYXknKQoKICAgICAgICB0cmFuc2FjdGlvbiA9IE1vZGVsLlN0YW5kYXJkVHJhbnNhY3Rpb24ubmV3X3dpdGgoCiAgICAgICAgICAgIHNhdmU9VHJ1ZSwKICAgICAgICAgICAgYW1vdW50X2luX2NlbnRzPXBhaWRfaW5fY2VudHMsCiAgICAgICAgICAgIHRheF9pbl9jZW50cz10YXhfcGFpZF9pbl9jZW50cywKICAgICAgICAgICAgdGF4X3BhcnRuZXI9dGF4X3BhcnRuZXIsCiAgICAgICAgICAgIHRheF9wYXJ0bmVyX2lkPXRheF9wYXJ0bmVyX2lkLAogICAgICAgICAgICB0YXhfcmVjb3JkZWRfYXRfcGFydG5lcj1pc190YXhfcmVjb3JkZWRfYXRfcGFydG5lciwKICAgICAgICAgICAgYmlsbGluZ19wYXJ0bmVyPWJpbGxpbmdfcGFydG5lciwKICAgICAgICAgICAgYmlsbGluZ19wYXJ0bmVyX2lkPWJpbGxpbmdfcGFydG5lcl9pZCwKICAgICAgICAgICAgY2FwdHVyZV9sb2NhdGlvbj1jYXB0dXJlX2xvY2F0aW9uLAogICAgICAgICAgICBjdXJyZW5jeT1zZWxmLmN1cnJlbmN5LAogICAgICAgICAgICBjb3VudHJ5PXNlbGYuY291bnRyeSwKICAgICAgICAgICAgcGF5bWVudF9tZXRob2Q9cGF5bWVudF9tZXRob2QsCiAgICAgICAgICAgIHBvc3RhbF9jb2RlPXNlbGYucG9zdGFsX2NvZGUsCiAgICAgICAgICAgIHN0YXR1cz0ic3VjY2Vzc2Z1bCIgaWYgc3VjY2Vzc2Z1bCBlbHNlICJmYWlsZWQiLAogICAgICAgICAgICBkZXNjcmlwdGlvbj1iaWxsaW5nX3BhcnRuZXJfbWVzc2FnZSwKICAgICAgICAgICAgcGFyZW50X2lkPXNlbGYuaWQsCiAgICAgICAgICAgIHBhcmVudF90eXBlPSJTdWJzY3JpcHRpb24iLAogICAgICAgICAgICBiaWxsaW5nX3BhcnRuZXJfZmVlX2luX2NlbnRzPWJpbGxpbmdfcGFydG5lcl9mZWVfaW5fY2VudHMsCiAgICAgICAgKQoKICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgIGFtb3VudF9pbl9jZW50cz1wYWlkX2luX2NlbnRzLAogICAgICAgICAgICBiaWxsaW5nX3BlcmlvZD1iaWxsaW5nX3BlcmlvZCwKICAgICAgICAgICAgZGVzY3JpcHRpb249J1BhaWQgd2l0aCBjaGFyZ2UnIGlmIHN1Y2Nlc3NmdWwgZWxzZSAiQ2hhcmdlIGZhaWxlZCIsCiAgICAgICAgICAgIGluaXRpYXRvcl9pZD1zZWxmLnVzZXJfaWQsCiAgICAgICAgICAgIGlzX3RheF9jb2xsZWN0ZWQ9aXNfdGF4X3JlY29yZGVkX2F0X3BhcnRuZXIsCiAgICAgICAgICAgIHBheW1lbnRfc3RhdHVzPSJzdWNjZXNzZnVsIiBpZiBzdWNjZXNzZnVsIGVsc2UgImZhaWxlZCIsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9hY3Rpb249U1VCU0NSSVBUSU9OX0FDVElPTlNfRU5VTS5QQUlEX1dJVEhfQ0hBUkdFLAogICAgICAgICAgICBzdWJzY3JpcHRpb25fZXhwaXJlc19vbj1leHBpcmVzX29uLnRpbWVzdGFtcCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl90eXBlPSJkZXZpY2UiLAogICAgICAgICAgICB0YXhfY29sbGVjdGVkX2luX2NlbnRzPXRheF9wYWlkX2luX2NlbnRzLAogICAgICAgICAgICB0cmFuc2FjdGlvbl9pZD10cmFuc2FjdGlvbi5pZAogICAgICAgICkKCiAgICBkZWYgdXNlX3dhaXZlcihzZWxmKToKICAgICAgICB3aXRoIGNvbnRleHRfbG9nZ2VyKGxvZ2dlci5pbmZvLCBsb2dnZXIuZXJyb3IsICJ1c2Vfd2FpdmVyKCkiKSBhcyBsb2c6CiAgICAgICAgICAgIGxvZy5yZW1haW5pbmdfd2FpdmVycyA9IHNlbGYucmVtYWluaW5nX3dhaXZlcnMKICAgICAgICAgICAgbG9nLm1vbnRoc190b19iaWxsID0gTm9uZQogICAgICAgICAgICBsb2cud2FpdmVyc190b191c2UgPSBOb25lCiAgICAgICAgICAgIGxvZy53YWl2ZXJzX3VzZWQgPSBOb25lCiAgICAgICAgICAgIGxvZy5sYXN0X2RlYml0X2F0ID0gTm9uZQogICAgICAgICAgICBsb2cudG90YWxfcGF5bWVudHMgPSBOb25lCiAgICAgICAgICAgIGxvZy5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0ID0gTm9uZQogICAgICAgICAgICBpZiBzZWxmLnJlbWFpbmluZ193YWl2ZXJzOgogICAgICAgICAgICAgICAgbW9udGhzX3RvX2JpbGwgPSBzZWxmLmJhbGFuY2VfaW5fbW9udGhzCiAgICAgICAgICAgICAgICBsb2cubW9udGhzX3RvX2JpbGwgPSBtb250aHNfdG9fYmlsbAogICAgICAgICAgICAgICAgaWYgbW9udGhzX3RvX2JpbGwgPiAwOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYucmVtYWluaW5nX3dhaXZlcnMgPj0gbW9udGhzX3RvX2JpbGw6CiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXZlcnNfdG9fdXNlID0gbW9udGhzX3RvX2JpbGwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB3YWl2ZXJzX3RvX3VzZSA9IHNlbGYucmVtYWluaW5nX3dhaXZlcnMKICAgICAgICAgICAgICAgICAgICBsb2cud2FpdmVyc190b191c2UgPSB3YWl2ZXJzX3RvX3VzZQogICAgICAgICAgICAgICAgICAgIHNlbGYud2FpdmVyc191c2VkICs9IHdhaXZlcnNfdG9fdXNlCiAgICAgICAgICAgICAgICAgICAgbG9nLndhaXZlcnNfdXNlZCA9IHNlbGYud2FpdmVyc191c2VkCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sYXN0X2RlYml0X2F0ID0gc2VsZi5nZXRfZGViaXRfdGltZSh3YWl2ZXJzX3RvX3VzZSkKICAgICAgICAgICAgICAgICAgICBsb2cubGFzdF9kZWJpdF9hdCA9IHNlbGYubGFzdF9kZWJpdF9hdAogICAgICAgICAgICAgICAgICAgIHNlbGYudG90YWxfcGF5bWVudHMgKz0gd2FpdmVyc190b191c2UKICAgICAgICAgICAgICAgICAgICBsb2cudG90YWxfcGF5bWVudHMgPSBzZWxmLnRvdGFsX3BheW1lbnRzCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0ID0gYXJyb3cudXRjbm93KCkudGltZXN0YW1wCiAgICAgICAgICAgICAgICAgICAgbG9nLmxhc3RfYmlsbGluZ19hdHRlbXB0ZWRfYXQgPSBzZWxmLmxhc3RfYmlsbGluZ19hdHRlbXB0ZWRfYXQKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmxhc3RfYmlsbGluZ19mYWlsZWRfYXQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbCBzZWxmLmxhc3RfYmlsbGluZ19mYWlsZWRfYXQKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhdmUoKQoKICAgICAgICAgICAgICAgICAgICBsYXN0X2RlYml0X2R0ID0gZXBvY2hfdG9fZGF0ZXRpbWUoc2VsZi5sYXN0X2RlYml0X2F0KQogICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfcGVyaW9kID0gW3NlbGYubGFzdF9kZWJpdF9hdF0KICAgICAgICAgICAgICAgICAgICBpZiB3YWl2ZXJzX3RvX3VzZSA+IDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfcGVyaW9kX2ZpcnN0ID0gZGF0ZXRpbWVfdG9fZXBvY2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0X2RlYml0X2R0IC0gcmVsYXRpdmVkZWx0YShtb250aHM9d2FpdmVyc190b191c2UgLSAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ19wZXJpb2QuaW5zZXJ0KDAsIGJpbGxpbmdfcGVyaW9kX2ZpcnN0KQoKICAgICAgICAgICAgICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfcGVyaW9kPWJpbGxpbmdfcGVyaW9kLAogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzPXdhaXZlcnNfdG9fdXNlLAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj0nUGFpZCB3aXRoIHdhaXZlcicsCiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYXRvcl9pZD1zZWxmLnVzZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRfc3RhdHVzPSJzdWNjZXNzZnVsIiwKICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2FjdGlvbj1TVUJTQ1JJUFRJT05fQUNUSU9OU19FTlVNLlBBSURfV0lUSF9XQUlWRVIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgTW9kZWwuU3Vic2NyaXB0aW9uV2FpdmVySGlzdG9yeS5zYXZlX3dpdGgoCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkX2J5X3VzZXJfaWQ9c2VsZi51c2VyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICB3YWl2ZXJfa2luZD1Nb2RlbC5TdWJzY3JpcHRpb25XYWl2ZXJIaXN0b3J5LldBSVZFUl9LSU5EX1BBWU1FTlQsCiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXZlcl92YWx1ZT0td2FpdmVyc190b191c2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXZlcnNfcmVtYWluaW5nPXNlbGYucmVtYWluaW5nX3dhaXZlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkLAogICAgICAgICAgICAgICAgICAgICkKCiAgICBkZWYgY2xlYXJfcmVtYWluaW5nX3ByZXBhaWRfY3JlZGl0cyhzZWxmKToKICAgICAgICB3aXRoIGNvbnRleHRfbG9nZ2VyKGxvZ2dlci5pbmZvLCBsb2dnZXIuZXJyb3IsICJjbGVhcl9yZW1haW5pbmdfcHJlcGFpZF9jcmVkaXRzIikgYXMgbG9nOgogICAgICAgICAgICBzZWxmLnVzZV9wcmVwYWlkX2NyZWRpdCgKICAgICAgICAgICAgICAgIG1vbnRoc190b19iaWxsPXNlbGYucmVtYWluaW5nX3ByZXBhaWRfY3JlZGl0cywKICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9hY3Rpb249U1VCU0NSSVBUSU9OX0FDVElPTlNfRU5VTS5DTEVBUkVEX1BSRVBBSURfQ1JFRElUUywKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJDbGVhcmVkIHByZXBhaWQgY3JlZGl0cyIpCgogICAgZGVmIHVzZV9wcmVwYWlkX2NyZWRpdChzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICAgICBtb250aHNfdG9fYmlsbD1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fYWN0aW9uPVNVQlNDUklQVElPTl9BQ1RJT05TX0VOVU0uUEFJRF9XSVRIX1BSRVBBSURfQ1JFRElULAogICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj0iUGFpZCB3aXRoIHByZXBhaWQgY3JlZGl0Iik6CgogICAgICAgIHdpdGggY29udGV4dF9sb2dnZXIobG9nZ2VyLmluZm8sIGxvZ2dlci5lcnJvciwgInVzZV9wcmVwYWlkX2NyZWRpdCgpIikgYXMgbG9nOgogICAgICAgICAgICBsb2cucHJlcGFpZF9jcmVkaXRzID0gc2VsZi5yZW1haW5pbmdfcHJlcGFpZF9jcmVkaXRzCiAgICAgICAgICAgIGxvZy5tb250aHNfdG9fYmlsbCA9IE5vbmUKICAgICAgICAgICAgbG9nLnByZXBhaWRfY3JlZGl0c190b191c2UgPSBOb25lCiAgICAgICAgICAgIGxvZy5wcmVwYWlkX2NyZWRpdHNfdXNlZCA9IE5vbmUKICAgICAgICAgICAgbG9nLmxhc3RfZGViaXRfYXQgPSBOb25lCiAgICAgICAgICAgIGxvZy50b3RhbF9wYXltZW50cyA9IE5vbmUKICAgICAgICAgICAgbG9nLmxhc3RfYmlsbGluZ19hdHRlbXB0ZWRfYXQgPSBOb25lCiAgICAgICAgICAgIGlmIHNlbGYucmVtYWluaW5nX3ByZXBhaWRfY3JlZGl0czoKICAgICAgICAgICAgICAgIG1vbnRoc190b19iaWxsID0gbW9udGhzX3RvX2JpbGwgb3Igc2VsZi5iYWxhbmNlX2luX21vbnRocwogICAgICAgICAgICAgICAgbG9nLm1vbnRoc190b19iaWxsID0gbW9udGhzX3RvX2JpbGwKICAgICAgICAgICAgICAgIGlmIG1vbnRoc190b19iaWxsID4gMDoKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnJlbWFpbmluZ19wcmVwYWlkX2NyZWRpdHMgPj0gbW9udGhzX3RvX2JpbGw6CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXBhaWRfY3JlZGl0c190b191c2UgPSBtb250aHNfdG9fYmlsbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXBhaWRfY3JlZGl0c190b191c2UgPSBzZWxmLnJlbWFpbmluZ19wcmVwYWlkX2NyZWRpdHMKICAgICAgICAgICAgICAgICAgICBsb2cucHJlcGFpZF9jcmVkaXRzX3RvX3VzZSA9IHByZXBhaWRfY3JlZGl0c190b191c2UKICAgICAgICAgICAgICAgICAgICBzZWxmLnByZXBhaWRfY3JlZGl0c191c2VkICs9IHByZXBhaWRfY3JlZGl0c190b191c2UKICAgICAgICAgICAgICAgICAgICBsb2cucHJlcGFpZF9jcmVkaXRzX3VzZWQgPSBzZWxmLnByZXBhaWRfY3JlZGl0c191c2VkCiAgICAgICAgICAgICAgICAgICAgc2VsZi5sYXN0X2RlYml0X2F0ID0gc2VsZi5nZXRfZGViaXRfdGltZShwcmVwYWlkX2NyZWRpdHNfdG9fdXNlKQogICAgICAgICAgICAgICAgICAgIGxvZy5sYXN0X2RlYml0X2F0ID0gc2VsZi5sYXN0X2RlYml0X2F0CiAgICAgICAgICAgICAgICAgICAgc2VsZi50b3RhbF9wYXltZW50cyArPSBwcmVwYWlkX2NyZWRpdHNfdG9fdXNlCiAgICAgICAgICAgICAgICAgICAgbG9nLnRvdGFsX3BheW1lbnRzID0gc2VsZi50b3RhbF9wYXltZW50cwogICAgICAgICAgICAgICAgICAgIHNlbGYubGFzdF9iaWxsaW5nX2F0dGVtcHRlZF9hdCA9IGFycm93LnV0Y25vdygpLnRpbWVzdGFtcAogICAgICAgICAgICAgICAgICAgIGxvZy5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0ID0gc2VsZi5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0OgogICAgICAgICAgICAgICAgICAgICAgICBkZWwgc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlKCkKCiAgICAgICAgICAgICAgICAgICAgbGFzdF9kZWJpdF9kdCA9IGVwb2NoX3RvX2RhdGV0aW1lKHNlbGYubGFzdF9kZWJpdF9hdCkKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BlcmlvZCA9IFtzZWxmLmxhc3RfZGViaXRfYXRdCiAgICAgICAgICAgICAgICAgICAgaWYgcHJlcGFpZF9jcmVkaXRzX3RvX3VzZSA+IDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfcGVyaW9kX2ZpcnN0ID0gZGF0ZXRpbWVfdG9fZXBvY2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0X2RlYml0X2R0IC0gcmVsYXRpdmVkZWx0YShtb250aHM9cHJlcGFpZF9jcmVkaXRzX3RvX3VzZSAtIDEpKQogICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BlcmlvZC5pbnNlcnQoMCwgYmlsbGluZ19wZXJpb2RfZmlyc3QpCiAgICAgICAgICAgICAgICAgICAgTW9kZWwuU3Vic2NyaXB0aW9uVHJhbnNhY3Rpb24uc2F2ZV93aXRoKAogICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BlcmlvZD1iaWxsaW5nX3BlcmlvZCwKICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cz1wcmVwYWlkX2NyZWRpdHNfdG9fdXNlLAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj1kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhdG9yX2lkPXNlbGYudXNlcl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9zdGF0dXM9InN1Y2Nlc3NmdWwiLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fYWN0aW9uPXN1YnNjcmlwdGlvbl9hY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIgogICAgICAgICAgICAgICAgICAgICkKCiAgICBkZWYgdXNlX3N1YnNjcmlwdGlvbl9jcmVkaXQoc2VsZik6CiAgICAgICAgd2l0aCBjb250ZXh0X2xvZ2dlcihsb2dnZXIuaW5mbywgbG9nZ2VyLmVycm9yLCAidXNlX3N1YnNjcmlwdGlvbl9jcmVkaXQoKSIpIGFzIGxvZzoKICAgICAgICAgICAgbG9nLnVzZXJfaGFzX3JlbWFpbmluZ19zdWJzY3JpcHRpb25fY3JlZGl0cyA9ICgKICAgICAgICAgICAgICAgIHNlbGYudXNlci5oYXNfcmVtYWluaW5nX3N1YnNjcmlwdGlvbl9jcmVkaXQpCiAgICAgICAgICAgIGxvZy5tb250aHNfdG9fYmlsbCA9IE5vbmUKICAgICAgICAgICAgbG9nLnN1YnNjcmlwdGlvbl9jcmVkaXRzX3RvX3VzZSA9IE5vbmUKICAgICAgICAgICAgbG9nLnVzZXJfc3Vic2NyaXB0aW9uX2NyZWRpdHNfdG9fdXNlZCA9IE5vbmUKICAgICAgICAgICAgbG9nLnRvdGFsX3BheW1lbnRzID0gTm9uZQogICAgICAgICAgICBsb2cubGFzdF9kZWJpdF9hdCA9IE5vbmUKICAgICAgICAgICAgbG9nLmxhc3RfYmlsbGluZ19hdHRlbXB0ZWRfYXQgPSBOb25lCiAgICAgICAgICAgIGlmIHNlbGYudXNlci5oYXNfcmVtYWluaW5nX3N1YnNjcmlwdGlvbl9jcmVkaXQ6CiAgICAgICAgICAgICAgICBtb250aHNfdG9fYmlsbCA9IHNlbGYuYmFsYW5jZV9pbl9tb250aHMKICAgICAgICAgICAgICAgIGxvZy5tb250aHNfdG9fYmlsbCA9IG1vbnRoc190b19iaWxsCiAgICAgICAgICAgICAgICBpZiBtb250aHNfdG9fYmlsbCA+IDA6CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi51c2VyLnJlbWFpbmluZ19zdWJzY3JpcHRpb25fY3JlZGl0cyA+PSBtb250aHNfdG9fYmlsbDoKICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2NyZWRpdHNfdG9fdXNlID0gbW9udGhzX3RvX2JpbGwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fY3JlZGl0c190b191c2UgPSBzZWxmLnVzZXIucmVtYWluaW5nX3N1YnNjcmlwdGlvbl9jcmVkaXRzCgogICAgICAgICAgICAgICAgICAgICMgV2UgY2Fubm90IGRvIGNoYWluaW5nIGxpa2UgdGhpcyB5ZXQ6CiAgICAgICAgICAgICAgICAgICAgIyBzZWxmLnVzZXIuc3Vic2NyaXB0aW9uX2NyZWRpdHNfdXNlZCArPSBzdWJzY3JpcHRpb25fY3JlZGl0c190b191c2UKICAgICAgICAgICAgICAgICAgICAjIHNlbGYudXNlci5zYXZlKCkKICAgICAgICAgICAgICAgICAgICAjIEhlcmUgaXMgdGhlIGFsdGVybmF0aXZlOgogICAgICAgICAgICAgICAgICAgIGxvZy5zdWJzY3JpcHRpb25fY3JlZGl0c190b191c2UgPSBzdWJzY3JpcHRpb25fY3JlZGl0c190b191c2UKICAgICAgICAgICAgICAgICAgICB1c2VyID0gc2VsZi51c2VyCiAgICAgICAgICAgICAgICAgICAgdXNlci5zdWJzY3JpcHRpb25fY3JlZGl0c191c2VkICs9IHN1YnNjcmlwdGlvbl9jcmVkaXRzX3RvX3VzZQogICAgICAgICAgICAgICAgICAgIGxvZy51c2VyX3N1YnNjcmlwdGlvbl9jcmVkaXRzX3RvX3VzZWQgPSB1c2VyLnN1YnNjcmlwdGlvbl9jcmVkaXRzX3VzZWQKICAgICAgICAgICAgICAgICAgICB1c2VyLnNhdmUoKQogICAgICAgICAgICAgICAgICAgIE1vZGVsLlN1YnNjcmlwdGlvbkNyZWRpdFRyYW5zYWN0aW9uLnJlZ2lzdGVyKAogICAgICAgICAgICAgICAgICAgICAgICB1c2VyPXVzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZT1Nb2RlbC5TdWJzY3JpcHRpb25DcmVkaXRUcmFuc2FjdGlvbi5DUkVESVRfVVNFRCwKICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uPXNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZT0tc3Vic2NyaXB0aW9uX2NyZWRpdHNfdG9fdXNlKQoKICAgICAgICAgICAgICAgICAgICBzZWxmLnRvdGFsX3BheW1lbnRzICs9IHN1YnNjcmlwdGlvbl9jcmVkaXRzX3RvX3VzZQogICAgICAgICAgICAgICAgICAgIGxvZy50b3RhbF9wYXltZW50cyA9IHNlbGYudG90YWxfcGF5bWVudHMKICAgICAgICAgICAgICAgICAgICBzZWxmLmxhc3RfZGViaXRfYXQgPSBzZWxmLmdldF9kZWJpdF90aW1lKHN1YnNjcmlwdGlvbl9jcmVkaXRzX3RvX3VzZSkKICAgICAgICAgICAgICAgICAgICBsb2cubGFzdF9kZWJpdF9hdCA9IHNlbGYubGFzdF9kZWJpdF9hdAogICAgICAgICAgICAgICAgICAgIHNlbGYubGFzdF9iaWxsaW5nX2F0dGVtcHRlZF9hdCA9IGFycm93LnV0Y25vdygpLnRpbWVzdGFtcAogICAgICAgICAgICAgICAgICAgIGxvZy5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0ID0gc2VsZi5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0CiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0OgogICAgICAgICAgICAgICAgICAgICAgICBkZWwgc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlKCkKCiAgICAgICAgICAgICAgICAgICAgbGFzdF9kZWJpdF9kdCA9IGVwb2NoX3RvX2RhdGV0aW1lKHNlbGYubGFzdF9kZWJpdF9hdCkKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BlcmlvZCA9IFtzZWxmLmxhc3RfZGViaXRfYXRdCiAgICAgICAgICAgICAgICAgICAgaWYgc3Vic2NyaXB0aW9uX2NyZWRpdHNfdG9fdXNlID4gMToKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ19wZXJpb2RfZmlyc3QgPSBkYXRldGltZV90b19lcG9jaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfZGViaXRfZHQgLSByZWxhdGl2ZWRlbHRhKG1vbnRocz1zdWJzY3JpcHRpb25fY3JlZGl0c190b191c2UgLSAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgYmlsbGluZ19wZXJpb2QuaW5zZXJ0KDAsIGJpbGxpbmdfcGVyaW9kX2ZpcnN0KQoKICAgICAgICAgICAgICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfcGVyaW9kPWJpbGxpbmdfcGVyaW9kLAogICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzPXN1YnNjcmlwdGlvbl9jcmVkaXRzX3RvX3VzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb249J1BhaWQgd2l0aCBzdWJzY3JpcHRpb24gY3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhdG9yX2lkPXNlbGYudXNlcl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9zdGF0dXM9InN1Y2Nlc3NmdWwiLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fYWN0aW9uPVNVQlNDUklQVElPTl9BQ1RJT05TX0VOVU0uUEFJRF9XSVRIX1NVQlNDUklQVElPTl9DUkVESVQsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIikKCiAgICBAcHJvcGVydHkKICAgIGRlZiB0cmFuc2ZlcnJlZF90b19zdWJzY3JpcHRpb24oc2VsZik6CiAgICAgICAgcmV0dXJuIE1vZGVsLlN1YnNjcmlwdGlvbi5tYW5hZ2VyLmZpbmRfZmlyc3QodHJhbnNmZXJyZWRfZnJvbV9zdWJzY3JpcHRpb25faWQ9c2VsZi5pZCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiB0cmFuc2ZlcnJlZF90b19zdWJzY3JpcHRpb25faWQoc2VsZik6CiAgICAgICAgc3Vic2NyaXB0aW9uID0gc2VsZi50cmFuc2ZlcnJlZF90b19zdWJzY3JpcHRpb24KICAgICAgICBpZiBzdWJzY3JpcHRpb246CiAgICAgICAgICAgIHJldHVybiBzdWJzY3JpcHRpb24uaWQKICAgICAgICByZXR1cm4gTm9uZQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGJhbGFuY2VfaW5fY2VudHMoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuYmFsYW5jZV9pbl9tb250aHMgKiBzZWxmLmNvc3RfaW5fY2VudHMKCiAgICBAcHJvcGVydHkKICAgIGRlZiBiYWxhbmNlX2luX2RvbGxhcnMoc2VsZik6CiAgICAgICAgcmV0dXJuIGNlbnRzX3RvX2RvbGxhcnMoc2VsZi5iYWxhbmNlX2luX2NlbnRzKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGJhbGFuY2VfaW5fbW9udGhzKHNlbGYpOgogICAgICAgICIiIlJldHVybnMgdGhlIG51bWJlciBvZiBtb250aHMgZHVlIGZvciBhIHN1YnNjcmlwdGlvbiIiIgoKICAgICAgICByZXR1cm4gc2VsZi5nZXRfYmFsYW5jZV9pbl9tb250aHMoKQoKICAgIGRlZiBfZ2V0X2JhbGFuY2VfaW5fbW9udGhzX3JlZmFjdG9yKHNlbGYsIGN1cnJlbnRfdGltZT1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBSZXR1cm5zIHRoZSBudW1iZXIgb2YgbW9udGhzIGR1ZSBmb3IgYSBzdWJzY3JpcHRpb24gaW4gYSBnaXZlbiB0aW1lCiAgICAgICAgUmV0dXJucyAwIG9yIDEKICAgICAgICAiIiIKICAgICAgICBjdXJyZW50X3RpbWUgPSBfZ2V0X2N1cnJlbnRfdGltZShjdXJyZW50X3RpbWUpCgogICAgICAgIGlmIHNlbGYuaXNfcGF1c2VkIG9yIHNlbGYuaXNfdW51c2VkIG9yIHNlbGYuaXNfY2FuY2VsbGVkIG9yIG5vdCBzZWxmLm5leHRfYmlsbGluZ19kYXRlOgogICAgICAgICAgICByZXR1cm4gMAogICAgICAgICMgVE9ETzogVXBkYXRlIG9uY2UgU1VTLTMyMyBpcyBpbXBsZW1lbnRlZAogICAgICAgIGlmIHNlbGYuaXNfb3ZlcmR1ZSBvciBzZWxmLmlzX2luX2dyYWNlX3BlcmlvZCBvciBzZWxmLm5leHRfYmlsbGluZ19kYXRlIDw9IGN1cnJlbnRfdGltZToKICAgICAgICAgICAgcmV0dXJuIDEKCiAgICAgICAgcmV0dXJuIDAKCiAgICBkZWYgX2dldF9iYWxhbmNlX2luX21vbnRoc19sZWdhY3koc2VsZiwgY3VycmVudF90aW1lPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIFJldHVybnMgdGhlIG51bWJlciBvZiBtb250aHMgZHVlIGZvciBhIHN1YnNjcmlwdGlvbiBpbiBhIGdpdmVuIHRpbWUKICAgICAgICBDYW4gYmUgPiAxIGluIHNvbWUgY2FzZXMgaW52b2x2aW5nIHBhdXNpbmcgb3IgZGVsaW5xdWVuY3kuCiAgICAgICAgIiIiCiAgICAgICAgY3VycmVudF90aW1lID0gX2dldF9jdXJyZW50X3RpbWUoY3VycmVudF90aW1lKQoKICAgICAgICBpZiBzZWxmLmlzX3VudXNlZDoKICAgICAgICAgICAgcmV0dXJuIDAKCiAgICAgICAgaWYgc2VsZi5pc19jYW5jZWxsZWQ6CiAgICAgICAgICAgIHJldHVybiAwCgogICAgICAgIGlmIHNlbGYuaXNfcGF1c2VkOgogICAgICAgICAgICByZXR1cm4gMAoKICAgICAgICBlbmQgPSBjdXJyZW50X3RpbWUKCiAgICAgICAgaWYgc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0IGFuZCBzZWxmLmxhc3RfYmlsbGluZ19mYWlsZWRfYXQgKyBHUkFDRV9QRVJJT0QgPCBlbmQ6CiAgICAgICAgICAgIHJldHVybiAxCgogICAgICAgIGVuZF9kdCA9IGVwb2NoX3RvX2RhdGV0aW1lKGVuZCkKCiAgICAgICAgaWYgc2VsZi5sYXN0X2RlYml0X2F0OgogICAgICAgICAgICBsYXN0X2RlYml0X2RhdGVfcGF1c2VfYWRqdXN0ZWQgPSBzZWxmLmxhc3RfZGViaXRfYXQKICAgICAgICAgICAgaWYgc2VsZi51bnBhdXNlZF9vbiBhbmQgc2VsZi5sYXN0X2RlYml0X2F0IDwgc2VsZi51bnBhdXNlZF9vbjoKICAgICAgICAgICAgICAgIGxlbmd0aF9vZl9wYXVzZSA9IHJlbGF0aXZlZGVsdGEoCiAgICAgICAgICAgICAgICAgICAgZXBvY2hfdG9fZGF0ZXRpbWUoCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudW5wYXVzZWRfb24pLCBlcG9jaF90b19kYXRldGltZSgKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wYXVzZWRfb24pKQogICAgICAgICAgICAgICAgbGFzdF9kZWJpdF9kYXRlX3BhdXNlX2FkanVzdGVkID0gZGF0ZXRpbWVfdG9fZXBvY2goCiAgICAgICAgICAgICAgICAgICAgZXBvY2hfdG9fZGF0ZXRpbWUoc2VsZi5sYXN0X2RlYml0X2F0KSArIGxlbmd0aF9vZl9wYXVzZSkKCiAgICAgICAgICAgIGlmIGVuZCA8IGxhc3RfZGViaXRfZGF0ZV9wYXVzZV9hZGp1c3RlZDoKICAgICAgICAgICAgICAgIHJldHVybiAwCgogICAgICAgICAgICBsYXN0X2RlYml0X2F0X2R0ID0gZXBvY2hfdG9fZGF0ZXRpbWUobGFzdF9kZWJpdF9kYXRlX3BhdXNlX2FkanVzdGVkKQogICAgICAgICAgICB0aW1lX2RpZmYgPSByZWxhdGl2ZWRlbHRhKGVuZF9kdCwgbGFzdF9kZWJpdF9hdF9kdCkKICAgICAgICAgICAgcmV0dXJuIHRpbWVfZGlmZi55ZWFycyAqIDEyICsgdGltZV9kaWZmLm1vbnRocwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGVuZCA8IHNlbGYuZmlyc3RfYmlsbGluZ19wZXJpb2Rfc3RhcnQ6CiAgICAgICAgICAgICAgICAjIFRoaXMgaXMgcG9zc2libGUgYmVjYXVzZSBmaXJzdCBiaWxsaW5nIHBlcmlvZCBzdGFydCB0aW1lIG1pZ2h0IGJlIGEgdGltZSBpbgogICAgICAgICAgICAgICAgIyB0aGUgZnV0dXJlLiBGb3IgaW5zdGFuY2UsIGlmIGEgc3Vic2NyaXB0aW9uIGlzIGFjdGl2YXRlZCBhdCAxMnBtIEVUIGFuZCB3ZSBhcmUKICAgICAgICAgICAgICAgICMgZGV0ZXJtaW5pbmcgdGhlIGJhbGFuY2UgYXQgNHBtIEVULCB0aGUgZmlyc3QgYmlsbGluZyBwZXJpb2Qgc3RhcnQgdGltZSBpcyAxMmFtCiAgICAgICAgICAgICAgICAjIHRoYXQgbmlnaHQuCiAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZmlyc3RfYmlsbGluZ19wZXJpb2Rfc3RhcnRfZHQgPSBlcG9jaF90b19kYXRldGltZSgKICAgICAgICAgICAgICAgICAgICBzZWxmLmZpcnN0X2JpbGxpbmdfcGVyaW9kX3N0YXJ0CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB0aW1lX2RpZmYgPSByZWxhdGl2ZWRlbHRhKGVuZF9kdCwgZmlyc3RfYmlsbGluZ19wZXJpb2Rfc3RhcnRfZHQpCiAgICAgICAgICAgICAgICByZXR1cm4gdGltZV9kaWZmLnllYXJzICogMTIgKyB0aW1lX2RpZmYubW9udGhzICsgMQoKICAgIGRlZiBnZXRfYmFsYW5jZV9pbl9tb250aHMoc2VsZiwgY3VycmVudF90aW1lPU5vbmUpOgogICAgICAgICIiIgogICAgICAgIFJldHVybnMgdGhlIG51bWJlciBvZiBtb250aHMgZHVlIGZvciBhIHN1YnNjcmlwdGlvbiBpbiBhIGdpdmVuIHRpbWUKICAgICAgICAiIiIKCiAgICAgICAgd2l0aCBjb250ZXh0X2xvZ2dlcigKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvLAogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yLAogICAgICAgICAgICAgICAgInN1YnNjcmlwdGlvbi5nZXRfYmFsYW5jZV9pbl9tb250aHMiCiAgICAgICAgKSBhcyBsb2c6CiAgICAgICAgICAgIGxvZy5jdXJyZW50X3RpbWUgPSBjdXJyZW50X3RpbWUKICAgICAgICAgICAgbG9nLnN1YnNjcmlwdGlvbl9pZCA9IHNlbGYuaWQKCiAgICAgICAgICAgIHJlZmFjdG9yX2VuYWJsZWQgPSBpc19iYWxhbmNlX2luX21vbnRoc19yZWZhY3Rvcl9lbmFibGVkKCkKICAgICAgICAgICAgYmFsYW5jZV9pbl9tb250aHNfZnJvbV9yZWZhY3RvciA9IHNlbGYuX2dldF9iYWxhbmNlX2luX21vbnRoc19yZWZhY3RvcigKICAgICAgICAgICAgICAgIGN1cnJlbnRfdGltZT1jdXJyZW50X3RpbWUsCiAgICAgICAgICAgICkKICAgICAgICAgICAgYmFsYW5jZV9pbl9tb250aHNfbGVnYWN5ID0gc2VsZi5fZ2V0X2JhbGFuY2VfaW5fbW9udGhzX2xlZ2FjeSgKICAgICAgICAgICAgICAgIGN1cnJlbnRfdGltZT1jdXJyZW50X3RpbWUsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIGxvZy5iYWxhbmNlX2luX21vbnRoc19mcm9tX3JlZmFjdG9yID0gYmFsYW5jZV9pbl9tb250aHNfZnJvbV9yZWZhY3RvcgogICAgICAgICAgICBsb2cuYmFsYW5jZV9pbl9tb250aHNfbGVnYWN5ID0gYmFsYW5jZV9pbl9tb250aHNfbGVnYWN5CgogICAgICAgICAgICBoYXNfYmFsYW5jZV9mcm9tX3JlZmFjdG9yID0gYm9vbChiYWxhbmNlX2luX21vbnRoc19mcm9tX3JlZmFjdG9yKQogICAgICAgICAgICBoYXNfYmFsYW5jZV9mcm9tX2xlZ2FjeSA9IGJvb2woYmFsYW5jZV9pbl9tb250aHNfbGVnYWN5KQogICAgICAgICAgICB2YWx1ZXNfYWdyZWUgPSAoCiAgICAgICAgICAgICAgICBoYXNfYmFsYW5jZV9mcm9tX3JlZmFjdG9yID09IGhhc19iYWxhbmNlX2Zyb21fbGVnYWN5CiAgICAgICAgICAgICkKICAgICAgICAgICAgbG9nLnZhbHVlc19hZ3JlZSA9IHZhbHVlc19hZ3JlZQogICAgICAgICAgICBzdGF0c2QuaW5jcmVtZW50KAogICAgICAgICAgICAgICAgInN1YnNjcmlwdGlvbi5nZXRfYmFsYW5jZV9pbl9tb250aHMiLAogICAgICAgICAgICAgICAgdGFncz1bCiAgICAgICAgICAgICAgICAgICAgInZhbHVlc19hZ3JlZTp7fSIuZm9ybWF0KHZhbHVlc19hZ3JlZSksCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICkKICAgICAgICAgICAgbG9nLnJlZmFjdG9yX2VuYWJsZWQgPSByZWZhY3Rvcl9lbmFibGVkCgogICAgICAgICAgICBpZiByZWZhY3Rvcl9lbmFibGVkOgogICAgICAgICAgICAgICAgcmV0dXJuIGJhbGFuY2VfaW5fbW9udGhzX2Zyb21fcmVmYWN0b3IKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiBiYWxhbmNlX2luX21vbnRoc19sZWdhY3kKCiAgICBAcHJvcGVydHkKICAgIGRlZiByZW1haW5pbmdfd2FpdmVycyhzZWxmKToKICAgICAgICBpZiBzZWxmLndhaXZlcnMgPj0gc2VsZi53YWl2ZXJzX3VzZWQ6CiAgICAgICAgICAgIHJldHVybiBzZWxmLndhaXZlcnMgLSBzZWxmLndhaXZlcnNfdXNlZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAwCgogICAgQHByb3BlcnR5CiAgICBkZWYgcmVtYWluaW5nX3ByZXBhaWRfY3JlZGl0cyhzZWxmKToKICAgICAgICBpZiBzZWxmLnByZXBhaWRfY3JlZGl0cyA+PSBzZWxmLnByZXBhaWRfY3JlZGl0c191c2VkOgogICAgICAgICAgICByZXR1cm4gc2VsZi5wcmVwYWlkX2NyZWRpdHMgLSBzZWxmLnByZXBhaWRfY3JlZGl0c191c2VkCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIDAKCiAgICBkZWYgZ2V0X3RyYW5zYWN0aW9ucyhzZWxmLCAqKmt3YXJncyk6CiAgICAgICAgcmV0dXJuIHNvcnRlZCgKICAgICAgICAgICAgTW9kZWwuU3Vic2NyaXB0aW9uVHJhbnNhY3Rpb24uc2VhcmNoKAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgICAgICAqKmt3YXJncyksCiAgICAgICAgICAgIGtleT1hdHRyZ2V0dGVyKCdjcmVhdGVkX2F0JyksCiAgICAgICAgICAgIHJldmVyc2U9VHJ1ZSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBsYXRlc3RfcGF5bWVudF9tZXRob2Qoc2VsZik6CiAgICAgICAgaWYgc2VsZi5pc19mcmVlX3N1YnNjcmlwdGlvbjoKICAgICAgICAgICAgcmV0dXJuIEZSRUUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxhdGVzdF90cmFuc2FjdGlvbiA9IE1vZGVsLlN0YW5kYXJkVHJhbnNhY3Rpb24uc2VhcmNoKAogICAgICAgICAgICAgICAgcGFyZW50X2lkPXNlbGYuaWQsCiAgICAgICAgICAgICAgICBzdGF0dXM9InN1Y2Nlc3NmdWwiLAogICAgICAgICAgICAgICAgX29yZGVyPSdjcmVhdGVkX2F0JywKICAgICAgICAgICAgICAgIF9yZXZlcnNlPVRydWUpWzBdCiAgICAgICAgICAgIHJldHVybiBsYXRlc3RfdHJhbnNhY3Rpb24ucGF5bWVudF9tZXRob2QKICAgICAgICBleGNlcHQgSW5kZXhFcnJvcjoKICAgICAgICAgICAgcmFpc2UgRG9lc05vdFZhbGlkYXRlKCdTdWJzY3JpcHRpb24gaGFzIG5vIHBheW1lbnQgdHJhbnNhY3Rpb24gaGlzdG9yeScpCgogICAgZGVmIGdldF93YWl2ZXJfaGlzdG9yaWVzKHNlbGYpOgogICAgICAgIHJldHVybiBzb3J0ZWQoCiAgICAgICAgICAgIE1vZGVsLlN1YnNjcmlwdGlvbldhaXZlckhpc3Rvcnkuc2VhcmNoKAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQpLAogICAgICAgICAgICBrZXk9YXR0cmdldHRlcignY3JlYXRlZF9hdCcpLAogICAgICAgICAgICByZXZlcnNlPVRydWUpCgogICAgQHByb3BlcnR5CiAgICBkZWYgY3JlYXRlX3JlYXNvbihzZWxmKToKICAgICAgICB0cmFuc2FjdGlvbiA9IE1vZGVsLlN1YnNjcmlwdGlvblRyYW5zYWN0aW9uLmZpbmRfc2luZ2xlKAogICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ9c2VsZi5pZCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2FjdGlvbj1TVUJTQ1JJUFRJT05fQUNUSU9OU19FTlVNLk1BTlVBTExZX0NSRUFURUQpCiAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uLmNyZWF0ZV9yZWFzb24gaWYgdHJhbnNhY3Rpb24gZWxzZSBOb25lCgogICAgQHByb3BlcnR5CiAgICBkZWYgbmV4dF9iaWxsaW5nX2RhdGUoc2VsZik6CiAgICAgICAgaWYgc2VsZi5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0IDwgc2VsZi5jdXJyZW50X2JpbGxpbmdfcGVyaW9kX3N0YXJ0OgogICAgICAgICAgICByZXR1cm4gc2VsZi5jdXJyZW50X2JpbGxpbmdfcGVyaW9kX3N0YXJ0CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHNlbGYubmV4dF9iaWxsaW5nX3BlcmlvZF9zdGFydAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGZpcnN0X2JpbGxpbmdfcGVyaW9kX3N0YXJ0KHNlbGYpOgogICAgICAgICIiIlJldHVybnMgdGhlIGVwb2NoIHRpbWUgZm9yIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGZpcnN0IGJpbGxpbmcgcGVyaW9kCgogICAgICAgIFRoaXMgaXMgc2V0IGF0IDVhbSBVVEMsIHdoaWNoIGlzIGdlbmVyYWxseSBtaWRuaWdodCBlYXN0ZXJuIHRpbWUuCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuYWN0aXZhdGVkX29uOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIHJldHVybiBzZWxmLm5vcm1hbGl6ZV9iaWxsaW5nX3BlcmlvZF9zdGFydF90aW1lKHNlbGYuYWN0aXZhdGVkX29uKQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBub3JtYWxpemVfYmlsbGluZ19wZXJpb2Rfc3RhcnRfdGltZShzdGFydF90aW1lKToKICAgICAgICBzdGFydF9kYXRlID0gZXBvY2hfdG9fZGF0ZXRpbWUoc3RhcnRfdGltZSkKICAgICAgICBjdXRvZmZfdGltZV9kdCA9IChzdGFydF9kYXRlIC0KICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRldGltZS50aW1lZGVsdGEoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzPXN0YXJ0X2RhdGUuaG91ciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlcz1zdGFydF9kYXRlLm1pbnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kcz1zdGFydF9kYXRlLnNlY29uZCkgKwogICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGV0aW1lLnRpbWVkZWx0YSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnM9U1VCU0NSSVBUSU9OX0JJTExJTkdfUEVSSU9EX1NUQVJUX1RJTUVbJ2hvdXInXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlcz1TVUJTQ1JJUFRJT05fQklMTElOR19QRVJJT0RfU1RBUlRfVElNRVsnbWludXRlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM9U1VCU0NSSVBUSU9OX0JJTExJTkdfUEVSSU9EX1NUQVJUX1RJTUVbJ3NlY29uZCddKSkKICAgICAgICBuZXh0X2N1dG9mZl90aW1lX2R0ID0gY3V0b2ZmX3RpbWVfZHQgKyBkYXRldGltZS50aW1lZGVsdGEoZGF5cz0xKQogICAgICAgIGlmIHN0YXJ0X2RhdGUgPCBjdXRvZmZfdGltZV9kdDoKICAgICAgICAgICAgcmV0dXJuIGRhdGV0aW1lX3RvX2Vwb2NoKGN1dG9mZl90aW1lX2R0KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBkYXRldGltZV90b19lcG9jaChuZXh0X2N1dG9mZl90aW1lX2R0KQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGN1cnJlbnRfYmlsbGluZ19wZXJpb2Rfc3RhcnQoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0X2JpbGxpbmdfcGVyaW9kX3N0YXJ0KCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBuZXh0X2JpbGxpbmdfcGVyaW9kX3N0YXJ0KHNlbGYpOgogICAgICAgIGN1cnJlbnRfYmlsbGluZ19wZXJpb2Rfc3RhcnQgPSBzZWxmLmN1cnJlbnRfYmlsbGluZ19wZXJpb2Rfc3RhcnQKICAgICAgICBpZiBub3QgY3VycmVudF9iaWxsaW5nX3BlcmlvZF9zdGFydDoKICAgICAgICAgICAgaWYgc2VsZi5pc191bnVzZWQgb3Igc2VsZi5pc19jYW5jZWxsZWQ6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZmlyc3RfYmlsbGluZ19wZXJpb2Rfc3RhcnQKICAgICAgICBlbHNlOgogICAgICAgICAgICBwZXJpb2Rfc3RhcnQgPSBkYXRldGltZV90b19lcG9jaCgKICAgICAgICAgICAgICAgIGVwb2NoX3RvX2RhdGV0aW1lKGN1cnJlbnRfYmlsbGluZ19wZXJpb2Rfc3RhcnQpICsKICAgICAgICAgICAgICAgIHJlbGF0aXZlZGVsdGEobW9udGhzPTEpKQogICAgICAgICAgICBpZiBzZWxmLmNhbmNlbGxlZF9vbiBhbmQgcGVyaW9kX3N0YXJ0ID49IHNlbGYuY2FuY2VsbGVkX29uOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiBwZXJpb2Rfc3RhcnQKCiAgICBkZWYgc2hvdWxkX2RlYml0KHNlbGYsIGVuZF90aW1lPU5vbmUpOgogICAgICAgICIiIlJldHVybnMgdHJ1ZSBpZiBzdWJzY3JpcHRpb24gc2hvdWxkIGJlIGRlYml0ZWQuCgogICAgICAgIFN1YnNjcmlwdGlvbiBzaG91bGQgYmUgZGViaXRlZCBpZiBpdCBoYXMgYSBiYWxhbmNlIGF0IGVuZCB0aW1lIGFuZCBpdHMKICAgICAgICBsYXN0X2JpbGxpbmdfZmFpbGVkX2F0IGlzIE5vbmUuCgogICAgICAgIFRoZSBhY3R1YWwgZGViaXQgc2hvdWxkIHN0aWxsIGNoZWNrIHRoZSBiYWxhbmNlIGF0IHRpbWUgb2YgZGViaXQgcHJpb3IgdG8gY2hhcmdpbmcgY3VzdG9tZXIuCgogICAgICAgICIiIgogICAgICAgIGlmIHNlbGYuaXNfZW1wbG95ZWU6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBpZiBzZWxmLmhhc19tdWx0aXBsZV9mYWlsZWRfYmlsbGluZ19hdHRlbXB0czoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIGlmIG5vdCBlbmRfdGltZToKICAgICAgICAgICAgZW5kX3RpbWUgPSBhcnJvdy51dGNub3coKS50aW1lc3RhbXAKCiAgICAgICAgaWYgc2VsZi5nZXRfYmFsYW5jZV9pbl9tb250aHMoZW5kX3RpbWUpOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGhhc19tdWx0aXBsZV9mYWlsZWRfYmlsbGluZ19hdHRlbXB0cyhzZWxmKToKICAgICAgICAiIiIKICAgICAgICBjcmVhdGVfdHJhbnNhY3Rpb24oKSBzZXRzIGxhc3RfYmlsbGluZ19hdHRlbXB0ZWRfYXQgd2hlbmV2ZXIgd2UgYXR0ZW1wdCBhCiAgICAgICAgY2hhcmdlLiBJZiB0aGUgY2hhcmdlIHN1Y2NlZWRzIHdlIGRlbCBsYXN0X2JpbGxpbmdfZmFpbGVkX2F0LiBJZiB0aGUgY2hhcmdlCiAgICAgICAgZmFpbHMgd2Ugc2V0IGxhc3RfYmlsbGluZ19mYWlsZWRfYXQgdG8gbGFzdF9iaWxsaW5nX2F0dGVtcHRlZF9hdCBpZgogICAgICAgIGxhc3RfYmlsbGluZ19mYWlsZWRfYXQgd2FzIG5vdCBhbHJlYWR5IHNldC4KCiAgICAgICAgSW4gb3RoZXIgd29yZHMsCiAgICAgICAgMSkgbGFzdF9iaWxsaW5nX2ZhaWxlZF9hdCBpcyBvbmx5IHNldCBpZiB0aGUgbGFzdCBhdHRlbXB0IHRvIGNoYXJnZSB0aGUKICAgICAgICBzdWJzY3JpcHRpb24gZmFpbGVkCiAgICAgICAgMikgSWYgbGFzdF9iaWxsaW5nX2ZhaWxlZF9hdCBpcyBub3QgdGhlIHNhbWUgYXMgbGFzdF9iaWxsaW5nX2F0dGVtcHRlZF9hdCwKICAgICAgICBjaGFyZ2luZyBtdXN0IGhhdmUgZmFpbGVkIGF0IGxlYXN0IHR3aWNlLgogICAgICAgICIiIgogICAgICAgIHJldHVybiAoc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0IGFuZAogICAgICAgICAgICAgICAgc2VsZi5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0ID4gc2VsZi5sYXN0X2JpbGxpbmdfZmFpbGVkX2F0KQoKICAgIGRlZiBfbm9fZGViaXRfc2luY2VfdW5wYXVzaW5nKHNlbGYpOgogICAgICAgIHJldHVybiAoc2VsZi51bnBhdXNlZF9vbiBhbmQKICAgICAgICAgICAgICAgIChzZWxmLmxhc3RfZGViaXRfYXQgPCBzZWxmLnVucGF1c2VkX29uKSBhbmQKICAgICAgICAgICAgICAgIChzZWxmLnVucGF1c2VkX29uIDw9IGFycm93LnV0Y25vdygpLnRpbWVzdGFtcCkpCgogICAgZGVmIGdldF9iaWxsaW5nX3BlcmlvZF9zdGFydChzZWxmLCBjdXJyZW50X3RpbWU9Tm9uZSk6CiAgICAgICAgIiIiUmV0dXJucywgaW4gc2Vjb25kcyBzaW5jZSBlcG9jaCwgdGhlIHN0YXJ0IG9mIHRoZSBiaWxsaW5nIHBlcmlvZCB0aGF0CiAgICAgICAgICAgIGVuY2xvc2VzIGN1cnJlbnRfdGltZQoKICAgICAgICBUaGlzIGlzIGFsd2F5cyBjYWxjdWxhdGVkIHJlbGF0aXZlIHRvIHRoZSBsYXN0X2RlYml0X2F0IHRpbWUsIGlmIGl0IGlzIHNldC4KICAgICAgICBPdGhlcndpc2UgaXQgZmFsbHMgYmFjayB0byB1c2UgYWN0aXZhdGVkX29uLgoKICAgICAgICBBcmdzOgogICAgICAgICAgICBjdXJyZW50X3RpbWU6IEEgdGltZSB0byBjYWxjdWxhdGUgdGhlIGVuY2xvc2luZyBiaWxsaW5nIHBlcmlvZCBmb3IsCiAgICAgICAgICAgIGluIHNlY29uZHMgc2luY2UgZXBvY2gKICAgICAgICAgICAgRGVmYXVsdHMgdG8gbm93IGlmIG5vdCBzcGVjaWZpZWQuCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuYWN0aXZhdGVkX29uOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICBpZiBub3QgY3VycmVudF90aW1lOgogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBhcnJvdy51dGNub3coKS50aW1lc3RhbXAKCiAgICAgICAgaWYgY3VycmVudF90aW1lIDwgc2VsZi5maXJzdF9iaWxsaW5nX3BlcmlvZF9zdGFydDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgaWYgc2VsZi5jYW5jZWxsZWRfb24gYW5kIGN1cnJlbnRfdGltZSA+IHNlbGYuY2FuY2VsbGVkX29uOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICBpZiBub3Qgc2VsZi5sYXN0X2RlYml0X2F0OgogICAgICAgICAgICB0aW1lX2RpZmYgPSByZWxhdGl2ZWRlbHRhKAogICAgICAgICAgICAgICAgZXBvY2hfdG9fZGF0ZXRpbWUoY3VycmVudF90aW1lKSwKICAgICAgICAgICAgICAgIGVwb2NoX3RvX2RhdGV0aW1lKHNlbGYuZmlyc3RfYmlsbGluZ19wZXJpb2Rfc3RhcnQpCiAgICAgICAgICAgICkKICAgICAgICAgICAgbW9udGhzID0gdGltZV9kaWZmLnllYXJzICogMTIgKyB0aW1lX2RpZmYubW9udGhzCiAgICAgICAgICAgIHJldHVybiBkYXRldGltZV90b19lcG9jaCgKICAgICAgICAgICAgICAgIGVwb2NoX3RvX2RhdGV0aW1lKHNlbGYuZmlyc3RfYmlsbGluZ19wZXJpb2Rfc3RhcnQpICsKICAgICAgICAgICAgICAgIHJlbGF0aXZlZGVsdGEobW9udGhzPW1vbnRocykpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgY3VycmVudF90aW1lIDwgc2VsZi5sYXN0X2RlYml0X2F0OgogICAgICAgICAgICAgICAgdGltZV9kaWZmID0gcmVsYXRpdmVkZWx0YSgKICAgICAgICAgICAgICAgICAgICBlcG9jaF90b19kYXRldGltZShzZWxmLmxhc3RfZGViaXRfYXQpLAogICAgICAgICAgICAgICAgICAgIGVwb2NoX3RvX2RhdGV0aW1lKGN1cnJlbnRfdGltZSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIG1vbnRocyA9IHRpbWVfZGlmZi55ZWFycyAqIDEyICsgdGltZV9kaWZmLm1vbnRocyArIDEKICAgICAgICAgICAgICAgIHJldHVybiBkYXRldGltZV90b19lcG9jaCgKICAgICAgICAgICAgICAgICAgICBlcG9jaF90b19kYXRldGltZShzZWxmLmxhc3RfZGViaXRfYXQpIC0KICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZWRlbHRhKG1vbnRocz1tb250aHMpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgc2VsZi5fbm9fZGViaXRfc2luY2VfdW5wYXVzaW5nKCk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudW5wYXVzZWRfb24KCiAgICAgICAgICAgICAgICB0aW1lX2RpZmYgPSByZWxhdGl2ZWRlbHRhKAogICAgICAgICAgICAgICAgICAgIGVwb2NoX3RvX2RhdGV0aW1lKGN1cnJlbnRfdGltZSksCiAgICAgICAgICAgICAgICAgICAgZXBvY2hfdG9fZGF0ZXRpbWUoc2VsZi5sYXN0X2RlYml0X2F0KQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgbW9udGhzID0gdGltZV9kaWZmLnllYXJzICogMTIgKyB0aW1lX2RpZmYubW9udGhzCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZXRpbWVfdG9fZXBvY2goCiAgICAgICAgICAgICAgICAgICAgZXBvY2hfdG9fZGF0ZXRpbWUoc2VsZi5sYXN0X2RlYml0X2F0KSArCiAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVkZWx0YShtb250aHM9bW9udGhzKSkKCiAgICBkZWYgZ2V0X2RlYml0X3RpbWUoc2VsZiwgbW9udGhzX3RvX2JpbGw9MSk6CiAgICAgICAgaWYgbW9udGhzX3RvX2JpbGwgPCAxOgogICAgICAgICAgICByYWlzZSBEb2VzTm90VmFsaWRhdGUobWVzc2FnZT0nTXVzdCBzcGVjaWZ5IGEgbW9udGhzX3RvX2JpbGwgdmFsdWUgbm8gbGVzcyB0aGFuIDEnKQoKICAgICAgICBpZiBub3Qgc2VsZi5hY3RpdmF0ZWRfb246CiAgICAgICAgICAgIHJhaXNlIERvZXNOb3RWYWxpZGF0ZShtZXNzYWdlPSdDYW5ub3QgZGV0ZXJtaW5lIGRlYml0IHRpbWUgZm9yIGEgc3Vic2NyaXB0aW9uIHdpdGhvdXQgJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYW4gYWN0aXZhdGlvbiBkYXRlLicpCgogICAgICAgIGRlYml0X3N0YXJ0X2RhdGUgPSBzZWxmLmxhc3RfZGViaXRfYXQKICAgICAgICBpZiBzZWxmLmlzX292ZXJkdWU6CiAgICAgICAgICAgIGJpbGxpbmdfcGVyaW9kX3N0YXJ0ID0gc2VsZi5ub3JtYWxpemVfYmlsbGluZ19wZXJpb2Rfc3RhcnRfdGltZSgKICAgICAgICAgICAgICAgIGFycm93LnV0Y25vdygpLnRpbWVzdGFtcAogICAgICAgICAgICApCiAgICAgICAgICAgIGRlYml0X3N0YXJ0X2RhdGUgPSBiaWxsaW5nX3BlcmlvZF9zdGFydAogICAgICAgICAgICBkZWJpdF9kYXRlID0gZXBvY2hfdG9fZGF0ZXRpbWUoCiAgICAgICAgICAgICAgICBiaWxsaW5nX3BlcmlvZF9zdGFydCkgKyByZWxhdGl2ZWRlbHRhKG1vbnRocz1tb250aHNfdG9fYmlsbCAtIDEpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbm90IHNlbGYubGFzdF9kZWJpdF9hdDoKICAgICAgICAgICAgICAgIGRlYml0X3N0YXJ0X2RhdGUgPSBzZWxmLmZpcnN0X2JpbGxpbmdfcGVyaW9kX3N0YXJ0CiAgICAgICAgICAgICAgICBkZWJpdF9kYXRlID0gZXBvY2hfdG9fZGF0ZXRpbWUoCiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXJzdF9iaWxsaW5nX3BlcmlvZF9zdGFydCkgKyByZWxhdGl2ZWRlbHRhKG1vbnRocz1tb250aHNfdG9fYmlsbCAtIDEpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBzZWxmLl9ub19kZWJpdF9zaW5jZV91bnBhdXNpbmcoKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi51bnBhdXNlZF9vbgoKICAgICAgICAgICAgICAgIGRlYml0X2RhdGUgPSBlcG9jaF90b19kYXRldGltZSgKICAgICAgICAgICAgICAgICAgICBzZWxmLmxhc3RfZGViaXRfYXQpICsgcmVsYXRpdmVkZWx0YShtb250aHM9bW9udGhzX3RvX2JpbGwpCgogICAgICAgIGRlYml0X2RhdGVfZXBvY2ggPSBkYXRldGltZV90b19lcG9jaChkZWJpdF9kYXRlKQoKICAgICAgICBpZiBkZWJpdF9zdGFydF9kYXRlIDw9IHNlbGYucGF1c2VkX29uOgogICAgICAgICAgICBpZiBzZWxmLnBhdXNlZF9vbiA8PSBkZWJpdF9kYXRlX2Vwb2NoIDwgc2VsZi51bnBhdXNlZF9vbjoKICAgICAgICAgICAgICAgIGxlbmd0aF9vZl9wYXVzZSA9IHJlbGF0aXZlZGVsdGEoZGViaXRfZGF0ZSwgZXBvY2hfdG9fZGF0ZXRpbWUoc2VsZi5wYXVzZWRfb24pKQogICAgICAgICAgICAgICAgZGViaXRfZGF0ZSA9IGVwb2NoX3RvX2RhdGV0aW1lKHNlbGYudW5wYXVzZWRfb24pICsgbGVuZ3RoX29mX3BhdXNlCiAgICAgICAgICAgIGVsaWYgc2VsZi51bnBhdXNlZF9vbiA8PSBkZWJpdF9kYXRlX2Vwb2NoOgogICAgICAgICAgICAgICAgbGVuZ3RoX29mX3BhdXNlID0gcmVsYXRpdmVkZWx0YSgKICAgICAgICAgICAgICAgICAgICBlcG9jaF90b19kYXRldGltZSgKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi51bnBhdXNlZF9vbiksIGVwb2NoX3RvX2RhdGV0aW1lKAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnBhdXNlZF9vbikpCiAgICAgICAgICAgICAgICBkZWJpdF9kYXRlID0gZGViaXRfZGF0ZSArIGxlbmd0aF9vZl9wYXVzZQoKICAgICAgICByZXR1cm4gZGF0ZXRpbWVfdG9fZXBvY2goZGViaXRfZGF0ZSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBiaWxsaW5nX3BhcnRuZXIoc2VsZik6CiAgICAgICAgcmV0dXJuIGdldF93cmFwcGVyKHNlbGYucGFydG5lcl9mbGFnKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGJpbGxpbmdfcGFydG5lcl9pZChzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi51c2VyLnBhcnRuZXJfaWQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBwYXJ0bmVyX2ZsYWcoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYudXNlci5wYXJ0bmVyX2ZsYWcKCiAgICBkZWYgY2hhcmdlKHNlbGYsIGlycmVndWxhcl9jaGFyZ2U9VHJ1ZSk6CiAgICAgICAgd2l0aCBjb250ZXh0X2xvZ2dlcihsb2dnZXIuaW5mbywgbG9nZ2VyLmVycm9yLCAnU3Vic2NyaXB0aW9uLmNoYXJnZSglcyknLCBzZWxmLmlkKSBhcyBsb2c6CiAgICAgICAgICAgIGxvZy5pc19wYXlpbmcgPSBzZWxmLmlzX3BheWluZwogICAgICAgICAgICBsb2cuaXJyZWd1bGFyX2NoYXJnZSA9IGlycmVndWxhcl9jaGFyZ2UKICAgICAgICAgICAgbG9nLmxhc3RfYmlsbGluZ19mYWlsZWRfYXQgPSBzZWxmLmxhc3RfYmlsbGluZ19mYWlsZWRfYXQKICAgICAgICAgICAgbG9nLmJhbGFuY2VfaW5fY2VudHMgPSBzZWxmLmJhbGFuY2VfaW5fY2VudHMKICAgICAgICAgICAgaWYgbm90IHNlbGYuaXNfcGF5aW5nOgogICAgICAgICAgICAgICAgbWVzc2FnZSA9ICgiQXR0ZW1wdGVkIHRvIGJpbGwgYSBzdWJzY3JpcHRpb24gZm9yIHdoaWNoIGlzX3BheWluZyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZXR1cm5zIGZhbHNlIikKICAgICAgICAgICAgICAgIGxvZy5lcnJvciA9IG1lc3NhZ2UKICAgICAgICAgICAgICAgIGxvZy5pZCA9IHNlbGYuaWQKICAgICAgICAgICAgICAgIHJhaXNlIEVjb21tZXJjZUVycm9yKG1lc3NhZ2U9bWVzc2FnZSkKCiAgICAgICAgICAgICMgdGhpcyBzdWIgd2lsbCBiZSBwaWNrZWQgdXAgYnkgdGhlIHJlZ3VsYXIgY3JvbiBqb2IsIHNvIG5vIG5lZWQgdG8gZG8gYW55dGhpbmcKICAgICAgICAgICAgaWYgaXJyZWd1bGFyX2NoYXJnZSBhbmQgbm90IHNlbGYubGFzdF9iaWxsaW5nX2ZhaWxlZF9hdDoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgIyBzb21lIGNvbW1lcmNpYWwgc3VicyBhcmUgY2hhcmdlZCAkMCwgc28gbWFyayB0aGVtIGFzIGNoYW5nZWQgYW5kIG1vdmUgb24KICAgICAgICAgICAgaWYgc2VsZi5iYWxhbmNlX2luX21vbnRocyA+IDAgYW5kIHNlbGYuaXNfZnJlZV9zdWJzY3JpcHRpb246CiAgICAgICAgICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb249J0ZyZWUgU3Vic2NyaXB0aW9uJywKICAgICAgICAgICAgICAgICAgICBpbml0aWF0b3JfaWQ9c2VsZi51c2VyX2lkLAogICAgICAgICAgICAgICAgICAgIHBheW1lbnRfc3RhdHVzPSJzdWNjZXNzZnVsIiwKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fYWN0aW9uPVNVQlNDUklQVElPTl9BQ1RJT05TX0VOVU0uUEFJRF9OT19DSEFSR0UsCiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX3R5cGU9ImRldmljZSIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgICAgICAgICBpZiBzZWxmLmJhbGFuY2VfaW5fY2VudHMgPD0gMDoKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAoIkF0dGVtcHRlZCB0byBiaWxsIGEgc3Vic2NyaXB0aW9uIGZvciB3aGljaCBubyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJiYWxhbmNlIGlzIGN1cnJlbnRseSBkdWUuIikKICAgICAgICAgICAgICAgIGxvZy5lcnJvciA9IG1lc3NhZ2UKICAgICAgICAgICAgICAgIGxvZy5pZCA9IHNlbGYuaWQKICAgICAgICAgICAgICAgIHJhaXNlIEVjb21tZXJjZUVycm9yKG1lc3NhZ2U9bWVzc2FnZSkKCiAgICAgICAgICAgIG1ha2VfdXBfdGV4dCA9ICIgbWFrZSB1cCIgaWYgaXJyZWd1bGFyX2NoYXJnZSBlbHNlICIiCiAgICAgICAgICAgIGZvcm1hdHRlZF9kdCA9IGZvcm1hdF9lcG9jaChhcnJvdy51dGNub3coKS50aW1lc3RhbXAsICIlbS0lZC0leSIpCiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gIlN1YnNjcmlwdGlvbiAlcyVzIGNoYXJnZSBvbiAlcyIgJSAoc2VsZi5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlX3VwX3RleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkX2R0LCkKCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLl9jaGFyZ2UoZGVzY3JpcHRpb24sIGlycmVndWxhcl9jaGFyZ2UpCgogICAgICAgICAgICByZXR1cm4gc3VjY2VzcwoKICAgIEBoYW5kbGVfZXhjZXB0aW9uKEV4Y2VwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRfdmFsdWU9VGF4UmVzdWx0KHRheF9wYXJ0bmVyX2lkPU5vbmUsIHRheF9pbl9jZW50cz0wKSwKICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlcj1sb2dnZXIpCiAgICBAcmVjb3JkX21ldHJpY3MoYWN0aW9uPUNIQVJHRV9BQ1RJT04uQ0FMQ1VMQVRFX1RBWCwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZF9nZXR0ZXI9YXR0cmdldHRlcigiaWQiKSkKICAgIEBwcmVjb25kaXRpb25zKGxhbWJkYSBiaWxsaW5nX3ppcF9jb2RlOiBiaWxsaW5nX3ppcF9jb2RlIGlzIG5vdCBOb25lKQogICAgZGVmIF9jYWxjdWxhdGVfdGF4KHNlbGYsIGJpbGxpbmdfemlwX2NvZGUsIGJpbGxpbmdfY291bnRyeSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YXhfcGFydG5lcl9pZCA9IHNlbGYudW5pcXVlX3RheF9wYXJ0bmVyX2lkKCkKICAgICAgICAgICAgdGF4X2luX2RvbGxhcnMgPSBUYXhTZXJ2aWNlLmdldF90YXhfZm9yX3NpbmdsZV9pdGVtKAogICAgICAgICAgICAgICAgc3VidG90YWw9c2VsZi5iYWxhbmNlX2luX2RvbGxhcnMsCiAgICAgICAgICAgICAgICBzaGlwcGluZ19wcmljZT0wLAogICAgICAgICAgICAgICAgdGF4X2NhdGVnb3J5PXNlbGYudGF4X3R5cGUsCiAgICAgICAgICAgICAgICB6aXBfY29kZT1iaWxsaW5nX3ppcF9jb2RlLAogICAgICAgICAgICAgICAgY291bnRyeT1iaWxsaW5nX2NvdW50cnksCiAgICAgICAgICAgICAgICBjdXN0b21lcl9pZD1zZWxmLnVzZXJfaWQsCiAgICAgICAgICAgICAgICBzb3VyY2VfaWQ9dGF4X3BhcnRuZXJfaWQsCiAgICAgICAgICAgICAgICBjdXJyZW5jeT1zZWxmLmN1cnJlbmN5CiAgICAgICAgICAgICkKICAgICAgICAgICAgdGF4X2luX2NlbnRzID0gZG9sbGFyc190b19jZW50cyh0YXhfaW5fZG9sbGFycykKCiAgICAgICAgICAgIHJldHVybiBUYXhSZXN1bHQodGF4X3BhcnRuZXJfaWQ9dGF4X3BhcnRuZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4X2luX2NlbnRzPXRheF9pbl9jZW50cykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICMgTk9URShiZGV0dG1lciwgc2NvdHR5cm9nZXMpOiBUZW1wb3JhcnkgdW50aWwgd2Uga25vdyB3aHkgd2UncmUgbm90IGNhbGxpbmcgQXZhbGFyYQogICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ1N1Ym1pdCB0YXggZXJyb3IgY3VzdG9tZXJfaWQ9e30sIHN1YnNjcmlwdGlvbl9pZD17fSwgZXJyb3I9e30nLmZvcm1hdCgKICAgICAgICAgICAgICAgIHNlbGYudXNlcl9pZCwgc2VsZi5pZCwgc3RyKGUpKSkKICAgICAgICAgICAgcmFpc2UgZQoKICAgIEBoYW5kbGVfZXhjZXB0aW9uKEV4Y2VwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRfdmFsdWU9VGF4UmVzdWx0KHRheF9wYXJ0bmVyX2lkPU5vbmUsIHRheF9pbl9jZW50cz0wKSwKICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlcj1sb2dnZXIpCiAgICBAcmVjb3JkX21ldHJpY3MoYWN0aW9uPUNIQVJHRV9BQ1RJT04uU1VCTUlUX1RBWCwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV9pZF9nZXR0ZXI9YXR0cmdldHRlcigiaWQiKSkKICAgIEBwcmVjb25kaXRpb25zKGxhbWJkYSBiaWxsaW5nX3ppcF9jb2RlOiBiaWxsaW5nX3ppcF9jb2RlIGlzIG5vdCBOb25lLAogICAgICAgICAgICAgICAgICAgbGFtYmRhIHRheF9wYXJ0bmVyX2lkOiB0YXhfcGFydG5lcl9pZCBpcyBub3QgTm9uZSkKICAgIGRlZiBfc3VibWl0X3RheChzZWxmLCBiaWxsaW5nX3ppcF9jb2RlLCBiaWxsaW5nX2NvdW50cnksIHRheF9wYXJ0bmVyX2lkKToKCiAgICAgICAgdGF4X2luX2RvbGxhcnMgPSBUYXhTZXJ2aWNlLnN1Ym1pdF90YXhfZm9yX3NpbmdsZV9pdGVtKAogICAgICAgICAgICBzdWJ0b3RhbD1zZWxmLmJhbGFuY2VfaW5fZG9sbGFycywKICAgICAgICAgICAgc2hpcHBpbmdfcHJpY2U9MCwKICAgICAgICAgICAgdGF4X2NhdGVnb3J5PXNlbGYudGF4X3R5cGUsCiAgICAgICAgICAgIHppcF9jb2RlPWJpbGxpbmdfemlwX2NvZGUsCiAgICAgICAgICAgIGNvdW50cnk9YmlsbGluZ19jb3VudHJ5LAogICAgICAgICAgICBjdXN0b21lcl9pZD1zZWxmLnVzZXJfaWQsCiAgICAgICAgICAgIHNvdXJjZV9pZD10YXhfcGFydG5lcl9pZCwKICAgICAgICAgICAgY3VycmVuY3k9c2VsZi5jdXJyZW5jeQogICAgICAgICkKICAgICAgICB0YXhfaW5fY2VudHMgPSBkb2xsYXJzX3RvX2NlbnRzKHRheF9pbl9kb2xsYXJzKQoKICAgICAgICByZXR1cm4gVGF4UmVzdWx0KHRheF9wYXJ0bmVyX2lkPXRheF9wYXJ0bmVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgdGF4X2luX2NlbnRzPXRheF9pbl9jZW50cykKCiAgICBkZWYgX2dldF9iaWxsaW5nX3ppcGNvZGVfYW5kX2NvdW50cnkoc2VsZik6CiAgICAgICAgcmV0dXJuIChzZWxmLnBvc3RhbF9jb2RlLCBzZWxmLmJpbGxpbmdfY291bnRyeSkKCiAgICBkZWYgX2NoYXJnZShzZWxmLCBkZXNjcmlwdGlvbiwgaXJyZWd1bGFyX2NoYXJnZSk6CiAgICAgICAgd2l0aCBjb250ZXh0X2xvZ2dlcigKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvLAogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yLAogICAgICAgICAgICAgICAgJ1N1YnNjcmlwdGlvbi5fY2hhcmdlKCVzKScsIHNlbGYuaWQpIGFzIGxvZzoKCiAgICAgICAgICAgIGJpbGxpbmdfemlwX2NvZGUsIGJpbGxpbmdfY291bnRyeSA9IHNlbGYuX2dldF9iaWxsaW5nX3ppcGNvZGVfYW5kX2NvdW50cnkoKQogICAgICAgICAgICB0YXhfcmVzdWx0ID0gc2VsZi5fY2FsY3VsYXRlX3RheChiaWxsaW5nX3ppcF9jb2RlLCBiaWxsaW5nX2NvdW50cnkpCgogICAgICAgICAgICBpZiBpc192YXRfY3VycmVuY3koc2VsZi5jdXJyZW5jeSk6CiAgICAgICAgICAgICAgICB0b3RhbF93aXRoX3RheCA9IHNlbGYuYmFsYW5jZV9pbl9jZW50cwogICAgICAgICAgICAgICAgdG90YWxfbGVzc190YXggPSBzZWxmLmJhbGFuY2VfaW5fY2VudHMgLSB0YXhfcmVzdWx0LnRheF9pbl9jZW50cwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdG90YWxfd2l0aF90YXggPSBzZWxmLmJhbGFuY2VfaW5fY2VudHMgKyB0YXhfcmVzdWx0LnRheF9pbl9jZW50cwogICAgICAgICAgICAgICAgdG90YWxfbGVzc190YXggPSBzZWxmLmJhbGFuY2VfaW5fY2VudHMKCiAgICAgICAgICAgIGJpbGxpbmdfcGFydG5lcl9tZXNzYWdlID0gIiIKICAgICAgICAgICAgY2hhcmdlX2lkID0gTm9uZQogICAgICAgICAgICB0YXhfcGFydG5lcl9pZCA9IE5vbmUKICAgICAgICAgICAgaXNfc3VjY2Vzc2Z1bCA9IFRydWUKICAgICAgICAgICAgYmlsbGluZ19wYXJ0bmVyX2ZlZV9pbl9jZW50cyA9IDAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBUT0RPOiByZW1vdmUgZmVhdHVyZSBmbGFnIG9uY2UgdmVyaWZpZWQKICAgICAgICAgICAgICAgIGlmIEV4cGVyaW1lbnRzKCkuaXNfZmVhdHVyZV9lbmFibGVkKAogICAgICAgICAgICAgICAgICAgICAgICBGRUFUVVJFX0ZMQUdTLk1PQ0hJX0NSRUFURV9DSEFSR0VfRk9SX1NVQlNDUklQVElPTiwKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pZAogICAgICAgICAgICAgICAgKToKICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImVtYWlsIjogc2VsZi51c2VyLmVtYWlsLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNfc3Vic2NyaXB0aW9uX2NoYXJnZSI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJzdWJzY3JpcHRpb25faWQiOiBzZWxmLmlkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfcGFydG5lcl9jaGFyZ2UgPSBzZWxmLmJpbGxpbmdfcGFydG5lci5jcmVhdGVfY2hhcmdlKAogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF93aXRoX3RheCwKICAgICAgICAgICAgICAgICAgICAgICAgcGFydG5lcl9pZD1zZWxmLmJpbGxpbmdfcGFydG5lcl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb249ZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5PXNlbGYuY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhPW1ldGFkYXRhKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BhcnRuZXJfY2hhcmdlID0gc2VsZi5iaWxsaW5nX3BhcnRuZXIuY3JlYXRlX3N1YnNjcmlwdGlvbl9jaGFyZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3dpdGhfdGF4LAogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0bmVyX2lkPXNlbGYuYmlsbGluZ19wYXJ0bmVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj1kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k9c2VsZi5jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw9c2VsZi51c2VyLmVtYWlsLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJfaWQ9c2VsZi5pZCkKCiAgICAgICAgICAgICAgICBjaGFyZ2VfaWQgPSBiaWxsaW5nX3BhcnRuZXJfY2hhcmdlLmNoYXJnZV9pZAogICAgICAgICAgICAgICAgYmlsbGluZ19wYXJ0bmVyX2ZlZV9pbl9jZW50cyA9IGJpbGxpbmdfcGFydG5lcl9jaGFyZ2UuZmVlX2luX2NlbnRzCgogICAgICAgICAgICAgICAgc3VibWl0dGVkX3RheF9yZXN1bHQgPSBzZWxmLl9zdWJtaXRfdGF4KAogICAgICAgICAgICAgICAgICAgIGJpbGxpbmdfemlwX2NvZGUsCiAgICAgICAgICAgICAgICAgICAgYmlsbGluZ19jb3VudHJ5LAogICAgICAgICAgICAgICAgICAgIHRheF9yZXN1bHQudGF4X3BhcnRuZXJfaWQpCiAgICAgICAgICAgICAgICB0YXhfcGFydG5lcl9pZCA9IHN1Ym1pdHRlZF90YXhfcmVzdWx0LnRheF9wYXJ0bmVyX2lkCgogICAgICAgICAgICAgICAgbG9nLnBheW1lbnRfZXJyb3IgPSBGYWxzZQoKICAgICAgICAgICAgZXhjZXB0IFBheW1lbnRFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgbG9nLnBheW1lbnRfZXJyb3IgPSBUcnVlCgogICAgICAgICAgICAgICAgaXNfc3VjY2Vzc2Z1bCA9IEZhbHNlCiAgICAgICAgICAgICAgICBwYXJ0bmVyX3Jlc3BvbnNlID0gZ2V0YXR0cihlLCAncGFydG5lcl9yZXNwb25zZScsIE5vbmUpCiAgICAgICAgICAgICAgICBpZiBwYXJ0bmVyX3Jlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgIGVycm9yID0gcGFydG5lcl9yZXNwb25zZVsiZXJyb3IiXQogICAgICAgICAgICAgICAgICAgIGNoYXJnZV9pZCA9IGVycm9yLmdldCgiY2hhcmdlIikKICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BhcnRuZXJfbWVzc2FnZSA9IGVycm9yLmdldCgibWVzc2FnZSIpCgogICAgICAgICAgICBpZiBub3QgY2hhcmdlX2lkOgogICAgICAgICAgICAgICAgY2hhcmdlX2lkID0gIkZBSUxFRDogTm8gY2hhcmdlX2lkIgogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gIjogRkFJTEVEIgoKICAgICAgICAgICAgY2FwdHVyZV9sb2NhdGlvbiA9IFNVQlNDUklQVElPTl9SRUdVTEFSX0NIQVJHRQogICAgICAgICAgICBpZiBpcnJlZ3VsYXJfY2hhcmdlOgogICAgICAgICAgICAgICAgY2FwdHVyZV9sb2NhdGlvbiA9IFNVQlNDUklQVElPTl9JUlJFR1VMQVJfQ0hBUkdFCgogICAgICAgICAgICBsb2cudG90YWxfbGVzc190YXggPSB0b3RhbF9sZXNzX3RheAogICAgICAgICAgICBsb2cudGF4X3Jlc3VsdCA9IHRheF9yZXN1bHQudGF4X2luX2NlbnRzCiAgICAgICAgICAgIGxvZy5wYXJ0bmVyX2ZsYWcgPSBzZWxmLnBhcnRuZXJfZmxhZyBvciAiTm9uZSIKICAgICAgICAgICAgbG9nLmNoYXJnZV9pZCA9IGNoYXJnZV9pZAogICAgICAgICAgICBsb2cuYmlsbGluZ19wYXJ0bmVyX21lc3NhZ2UgPSBiaWxsaW5nX3BhcnRuZXJfbWVzc2FnZQogICAgICAgICAgICBsb2cuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbgogICAgICAgICAgICBsb2cuY2FwdHVyZV9sb2NhdGlvbiA9IGNhcHR1cmVfbG9jYXRpb24KICAgICAgICAgICAgbG9nLnN1Y2Nlc3NmdWwgPSBpc19zdWNjZXNzZnVsCiAgICAgICAgICAgIGxvZy50YXhfcGFydG5lcl9pZCA9IHRheF9wYXJ0bmVyX2lkCgogICAgICAgICAgICBzZWxmLmNyZWF0ZV90cmFuc2FjdGlvbih0b3RhbF9sZXNzX3RheCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGF4X3Jlc3VsdC50YXhfaW5fY2VudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucGFydG5lcl9mbGFnIG9yICJOb25lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmdlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BhcnRuZXJfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9sb2NhdGlvbj1jYXB0dXJlX2xvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzZnVsPWlzX3N1Y2Nlc3NmdWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheF9wYXJ0bmVyPUFWQUxBUkEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheF9wYXJ0bmVyX2lkPXRheF9wYXJ0bmVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaWxsaW5nX3BhcnRuZXJfZmVlX2luX2NlbnRzPWJpbGxpbmdfcGFydG5lcl9mZWVfaW5fY2VudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIHJldHVybiBpc19zdWNjZXNzZnVsCgogICAgZGVmIHVuaXF1ZV90YXhfcGFydG5lcl9pZChzZWxmKToKICAgICAgICByZXR1cm4gdXVpZC51dWlkNCgpLmhleAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHRheF90eXBlKHNlbGYpOgogICAgICAgIHJldHVybiBTVUJTQ1JJUFRJT05fUEFZTUVOVF9UQVhfVFlQRS5BRlRFUl9GSVJTVF9ZRUFSCgogICAgQHN0YXRzZC50aW1lZCgic3Vic2NyaXB0aW9uLm1ha2VfcGF5bWVudCIpCiAgICBkZWYgbWFrZV9wYXltZW50KHNlbGYsIGlycmVndWxhcl9jaGFyZ2U9VHJ1ZSk6CiAgICAgICAgc3VjY2VzcyA9IFRydWUKICAgICAgICBzZWxmLnVzZV9wcmVwYWlkX2NyZWRpdCgpCiAgICAgICAgc2VsZi51c2Vfd2FpdmVyKCkKICAgICAgICBzZWxmLnVzZV9zdWJzY3JpcHRpb25fY3JlZGl0KCkKICAgICAgICBpZiBzZWxmLmJhbGFuY2VfaW5fbW9udGhzOgogICAgICAgICAgICBzdWNjZXNzID0gc2VsZi5jaGFyZ2UoaXJyZWd1bGFyX2NoYXJnZT1pcnJlZ3VsYXJfY2hhcmdlKQoKICAgICAgICByZXR1cm4gc3VjY2VzcwoKICAgIGRlZiBkZXN0cm95KHNlbGYsIGluaXRpYXRvcj1Ob25lKToKICAgICAgICBzZWxmLmRldGFjaF9kZXZpY2UoZGV2aWNlX2dyb3VwPUJJS0UpCiAgICAgICAgc2VsZi5kZXRhY2hfZGV2aWNlKGRldmljZV9ncm91cD1UUkVBRCkKICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJTdWJzY3JpcHRpb24gZGVsZXRlZCIsCiAgICAgICAgICAgIGluaXRpYXRvcl9pZD1pbml0aWF0b3IuaWQgaWYgaW5pdGlhdG9yIGVsc2UgTm9uZSwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2FjdGlvbj1TVUJTQ1JJUFRJT05fQUNUSU9OU19FTlVNLkRFTEVURUQsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkLAogICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIgogICAgICAgICkKICAgICAgICBzdXBlcihTdWJzY3JpcHRpb24sIHNlbGYpLmRlc3Ryb3koKQoKICAgIGRlZiBfaGFyZF9kZWxldGUoc2VsZik6CiAgICAgICAgc2VsZi5kZXRhY2hfZGV2aWNlKGRldmljZV9ncm91cD1CSUtFKQogICAgICAgIHNlbGYuZGV0YWNoX2RldmljZShkZXZpY2VfZ3JvdXA9VFJFQUQpCiAgICAgICAgc3VwZXIoU3Vic2NyaXB0aW9uLCBzZWxmKS5faGFyZF9kZWxldGUoKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHdvdWxkX2JlX2NhbmNlbGxhdGlvbl90aW1lKHNlbGYpOgogICAgICAgIGlmIHNlbGYuaXNfc2NoZWR1bGVkX2Zvcl9jYW5jZWxsYXRpb24gb3Igc2VsZi5pc19jYW5jZWxsZWQ6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZWxpZiBzZWxmLmlzX3VudXNlZDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRfZGViaXRfdGltZShzZWxmLmJhbGFuY2VfaW5fbW9udGhzICsgMSkgLSAxCgogICAgQHByb3BlcnR5CiAgICBkZWYgaGFzX2JhbGFuY2Uoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0X2JhbGFuY2VfaW5fbW9udGhzKCkgPiAwCgogICAgQHByb3BlcnR5CiAgICBkZWYgY2FuX3BhdXNlKHNlbGYpOgogICAgICAgIHJldHVybiAoc2VsZi5pc19hY3RpdmUgYW5kCiAgICAgICAgICAgICAgICBub3Qgc2VsZi5pc19jb21tZXJjaWFsIGFuZAogICAgICAgICAgICAgICAgbm90IHNlbGYuaXNfaW5fZ3JhY2VfcGVyaW9kIGFuZAogICAgICAgICAgICAgICAgbm90IHNlbGYuaXNfc2NoZWR1bGVkX2Zvcl9jYW5jZWxsYXRpb24gYW5kCiAgICAgICAgICAgICAgICBub3Qgc2VsZi5pc19zY2hlZHVsZWRfZm9yX3BhdXNlIGFuZAogICAgICAgICAgICAgICAgbm90IHNlbGYuaGFzX2JhbGFuY2UgYW5kCiAgICAgICAgICAgICAgICBub3Qgc2VsZi5pc19jaGFyZ2VfcGVuZGluZ19hZnRlcl91bnBhdXNlKCkpCgogICAgQHByb3BlcnR5CiAgICBkZWYgY2FuX3VucGF1c2Uoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuaXNfcGF1c2VkIG9yIHNlbGYuaXNfc2NoZWR1bGVkX2Zvcl9wYXVzZQoKICAgIGRlZiBpc19jaGFyZ2VfcGVuZGluZ19hZnRlcl91bnBhdXNlKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLnVucGF1c2VkX29uID4gc2VsZi5sYXN0X2RlYml0X2F0CgogICAgZGVmIHBhdXNlKAogICAgICAgICAgICBzZWxmLAogICAgICAgICAgICBpbnRlbmRlZF90b19jYW5jZWw9RmFsc2UsCiAgICAgICAgICAgIHJlYXNvbj1Ob25lLAogICAgICAgICAgICBzdGFydF9kYXRlPU5vbmUsCiAgICAgICAgICAgIGVuZF9kYXRlPU5vbmUsCiAgICAgICAgICAgIG5vdGVzPU5vbmUsCiAgICAgICAgICAgIGluaXRpYXRvcj1Ob25lKToKCiAgICAgICAgbm93ID0gYXJyb3cudXRjbm93KCkudGltZXN0YW1wCiAgICAgICAgaWYgc2VsZi5pc191bnVzZWQ6CiAgICAgICAgICAgIHJhaXNlIERvZXNOb3RWYWxpZGF0ZShtZXNzYWdlPSdTdWJzY3JpcHRpb24gaGFzIG5vdCBiZWVuIGFjdGl2YXRlZC4nKQoKICAgICAgICBpZiBzZWxmLmlzX2NvbW1lcmNpYWw6CiAgICAgICAgICAgIHJhaXNlIERvZXNOb3RWYWxpZGF0ZShtZXNzYWdlPSdTdWJzY3JpcHRpb24gdHlwZSBpcyBjb21tZXJjaWFsLicpCgogICAgICAgIGlmIHNlbGYuaXNfaW5fZ3JhY2VfcGVyaW9kOgogICAgICAgICAgICByYWlzZSBEb2VzTm90VmFsaWRhdGUobWVzc2FnZT0nU3Vic2NyaXB0aW9uIGlzIGluIGdyYWNlIHBlcmlvZC4nKQoKICAgICAgICBpZiBzZWxmLmlzX3BhdXNlZDoKICAgICAgICAgICAgcmFpc2UgRG9lc05vdFZhbGlkYXRlKG1lc3NhZ2U9J1N1YnNjcmlwdGlvbiBpcyBhbHJlYWR5IHBhdXNlZC4nKQoKICAgICAgICBpZiBzZWxmLmlzX3NjaGVkdWxlZF9mb3JfY2FuY2VsbGF0aW9uOgogICAgICAgICAgICByYWlzZSBEb2VzTm90VmFsaWRhdGUobWVzc2FnZT0nU3Vic2NyaXB0aW9uIHNjaGVkdWxlZCBmb3IgY2FuY2VsbGF0aW9uLicpCgogICAgICAgIGlmIHNlbGYuaXNfY2FuY2VsbGVkOgogICAgICAgICAgICByYWlzZSBEb2VzTm90VmFsaWRhdGUobWVzc2FnZT0nU3Vic2NyaXB0aW9uIGlzIGNhbmNlbGxlZC4nKQoKICAgICAgICBpZiAoc2VsZi5pc19wYXVzZWQgYW5kIHNlbGYucGF1c2VkX29uICE9IHN0YXJ0X2RhdGUgYW5kIHN0YXJ0X2RhdGUgPCBub3cpIG9yICgKICAgICAgICAgICAgICAgIG5vdCBzZWxmLmlzX3BhdXNlZCBhbmQgc3RhcnRfZGF0ZSA8IG5vdyk6CiAgICAgICAgICAgIHJhaXNlIERvZXNOb3RWYWxpZGF0ZShtZXNzYWdlPSdTdGFydCBkYXRlIGlzIGluIHRoZSBwYXN0JykKICAgICAgICBpZiBlbmRfZGF0ZSA8IG5vdzoKICAgICAgICAgICAgcmFpc2UgRG9lc05vdFZhbGlkYXRlKG1lc3NhZ2U9J0VuZCBkYXRlIGlzIGluIHRoZSBwYXN0JykKICAgICAgICBpZiBlbmRfZGF0ZSA8IHN0YXJ0X2RhdGU6CiAgICAgICAgICAgIHJhaXNlIERvZXNOb3RWYWxpZGF0ZShtZXNzYWdlPSdFbmQgZGF0ZSBiZWZvcmUgc3RhcnQgZGF0ZScpCgogICAgICAgIGlmIHNlbGYuaXNfY2hhcmdlX3BlbmRpbmdfYWZ0ZXJfdW5wYXVzZSgpOgogICAgICAgICAgICByYWlzZSBEb2VzTm90VmFsaWRhdGUobWVzc2FnZT0iVG9vIHNvb24gdG8gcGF1c2UgYWdhaW4uIikKCiAgICAgICAgaWYgc2VsZi5oYXNfYmFsYW5jZToKICAgICAgICAgICAgcmFpc2UgRG9lc05vdFZhbGlkYXRlKG1lc3NhZ2U9J0RlbGlucXVlbnQgc3Vic2NyaXB0aW9uLicpCgogICAgICAgIHNlbGYucGF1c2VkX29uID0gc3RhcnRfZGF0ZQogICAgICAgIHNlbGYudW5wYXVzZWRfb24gPSBlbmRfZGF0ZQoKICAgICAgICBzZWxmLnNhdmUoKQoKICAgICAgICBkYXRhLnNpZ25hbHMuc3Vic2NyaXB0aW9uX3BhdXNlZC5zZW5kKHNlbmRlcj10eXBlKHNlbGYpLCBzdWJzY3JpcHRpb249c2VsZikKCiAgICAgICAgbm90ZXNfdGV4dCA9ICcgTm90ZXM6ICcgKyBub3RlcyBpZiBub3RlcyBlbHNlICcnCiAgICAgICAgaW50ZW50X3RvX2NhbmNlbCA9ICcgVXNlciBpbnRlbmRlZCB0byBjYW5jZWwuJyBpZiBpbnRlbmRlZF90b19jYW5jZWwgZWxzZSAnJwogICAgICAgIGluaXRpYXRvcl9pZCA9IGluaXRpYXRvci5pZCBpZiBpbml0aWF0b3IgZWxzZSBOb25lCiAgICAgICAgaWYgc3RhcnRfZGF0ZSA+IG5vdzoKICAgICAgICAgICAgTW9kZWwuU3Vic2NyaXB0aW9uVHJhbnNhY3Rpb24uc2F2ZV93aXRoKAogICAgICAgICAgICAgICAgaW5pdGlhdG9yX2lkPWluaXRpYXRvcl9pZCwKICAgICAgICAgICAgICAgIHJlYXNvbj1yZWFzb24sCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fYWN0aW9uPVNVQlNDUklQVElPTl9BQ1RJT05TX0VOVU0uU0NIRURVTEVEX1RPX1BBVVNFLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIiwKICAgICAgICAgICAgICAgIG1ldGE9ewogICAgICAgICAgICAgICAgICAgICdpbnRlbmRlZF90b19jYW5jZWwnOiBpbnRlbmRlZF90b19jYW5jZWx9LAogICAgICAgICAgICAgICAgZGVzY3JpcHRpb249J1N1YnNjcmlwdGlvbiBzY2hlZHVsZWQgZm9yIHBhdXNlIG9uICVzIEVhc3Rlcm4gVGltZSwgJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VucGF1c2Ugb24gJXMuJXMlcycgJQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZvcm1hdF9lcG9jaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnBhdXNlZF9vbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJW0vJWQvJVknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRaX1VTX0VBU1RFUk4pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdF9lcG9jaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi51bnBhdXNlZF9vbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyVtLyVkLyVZJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFpfVVNfRUFTVEVSTiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZW50X3RvX2NhbmNlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3Rlc190ZXh0KSkKCiAgICAgICAgTW9kZWwuU3Vic2NyaXB0aW9uVHJhbnNhY3Rpb24uc2F2ZV93aXRoKAogICAgICAgICAgICBlZmZlY3RpdmVfZXZlbnRfdGltZXN0YW1wPXN0YXJ0X2RhdGUsCiAgICAgICAgICAgIGluaXRpYXRvcl9pZD1pbml0aWF0b3JfaWQsCiAgICAgICAgICAgIHJlYXNvbj1yZWFzb24sCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9hY3Rpb249U1VCU0NSSVBUSU9OX0FDVElPTlNfRU5VTS5QQVVTRUQsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkLAogICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIiwKICAgICAgICAgICAgbWV0YT17CiAgICAgICAgICAgICAgICAnaW50ZW5kZWRfdG9fY2FuY2VsJzogaW50ZW5kZWRfdG9fY2FuY2VsfSwKICAgICAgICAgICAgZGVzY3JpcHRpb249J1N1YnNjcmlwdGlvbiBzY2hlZHVsZWQgZm9yIHBhdXNlIG9uICVzIEVhc3Rlcm4gVGltZSwgJwogICAgICAgICAgICAgICAgICAgICAgICAndW5wYXVzZSBvbiAlcy4lcyVzJyAlCiAgICAgICAgICAgICAgICAgICAgICAgIChmb3JtYXRfZXBvY2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnBhdXNlZF9vbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICclbS8lZC8lWScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUWl9VU19FQVNURVJOKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdF9lcG9jaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVucGF1c2VkX29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICclbS8lZC8lWScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFpfVVNfRUFTVEVSTiksCiAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnRfdG9fY2FuY2VsLAogICAgICAgICAgICAgICAgICAgICAgICAgbm90ZXNfdGV4dCkpCgogICAgICAgIE1vZGVsLlN1YnNjcmlwdGlvblRyYW5zYWN0aW9uLnNhdmVfd2l0aCgKICAgICAgICAgICAgZWZmZWN0aXZlX2V2ZW50X3RpbWVzdGFtcD1lbmRfZGF0ZSwKICAgICAgICAgICAgaW5pdGlhdG9yX2lkPWluaXRpYXRvcl9pZCwKICAgICAgICAgICAgcmVhc29uPXJlYXNvbiwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2FjdGlvbj1TVUJTQ1JJUFRJT05fQUNUSU9OU19FTlVNLlVOUEFVU0VELAogICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ9c2VsZi5pZCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX3R5cGU9ImRldmljZSIsCiAgICAgICAgICAgIG1ldGE9ewogICAgICAgICAgICAgICAgJ2ludGVuZGVkX3RvX2NhbmNlbCc6IGludGVuZGVkX3RvX2NhbmNlbH0sCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSdTdWJzY3JpcHRpb24gc2NoZWR1bGVkIGZvciBwYXVzZSBvbiAlcyBFYXN0ZXJuIFRpbWUsICcKICAgICAgICAgICAgICAgICAgICAgICAgJ3VucGF1c2Ugb24gJXMuJXMlcycgJQogICAgICAgICAgICAgICAgICAgICAgICAoZm9ybWF0X2Vwb2NoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wYXVzZWRfb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJW0vJWQvJVknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVFpfVVNfRUFTVEVSTiksCiAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRfZXBvY2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi51bnBhdXNlZF9vbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJW0vJWQvJVknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRaX1VTX0VBU1RFUk4pLAogICAgICAgICAgICAgICAgICAgICAgICAgaW50ZW50X3RvX2NhbmNlbCwKICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGVzX3RleHQpKQoKICAgIGRlZiBjYW5jZWxfcGF1c2Uoc2VsZiwgaW5pdGlhdG9yPU5vbmUpOgogICAgICAgIGlmIG5vdCBzZWxmLmlzX3BhdXNlZCBhbmQgbm90IHNlbGYuaXNfc2NoZWR1bGVkX2Zvcl9wYXVzZToKICAgICAgICAgICAgcmFpc2UgRG9lc05vdFZhbGlkYXRlKG1lc3NhZ2U9J1N1YnNjcmlwdGlvbiBuZWl0aGVyIHBhdXNlZCBub3Igc2NoZWR1bGVkIGZvciBwYXVzZScpCiAgICAgICAgcGF1c2Vfc3RhcnRfZGF0ZSA9IHNlbGYucGF1c2VkX29uCiAgICAgICAgbm93ID0gYXJyb3cudXRjbm93KCkudGltZXN0YW1wCiAgICAgICAgaWYgc2VsZi5pc19zY2hlZHVsZWRfZm9yX3BhdXNlOgogICAgICAgICAgICBzZWxmLnBhdXNlZF9vbiA9IE5vbmUKICAgICAgICAgICAgc2VsZi51bnBhdXNlZF9vbiA9IE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLnVucGF1c2VkX29uID0gYXJyb3cudXRjbm93KCkudGltZXN0YW1wCgogICAgICAgIHNlbGYuc2F2ZSgpCiAgICAgICAgc2VsZi5fY2xlYW51cF9vZl9mdXR1cmVfZXZlbnRzKCkKCiAgICAgICAgaW5pdGlhdG9yX2lkID0gaW5pdGlhdG9yLmlkIGlmIGluaXRpYXRvciBlbHNlIE5vbmUKICAgICAgICBpZiBub3cgPCBwYXVzZV9zdGFydF9kYXRlOgogICAgICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgICAgICBpbml0aWF0b3JfaWQ9aW5pdGlhdG9yX2lkLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2FjdGlvbj1TVUJTQ1JJUFRJT05fQUNUSU9OU19FTlVNLkNBTkNFTExFRF9TQ0hFRFVMRURfUEFVU0UsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ9c2VsZi5pZCwKICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl90eXBlPSJkZXZpY2UiLAogICAgICAgICAgICAgICAgZGVzY3JpcHRpb249J1NjaGVkdWxlZCBwYXVzZSBpcyBjYW5jZWxsZWQnCgogICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgTW9kZWwuU3Vic2NyaXB0aW9uVHJhbnNhY3Rpb24uc2F2ZV93aXRoKAogICAgICAgICAgICAgICAgaW5pdGlhdG9yX2lkPWluaXRpYXRvcl9pZCwKICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9hY3Rpb249U1VCU0NSSVBUSU9OX0FDVElPTlNfRU5VTS5VTlBBVVNFRCwKICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX3R5cGU9ImRldmljZSIsCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj0nU3Vic2NyaXB0aW9uIHBhdXNlIGNhbmNlbGxlZC4nCiAgICAgICAgICAgICkKCiAgICBkZWYgX2NsZWFudXBfb2ZfZnV0dXJlX2V2ZW50cyhzZWxmKToKICAgICAgICBmdXR1cmVfdHJhbnNhY3Rpb25zID0gTW9kZWwuU3Vic2NyaXB0aW9uVHJhbnNhY3Rpb24ubWFuYWdlci5zZWFyY2goCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkLAogICAgICAgICAgICBlZmZlY3RpdmVfZXZlbnRfdGltZXN0YW1wX19ndD1hcnJvdy51dGNub3coKS50aW1lc3RhbXAKICAgICAgICApCiAgICAgICAgZm9yIHRyYW5zYWN0aW9uIGluIGZ1dHVyZV90cmFuc2FjdGlvbnM6CiAgICAgICAgICAgIHRyYW5zYWN0aW9uLmRlc3Ryb3koKQoKICAgIGRlZiByZWFjdGl2YXRlKHNlbGYsIGluaXRpYXRvcj1Ob25lLCBub3Rlcz1Ob25lKToKICAgICAgICAiIiJSZWFjdGl2YXRlcyBhIHN1YnNjcmlwdGlvbgoKICAgICAgICBJZiBhIHN1YnNjcmlwdGlvbiBpcyBzY2hlZHVsZWQgdG8gYmUgY2FuY2VsbGVkLCB0aGlzIHNpbXBseSB1bmRvIHRoYXQgYnkgcmVtb3ZpbmcKICAgICAgICB0aGUgc2NoZWR1bGVkIGNhbmNlbGxhdGlvbiBkYXRlLiBTdWJzY3JpcHRpb24gd2lsbCBjb250aW51ZSB0byBiZSBiaWxsZWQgb24gdGhlCiAgICAgICAgb3JpZ2luYWwgYWN0aXZhdGlvbiBkYXRlLgoKICAgICAgICBJZiBhIHN1YnNjcmlwdGlvbiBpcyBhbHJlYWR5IGNhbmNlbGxlZCwgaXQgd2lsbCByZS1hY3RpdmF0ZSB0aGUgc3Vic2NyaXB0aW9uLAogICAgICAgIHdoaWNoIHNldHMgYSBuZXcgYWN0aXZhdGlvbiBkYXRlIGFuZCBhIG5ldyBiaWxsaW5nIGRhdGUuCiAgICAgICAgIiIiCiAgICAgICAgaWYgbm90IHNlbGYuaXNfc2NoZWR1bGVkX2Zvcl9jYW5jZWxsYXRpb24gYW5kIG5vdCBzZWxmLmlzX2NhbmNlbGxlZDoKICAgICAgICAgICAgcmFpc2UgRG9lc05vdFZhbGlkYXRlKAogICAgICAgICAgICAgICAgbWVzc2FnZT0nQ2Fubm90IHJlYWN0aXZhdGUgYSBzdWJzY3JpcHRpb24gdW5sZXNzIGl0IGlzICcKICAgICAgICAgICAgICAgICAgICAgICAgJ3NjaGVkdWxlZCB0byBiZSBjYW5jZWxsZWQgb3IgYWxyZWFkeSBjYW5jZWxsZWQuJykKCiAgICAgICAgaWYgc2VsZi50cmFuc2ZlcnJlZF90b19zdWJzY3JpcHRpb246CiAgICAgICAgICAgIHJhaXNlIERvZXNOb3RWYWxpZGF0ZSgKICAgICAgICAgICAgICAgIG1lc3NhZ2U9J0Nhbm5vdCByZWFjdGl2YXRlIGEgc3Vic2NyaXB0aW9uIHRoYXQgaGFzIGJlZW4gJwogICAgICAgICAgICAgICAgICAgICAgICAndHJhbnNmZXJyZWQuJykKCiAgICAgICAgaW5pdGlhdG9yX2lkID0gaW5pdGlhdG9yLmlkIGlmIGluaXRpYXRvciBlbHNlIE5vbmUKICAgICAgICBpZiBzZWxmLmlzX3NjaGVkdWxlZF9mb3JfY2FuY2VsbGF0aW9uOgogICAgICAgICAgICBzZWxmLnNhdmUoKQogICAgICAgICAgICBpZiBub3Qgc2VsZi5pc191bnVzZWQ6CiAgICAgICAgICAgICAgICBkYXRhLnNpZ25hbHMuc3Vic2NyaXB0aW9uX3JlYWN0aXZhdGVkX3doZW5fc2NoZWR1bGVkX2Zvcl9jYW5jZWxsYXRpb24uc2VuZCgKICAgICAgICAgICAgICAgICAgICBzZW5kZXI9dHlwZShzZWxmKSwgc3Vic2NyaXB0aW9uPXNlbGYsIGNhbmNlbGxlZF9vbj1zZWxmLmNhbmNlbGxlZF9vbikKICAgICAgICAgICAgZGVsIHNlbGYuY2FuY2VsbGVkX29uCiAgICAgICAgICAgIHNlbGYuX2NsZWFudXBfb2ZfZnV0dXJlX2V2ZW50cygpCiAgICAgICAgICAgIE1vZGVsLlN1YnNjcmlwdGlvblRyYW5zYWN0aW9uLnNhdmVfd2l0aCgKICAgICAgICAgICAgICAgIGluaXRpYXRvcl9pZD1pbml0aWF0b3JfaWQsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fYWN0aW9uPVNVQlNDUklQVElPTl9BQ1RJT05TX0VOVU0uUkVWRVJTRV9TQ0hFRFVMRURfQ0FOQ0VMTEFUSU9OLAogICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIiwKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPSdSZXZlcnNlIFN1YnNjcmlwdGlvbiBjYW5jZWxsYXRpb24uJwogICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVsIHNlbGYuY2FuY2VsbGVkX29uCiAgICAgICAgICAgIGRlbCBzZWxmLmxhc3RfZGViaXRfYXQKCiAgICAgICAgICAgIGlmIHNlbGYuYWN0aXZhdGVkX29uOgogICAgICAgICAgICAgICAgIyBTdWJzY3JpcHRpb24gd2FzIHByZXZpb3VzbHkgYWN0aXZhdGVkLCBtYWtlIGl0IHJlYWN0aXZhdGVkIHdpdGgKICAgICAgICAgICAgICAgICMgYSBuZXcgYWN0aXZhdGlvbiB0aW1lLiBJZiBzdWJzY3JpcHRpb24gd2FzIHByZXZpb3VzbHkgdW51c2VkLAogICAgICAgICAgICAgICAgIyBsZWF2ZSBpdCB1bnVzZWQuCiAgICAgICAgICAgICAgICBzZWxmLmFjdGl2YXRlZF9vbiA9IGFycm93LnV0Y25vdygpLnRpbWVzdGFtcAogICAgICAgICAgICBzZWxmLnNhdmUoKQogICAgICAgICAgICBpZiBub3Qgc2VsZi5pc191bnVzZWQ6CiAgICAgICAgICAgICAgICBkYXRhLnNpZ25hbHMuc3Vic2NyaXB0aW9uX3JlYWN0aXZhdGVkX3doZW5fY2FuY2VsbGVkLnNlbmQoCiAgICAgICAgICAgICAgICAgICAgc2VuZGVyPXR5cGUoc2VsZiksIHN1YnNjcmlwdGlvbj1zZWxmKQoKICAgICAgICBub3Rlc190ZXh0ID0gJyBOb3RlczogJyArIG5vdGVzIGlmIG5vdGVzIGVsc2UgJycKICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgIGluaXRpYXRvcl9pZD1pbml0aWF0b3JfaWQsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9hY3Rpb249U1VCU0NSSVBUSU9OX0FDVElPTlNfRU5VTS5SRUFDVElWQVRFRCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl90eXBlPSJkZXZpY2UiLAogICAgICAgICAgICBkZXNjcmlwdGlvbj0nU3Vic2NyaXB0aW9uIGlzIHJlYWN0aXZhdGVkLiBOZXcgc3RhdHVzOiAlcy4lcycgJQogICAgICAgICAgICAgICAgICAgICAgICAoc2VsZi5zdGF0dXNfdGV4dCwgbm90ZXNfdGV4dCksCiAgICAgICAgKQoKICAgIGRlZiBnZXRfdHJhbnNmZXJfY2FuY2VsX3JlYXNvbl9jb2RlKHNlbGYpOgogICAgICAgIGNhbmNlbF9yZWFzb24gPSBNb2RlbC5TdWJzY3JpcHRpb25DYW5jZWxsYXRpb25SZWFzb24ubWFuYWdlci5maW5kX3NpbmdsZSgKICAgICAgICAgICAgY29kZT0idHJhbnNmZXIiKQogICAgICAgIHJldHVybiBjYW5jZWxfcmVhc29uLmNvZGUgaWYgY2FuY2VsX3JlYXNvbiBlbHNlIE5vbmUKCiAgICBkZWYgdHJhbnNmZXIoc2VsZiwgaW5pdGlhdG9yPU5vbmUsIHRvX3VzZXJfaWQ9Tm9uZSwgdHJhbnNmZXJfcmVhc29uPU5vbmUpOgoKICAgICAgICBpZiBub3QgdHJhbnNmZXJfcmVhc29uIG9yIHRyYW5zZmVyX3JlYXNvbiBub3QgaW4gQ1VSUkVOVF9TVUJTQ1JJUFRJT05fVFJBTlNGRVJfUkVBU09OUzoKICAgICAgICAgICAgcmFpc2UgRG9lc05vdFZhbGlkYXRlKG1lc3NhZ2U9IlJlYXNvbiBmb3IgVHJhbnNmZXIgKCVzKSBpcyBub3QgYSB2YWxpZCB2YWx1ZS4iICUgKAogICAgICAgICAgICAgICAgdHJhbnNmZXJfcmVhc29uLCkpCgogICAgICAgIHRvX3N1YnNjcmlwdGlvbiA9IE1vZGVsLlN1YnNjcmlwdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgIGFjdGl2YXRlZF9vbj1zZWxmLmFjdGl2YXRlZF9vbiwKICAgICAgICAgICAgY29zdF9pbl9jZW50cz1zZWxmLmNvc3RfaW5fY2VudHMsCiAgICAgICAgICAgIGN1cnJlbmN5PXNlbGYuY3VycmVuY3ksCiAgICAgICAgICAgIGxhc3RfYmlsbGluZ19hdHRlbXB0ZWRfYXQ9c2VsZi5sYXN0X2JpbGxpbmdfYXR0ZW1wdGVkX2F0LAogICAgICAgICAgICBsYXN0X2JpbGxpbmdfZmFpbGVkX2F0PXNlbGYubGFzdF9iaWxsaW5nX2ZhaWxlZF9hdCwKICAgICAgICAgICAgbGFzdF9kZWJpdF9hdD1zZWxmLmxhc3RfZGViaXRfYXQsCiAgICAgICAgICAgIG5hbWU9c2VsZi5uYW1lLAogICAgICAgICAgICBvcmRlcl9pdGVtX2lkPXNlbGYub3JkZXJfaXRlbV9pZCwKICAgICAgICAgICAgX3Bvc3RhbF9jb2RlPXNlbGYucG9zdGFsX2NvZGUsCiAgICAgICAgICAgIHByZXBhaWRfY3JlZGl0cz1zZWxmLnByZXBhaWRfY3JlZGl0cywKICAgICAgICAgICAgcHJlcGFpZF9jcmVkaXRzX3VzZWQ9c2VsZi5wcmVwYWlkX2NyZWRpdHNfdXNlZCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX3R5cGU9c2VsZi5zdWJzY3JpcHRpb25fdHlwZSwKICAgICAgICAgICAgdG90YWxfcGF5bWVudHM9c2VsZi50b3RhbF9wYXltZW50cywKICAgICAgICAgICAgdHJhbnNmZXJyZWRfZnJvbV9zdWJzY3JpcHRpb25faWQ9c2VsZi5pZCwKICAgICAgICAgICAgdXNlcl9pZD10b191c2VyX2lkLAogICAgICAgICAgICB3YWl2ZXJzPXNlbGYud2FpdmVycywKICAgICAgICAgICAgd2FpdmVyc191c2VkPXNlbGYud2FpdmVyc191c2VkKQoKICAgICAgICBmb3IgdXNlciBpbiBzZWxmLnNoYXJlZF91c2VyX3NldDoKICAgICAgICAgICAgaWYgdXNlci5pZCAhPSB0b19zdWJzY3JpcHRpb24udXNlcl9pZDoKICAgICAgICAgICAgICAgIHRvX3N1YnNjcmlwdGlvbi5hZGRfc2hhcmVkX3VzZXIodXNlcikKCiAgICAgICAgc2VsZi53YWl2ZXJzX3VzZWQgPSAwCiAgICAgICAgc2VsZi53YWl2ZXJzID0gMAogICAgICAgIHNlbGYuc2F2ZSgpCgogICAgICAgIE1vZGVsLlN1YnNjcmlwdGlvbldhaXZlckhpc3Rvcnkuc2F2ZV93aXRoKAogICAgICAgICAgICBtb2RpZmllZF9ieV91c2VyX2lkPXNlbGYudXNlcl9pZCwKICAgICAgICAgICAgd2FpdmVyX2tpbmQ9TW9kZWwuU3Vic2NyaXB0aW9uV2FpdmVySGlzdG9yeS5XQUlWRVJfS0lORF9UUkFOU0ZFUl9GUk9NLAogICAgICAgICAgICB3YWl2ZXJfdmFsdWU9MCwKICAgICAgICAgICAgd2FpdmVyc19yZW1haW5pbmc9MCwKICAgICAgICAgICAgc3Vic2NyaXB0aW9uX2lkPXNlbGYuaWQsCiAgICAgICAgKQoKICAgICAgICBpZiB0b19zdWJzY3JpcHRpb24ud2FpdmVycyAhPSAwOgogICAgICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25XYWl2ZXJIaXN0b3J5LnNhdmVfd2l0aCgKICAgICAgICAgICAgICAgIG1vZGlmaWVkX2J5X3VzZXJfaWQ9dG9fdXNlcl9pZCwKICAgICAgICAgICAgICAgIHdhaXZlcl9raW5kPU1vZGVsLlN1YnNjcmlwdGlvbldhaXZlckhpc3RvcnkuV0FJVkVSX0tJTkRfVFJBTlNGRVJfVE8sCiAgICAgICAgICAgICAgICB3YWl2ZXJfdmFsdWU9dG9fc3Vic2NyaXB0aW9uLndhaXZlcnMsCiAgICAgICAgICAgICAgICB3YWl2ZXJzX3JlbWFpbmluZz10b19zdWJzY3JpcHRpb24ucmVtYWluaW5nX3dhaXZlcnMsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ9dG9fc3Vic2NyaXB0aW9uLmlkLAogICAgICAgICAgICApCgogICAgICAgIHRvX3N1Yl9jcmVhdGVkX2F0ID0gdG9fc3Vic2NyaXB0aW9uLmNyZWF0ZWRfYXQKCiAgICAgICAgaWYgc2VsZi5hY3RpdmF0ZWRfb246CiAgICAgICAgICAgIHRvX3N1YnNjcmlwdGlvbi5hY3RpdmF0ZWRfb24gPSB0b19zdWJfY3JlYXRlZF9hdAogICAgICAgICAgICB0b19zdWJzY3JpcHRpb24uZmlyc3RfYWN0aXZhdGVkX29uID0gdG9fc3ViX2NyZWF0ZWRfYXQKCiAgICAgICAgdG9fc3Vic2NyaXB0aW9uLnNhdmUoKQoKICAgICAgICBNb2RlbC5TdWJzY3JpcHRpb25UcmFuc2FjdGlvbi5zYXZlX3dpdGgoCiAgICAgICAgICAgIGluaXRpYXRvcl9pZD1pbml0aWF0b3IuaWQsCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9hY3Rpb249U1VCU0NSSVBUSU9OX0FDVElPTlNfRU5VTS5UUkFOU0ZFUlJFRCwKICAgICAgICAgICAgY3JlYXRlX3JlYXNvbj0iVHJhbnNmZXIiLAogICAgICAgICAgICByZWFzb249dHJhbnNmZXJfcmVhc29uLAogICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ9dG9fc3Vic2NyaXB0aW9uLmlkLAogICAgICAgICAgICBzdWJzY3JpcHRpb25fdHlwZT0iZGV2aWNlIiwKICAgICAgICAgICAgZGVzY3JpcHRpb249J1RyYW5zZmVycmVkIGZyb20gJXMnICUgc2VsZi5pZAogICAgICAgICkKCiAgICAgICAgcmV0dXJuIHRvX3N1YnNjcmlwdGlvbi5pZAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHN0cmVhbV9saW1pdChzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5TVFJFQU1fTElNSVQgaWYgc2VsZi5pc19hY3RpdmUgZWxzZSAwCgogICAgZGVmIGNhbGN1bGF0ZV93YWl2ZXJfYWRqdXN0bWVudChzZWxmLCB3YWl2ZXJfdmFsdWUpOgogICAgICAgIGlmIChzZWxmLndhaXZlcnMgKyB3YWl2ZXJfdmFsdWUpIDwgMDoKICAgICAgICAgICAgcmV0dXJuIC1zZWxmLndhaXZlcnMKICAgICAgICByZXR1cm4gd2FpdmVyX3ZhbHVlCgogICAgZGVmIGFkanVzdF93YWl2ZXJzKHNlbGYsIHdhaXZlcl92YWx1ZSk6CiAgICAgICAgc2VsZi5hdG9taWNfdXBkYXRlKHdhaXZlcnM9Rignd2FpdmVycycpICsgd2FpdmVyX3ZhbHVlKQogICAgICAgIHJldHVybiBzZWxmLmdldChzZWxmLmlkKQoKICAgIGRlZiBhZGRfc2hhcmVkX3VzZXIoc2VsZiwgdXNlciwgY291bnRyeT1Ob25lKToKICAgICAgICBpZiBzZWxmLmlzX2NvbW1lcmNpYWw6CiAgICAgICAgICAgIHJhaXNlIERvZXNOb3RWYWxpZGF0ZSgKICAgICAgICAgICAgICAgIG1lc3NhZ2U9IlNoYXJpbmcgaXMgbm90IGFsbG93ZWQgZm9yIGNvbW1lcmNpYWwgc3Vic2NyaXB0aW9uIHtzdWIuaWR9Ii5mb3JtYXQoCiAgICAgICAgICAgICAgICAgICAgc3ViPXNlbGYpKQogICAgICAgIGlmIHVzZXIgPT0gc2VsZi51c2VyOgogICAgICAgICAgICByYWlzZSBEb2VzTm90VmFsaWRhdGUoCiAgICAgICAgICAgICAgICBtZXNzYWdlPSJPd25lciBjYW5ub3QgYmUgYWRkZWQgdG8gdGhlIHNoYXJlZCBsaXN0IG9mIFN1YnNjcmlwdGlvbiB7c3ViX2lkfSIuZm9ybWF0KAogICAgICAgICAgICAgICAgICAgIHN1Yl9pZD1zZWxmLmlkKSkKICAgICAgICBzZWxmLnNoYXJlZF91c2VyX3NldC5hZGQodXNlcikKICAgICAgICB1c2VyLnN1YnNjcmlwdGlvbl9zaGFyZWRfY291bnRyeSA9IGNvdW50cnkKICAgICAgICB1c2VyLnNoYXJlZF9zdWJzY3JpcHRpb25fc2V0LmFkZChzZWxmKQogICAgICAgIGlmIHVzZXIuY2hhbmdlcygpOgogICAgICAgICAgICB1c2VyLnNhdmUoKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGlzX2NvbW1lcmNpYWwoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuc3Vic2NyaXB0aW9uX3R5cGUgPT0gc2VsZi5DT01NRVJDSUFMCgogICAgQHByb3BlcnR5CiAgICBkZWYgYXNzb2NpYXRlZF91c2VycyhzZWxmKToKICAgICAgICByZXR1cm4gW3NlbGYudXNlcl0gKyBzZWxmLnNoYXJlZF91c2VyX3NldC5pdGVtcwoKICAgIGRlZiByZW1vdmVfc2hhcmVkX3VzZXIoc2VsZiwgdXNlcik6CiAgICAgICAgc2VsZi5zaGFyZWRfdXNlcl9zZXQucmVtb3ZlKHVzZXIpCiAgICAgICAgdXNlci5zaGFyZWRfc3Vic2NyaXB0aW9uX3NldC5yZW1vdmUoc2VsZikKCiAgICBkZWYgY3JlYXRlX3N0cmVhbV9oaXN0b3J5KHNlbGYsIHVzZXJfaWQpOgogICAgICAgIGlmIG5vdCBzZWxmLmhhc19hdmFpbGFibGVfc3RyZWFtOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICBzdHJlYW1faGlzdG9yeSA9IE1vZGVsLlN0cmVhbUhpc3Rvcnkuc2F2ZV93aXRoKAogICAgICAgICAgICBzdWJzY3JpcHRpb25faWQ9c2VsZi5pZCwKICAgICAgICAgICAgdXNlcl9pZD11c2VyX2lkKQogICAgICAgIHNlbGYuc3RyZWFtX2hpc3Rvcnlfc2V0LmFkZChzdHJlYW1faGlzdG9yeSkKICAgICAgICByZXR1cm4gc3RyZWFtX2hpc3RvcnkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBhc3NvY2lhdGVkX2NvbXBvbmVudHMoc2VsZik6CiAgICAgICAgcmV0dXJuIFtjb21wb25lbnQuc2VyaWFsX251bWJlciBmb3IgY29tcG9uZW50IGluCiAgICAgICAgICAgICAgICBNb2RlbC5Db21wb25lbnQuc2VhcmNoKHN1YnNjcmlwdGlvbl9pZD1zZWxmLmlkKV0KCiAgICBAcHJvcGVydHkKICAgIGRlZiBkZXZpY2VfbmFtZShzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5kZXZpY2UubmFtZSBpZiBzZWxmLmRldmljZV9pZCBlbHNlIE5vbmUKCiAgICBAcHJvcGVydHkKICAgIGRlZiBiaWtlX2RldmljZV9uYW1lKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLmJpa2VfZGV2aWNlLm5hbWUgaWYgc2VsZi5iaWtlX2RldmljZV9pZCBlbHNlIE5vbmUKCiAgICBAcHJvcGVydHkKICAgIGRlZiB0cmVhZF9kZXZpY2VfbmFtZShzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi50cmVhZF9kZXZpY2UubmFtZSBpZiBzZWxmLnRyZWFkX2RldmljZV9pZCBlbHNlIE5vbmUKCgpkZWYgcmVjb3JkX2NoYXJnZV9tZXRyaWMoc3RhdHVzLCBhY3Rpb24sIHJlc291cmNlX2lkPU5vbmUpOgogICAgc3RhdHNkLmluY3JlbWVudCgiY2hhcmdlX3N1YnNjcmlwdGlvbi4iICsgYWN0aW9uLCB0YWdzPVsic3RhdHVzOiIgKyBzdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdWJzY3JpcHRpb25fdHlwZTpkZXZpY2UiXSkKICAgIGlmIHN0YXR1cyA9PSBDSEFSR0VfU1RBVFVTLkZBSUxVUkU6CiAgICAgICAgbWVzc2FnZSA9IENIQVJHRV9XQVJOSU5HUy5nZXQoYWN0aW9uKS5mb3JtYXQoaWQ9cmVzb3VyY2VfaWQpCiAgICAgICAgbG9nZ2VyLndhcm4oImNoYXJnZV9zdWJzY3JpcHRpb24gOjoge21lc3NhZ2V9Ii5mb3JtYXQobWVzc2FnZT1tZXNzYWdlKSkKCgpkZWYgX2dldF9jdXJyZW50X3RpbWUoY3VycmVudF90aW1lKToKICAgIHJldHVybiBjdXJyZW50X3RpbWUgaWYgY3VycmVudF90aW1lIGVsc2UgYXJyb3cudXRjbm93KCkudGltZXN0YW1w</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">CiAgICAjIC0tICMK</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">ZnJvbSBlY29tbS5yZXR1cm5zLm9yZGVyX3JldHVybnMuZGF0YS5yZXR1cm5hYmxlX3N1YnNjcmlwdGlvbl9idWlsZGVyIGltcG9ydCBSZXR1cm5hYmxlU3Vic2NyaXB0aW9uQnVpbGRlcgo=</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">ICAgIGlmIHN1YnNjcmlwdGlvbnM6CiAgICAgICAgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uc1swXQoKICAgIHJldHVybiBzdWJzY3JpcHRpb24K</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">ICAgIHN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbnNbMF0K</text>
      </register>
      <register name="y" type="2">
        <text encoding="base64">ICAgICAgICBpZiBub3Qgc2VsZi5oYXNfcmVzcG9uZGVkOgogICAgICAgICAgICByZXR1cm4gIiIKCiAgICAgICAgcmVzcG9uc2VzID0gWwogICAgICAgICAgICBxLnJlc3BvbnNlX2Zvcl9zaGlwcGluZ19wYXJ0bmVyCiAgICAgICAgICAgIGZvciBxIGluIHNlbGYucXVlc3Rpb25zX3dpdGhfcmVzcG9uc2VzCiAgICAgICAgICAgIGlmIHEucmVzcG9uc2VfZm9yX3NoaXBwaW5nX3BhcnRuZXIgaXMgbm90IE5vbmUKICAgICAgICBdCgogICAgICAgIHJldHVybiAiICIuam9pbihyZXNwb25zZXMpCgogICAgZGVmIGdldF9zdXJ2ZXlfbGluayhzZWxmKToK</text>
      </register>
      <register name=":" type="4">
        <text>67</text>
      </register>
    </registers>
    <search>
      <last-search encoding="base64">XDxwYXJlbnRfcGF5bWVudF90eXBlXD4=</last-search>
      <last-offset />
      <last-pattern encoding="base64">XDxwYXJlbnRfcGF5bWVudF90eXBlXD4=</last-pattern>
      <last-replace>fixture_note_response</last-replace>
      <last-substitute>fixture_create_response</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>403</entry>
        <entry>is_return_supported</entry>
        <entry>existing</entry>
        <entry encoding="base64">XDxSZXNwb25zZVw+</entry>
        <entry>profile</entry>
        <entry>def profile(</entry>
        <entry>transactions</entry>
        <entry>subscription</entry>
        <entry>credit</entry>
        <entry>activation_keyh</entry>
        <entry>activation_key</entry>
        <entry>activation_code</entry>
        <entry>device_subscription</entry>
        <entry>device</entry>
        <entry>subscription_type</entry>
        <entry>DEVICE</entry>
        <entry>access_level</entry>
        <entry>payment_set</entry>
        <entry>payment</entry>
        <entry encoding="base64">XDxwYXJlbnRfcGF5bWVudF90eXBlXD4=</entry>
      </history-search>
      <history-cmd>
        <entry>9291</entry>
        <entry>9330</entry>
        <entry encoding="base64">JzwsJz4zMTU2</entry>
        <entry>3156</entry>
        <entry>3222</entry>
        <entry>357</entry>
        <entry encoding="base64">JzwsJz42NDk=</entry>
        <entry>649</entry>
        <entry>w</entry>
        <entry>208</entry>
        <entry>315</entry>
        <entry>1074</entry>
        <entry>465</entry>
        <entry>50</entry>
        <entry>586</entry>
        <entry>599</entry>
        <entry>source ~/.ideavimrc</entry>
        <entry>37</entry>
        <entry>216</entry>
        <entry>67</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed E</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed H</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed G</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed O</text>
      </shortcut-conflict>
    </shortcut-conflicts>
    <editor>
      <key-repeat enabled="true" />
    </editor>
  </component>
</application>